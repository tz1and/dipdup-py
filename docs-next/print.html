<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>DipDup framework</title>
        <meta name="robots" content="noindex" />
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Overview</a></li><li class="chapter-item expanded affix "><li class="part-title">User Guide</li><li class="chapter-item expanded "><a href="quickstart.html"><strong aria-hidden="true">1.</strong> Quickstart</a></li><li class="chapter-item expanded "><a href="getting-started/index.html"><strong aria-hidden="true">2.</strong> Getting started</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="getting-started/installation.html"><strong aria-hidden="true">2.1.</strong> Installation</a></li><li class="chapter-item expanded "><a href="getting-started/core-concepts.html"><strong aria-hidden="true">2.2.</strong> Core concepts</a></li><li class="chapter-item expanded "><a href="getting-started/preparing-inventory.html"><strong aria-hidden="true">2.3.</strong> Preparing inventory</a></li><li class="chapter-item expanded "><a href="getting-started/project-structure.html"><strong aria-hidden="true">2.4.</strong> Project structure</a></li><li class="chapter-item expanded "><a href="getting-started/templates-and-variables.html"><strong aria-hidden="true">2.5.</strong> Templates and variables</a></li><li class="chapter-item expanded "><a href="getting-started/defining-models.html"><strong aria-hidden="true">2.6.</strong> Defining models</a></li><li class="chapter-item expanded "><a href="getting-started/implementing-handlers.html"><strong aria-hidden="true">2.7.</strong> Implementing handlers</a></li></ol></li><li class="chapter-item expanded "><a href="advanced/index.html"><strong aria-hidden="true">3.</strong> Advanced usage</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="advanced/datasources.html"><strong aria-hidden="true">3.1.</strong> Datasources</a></li><li class="chapter-item expanded "><a href="advanced/hooks/index.html"><strong aria-hidden="true">3.2.</strong> Hooks</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="advanced/hooks/default.html"><strong aria-hidden="true">3.2.1.</strong> Default hooks</a></li><li class="chapter-item expanded "><a href="advanced/hooks/jobs.html"><strong aria-hidden="true">3.2.2.</strong> Job scheduler</a></li></ol></li><li class="chapter-item expanded "><a href="advanced/reindexing.html"><strong aria-hidden="true">3.3.</strong> Reindexing</a></li><li class="chapter-item expanded "><a href="advanced/feature-flags.html"><strong aria-hidden="true">3.4.</strong> Feature flags</a></li><li class="chapter-item expanded "><a href="advanced/sql.html"><strong aria-hidden="true">3.5.</strong> Executing SQL scripts</a></li><li class="chapter-item expanded "><a href="advanced/performance.html"><strong aria-hidden="true">3.6.</strong> Improving performance</a></li><li class="chapter-item expanded "><a href="advanced/context/index.html"><strong aria-hidden="true">3.7.</strong> Callback context (ctx)</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="advanced/context/reference.html"><strong aria-hidden="true">3.7.1.</strong> Full reference</a></li></ol></li><li class="chapter-item expanded "><a href="advanced/internal-models.html"><strong aria-hidden="true">3.8.</strong> Internal models</a></li><li class="chapter-item expanded "><a href="advanced/index-factories.html"><strong aria-hidden="true">3.9.</strong> Spawning indexes at runtime</a></li><li class="chapter-item expanded "><a href="advanced/scheduler.html"><strong aria-hidden="true">3.10.</strong> Scheduler configuration</a></li><li class="chapter-item expanded "><a href="advanced/metadata-interface.html"><strong aria-hidden="true">3.11.</strong> Metadata interface</a></li></ol></li><li class="chapter-item expanded "><a href="graphql/index.html"><strong aria-hidden="true">4.</strong> GraphQL API</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="graphql/hasura.html"><strong aria-hidden="true">4.1.</strong> Hasura integration</a></li><li class="chapter-item expanded "><a href="graphql/rest.html"><strong aria-hidden="true">4.2.</strong> REST endpoints</a></li><li class="chapter-item expanded "><a href="graphql/genql.html"><strong aria-hidden="true">4.3.</strong> GenQL</a></li></ol></li><li class="chapter-item expanded "><a href="troubleshooting/index.html"><strong aria-hidden="true">5.</strong> Troubleshooting</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="troubleshooting/common-issues.html"><strong aria-hidden="true">5.1.</strong> Common issues</a></li><li class="chapter-item expanded "><a href="troubleshooting/reporting-bugs.html"><strong aria-hidden="true">5.2.</strong> Reporting bugs</a></li></ol></li><li class="chapter-item expanded "><a href="deployment/index.html"><strong aria-hidden="true">6.</strong> Deployment and operations</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="deployment/database-engines.html"><strong aria-hidden="true">6.1.</strong> Database engines</a></li><li class="chapter-item expanded "><a href="deployment/docker.html"><strong aria-hidden="true">6.2.</strong> Building Docker images</a></li><li class="chapter-item expanded "><a href="deployment/docker-compose.html"><strong aria-hidden="true">6.3.</strong> Deploying with docker-compose</a></li><li class="chapter-item expanded "><a href="deployment/swarm.html"><strong aria-hidden="true">6.4.</strong> Deploying with Docker Swarm</a></li><li class="chapter-item expanded "><a href="deployment/sentry.html"><strong aria-hidden="true">6.5.</strong> Sentry integration</a></li><li class="chapter-item expanded "><a href="deployment/prometheus.html"><strong aria-hidden="true">6.6.</strong> Prometheus integration</a></li><li class="chapter-item expanded "><a href="deployment/logging.html"><strong aria-hidden="true">6.7.</strong> Logging</a></li><li class="chapter-item expanded "><a href="deployment/monitoring.html"><strong aria-hidden="true">6.8.</strong> Monitoring</a></li><li class="chapter-item expanded "><a href="deployment/backups.html"><strong aria-hidden="true">6.9.</strong> Backup and restore</a></li></ol></li><li class="chapter-item expanded "><a href="cookbook/index.html"><strong aria-hidden="true">7.</strong> Cookbook</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="cookbook/offchain-data.html"><strong aria-hidden="true">7.1.</strong> Processing offchain data</a></li><li class="chapter-item expanded "><a href="cookbook/reusing-typenames.html"><strong aria-hidden="true">7.2.</strong> Reusing typename for different contracts</a></li><li class="chapter-item expanded "><a href="cookbook/sync-callbacks.html"><strong aria-hidden="true">7.3.</strong> Synchronizing multiple handlers/hooks</a></li><li class="chapter-item expanded "><a href="cookbook/multiprocessing.html"><strong aria-hidden="true">7.4.</strong> Multiprocessing</a></li></ol></li><li class="chapter-item expanded "><a href="examples/index.html"><strong aria-hidden="true">8.</strong> Examples</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="examples/demo-projects.html"><strong aria-hidden="true">8.1.</strong> Demo projects</a></li><li class="chapter-item expanded "><a href="examples/built-with-dipdup.html"><strong aria-hidden="true">8.2.</strong> Built with DipDup</a></li></ol></li><li class="chapter-item expanded "><a href="services/index.html"><strong aria-hidden="true">9.</strong> Services (plugins)</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="services/mempool.html"><strong aria-hidden="true">9.1.</strong> mempool</a></li><li class="chapter-item expanded "><a href="services/metadata.html"><strong aria-hidden="true">9.2.</strong> metadata</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Reference Guide</li><li class="chapter-item expanded "><a href="cli-reference.html"><strong aria-hidden="true">10.</strong> Command-line reference</a></li><li class="chapter-item expanded "><a href="config/index.html"><strong aria-hidden="true">11.</strong> Config file reference</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="config/reference.html"><strong aria-hidden="true">11.1.</strong> Full reference</a></li><li class="chapter-item expanded "><a href="config/advanced.html"><strong aria-hidden="true">11.2.</strong> advanced</a></li><li class="chapter-item expanded "><a href="config/contracts.html"><strong aria-hidden="true">11.3.</strong> contracts</a></li><li class="chapter-item expanded "><a href="config/database.html"><strong aria-hidden="true">11.4.</strong> database</a></li><li class="chapter-item expanded "><a href="config/datasources.html"><strong aria-hidden="true">11.5.</strong> datasources</a></li><li class="chapter-item expanded "><a href="config/hasura.html"><strong aria-hidden="true">11.6.</strong> hasura</a></li><li class="chapter-item expanded "><a href="config/hooks.html"><strong aria-hidden="true">11.7.</strong> hooks</a></li><li class="chapter-item expanded "><a href="config/indexes/index.html"><strong aria-hidden="true">11.8.</strong> indexes</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="config/indexes/big_map.html"><strong aria-hidden="true">11.8.1.</strong> big_map</a></li><li class="chapter-item expanded "><a href="config/indexes/head.html"><strong aria-hidden="true">11.8.2.</strong> head</a></li><li class="chapter-item expanded "><a href="config/indexes/operation.html"><strong aria-hidden="true">11.8.3.</strong> operation</a></li><li class="chapter-item expanded "><a href="config/indexes/template.html"><strong aria-hidden="true">11.8.4.</strong> template</a></li></ol></li><li class="chapter-item expanded "><a href="config/jobs.html"><strong aria-hidden="true">11.9.</strong> jobs</a></li><li class="chapter-item expanded "><a href="config/package.html"><strong aria-hidden="true">11.10.</strong> package</a></li><li class="chapter-item expanded "><a href="config/prometheus.html"><strong aria-hidden="true">11.11.</strong> prometheus</a></li><li class="chapter-item expanded "><a href="config/sentry.html"><strong aria-hidden="true">11.12.</strong> sentry</a></li><li class="chapter-item expanded "><a href="config/spec_version.html"><strong aria-hidden="true">11.13.</strong> spec_version</a></li><li class="chapter-item expanded "><a href="config/templates.html"><strong aria-hidden="true">11.14.</strong> templates</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">What's New</li><li class="chapter-item expanded "><a href="CHANGELOG.html"><strong aria-hidden="true">12.</strong> Changelog</a></li><li class="chapter-item expanded "><a href="release-notes/index.html"><strong aria-hidden="true">13.</strong> Release notes</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="release-notes/5.1.0.html"><strong aria-hidden="true">13.1.</strong> 5.1.0</a></li><li class="chapter-item expanded "><a href="release-notes/5.0.0.html"><strong aria-hidden="true">13.2.</strong> 5.0.0</a></li><li class="chapter-item expanded "><a href="release-notes/4.2.0.html"><strong aria-hidden="true">13.3.</strong> 4.2.0</a></li><li class="chapter-item expanded "><a href="release-notes/4.1.0.html"><strong aria-hidden="true">13.4.</strong> 4.1.0</a></li><li class="chapter-item expanded "><a href="release-notes/4.0.0.html"><strong aria-hidden="true">13.5.</strong> 4.0.0</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">DipDup framework</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <hr />
<center> ✨ We invite you to take part in the <a href="https://forms.gle/nMkQnmukRPmwQedLA">DipDup Community Survey April 2022</a>! ✨ </center>
<hr />
<p><a href="https://www.python.org"><img src="https://img.shields.io/badge/made%20with-python-blue.svg?" alt="Python" /></a>
<a href="https://github.com/dipdup-net/dipdup-py"><img src="https://img.shields.io/github/stars/dipdup-net/dipdup-py" alt="GitHub stars" /></a>
<a href="https://github.com/dipdup-net/dipdup-py/releases"><img src="https://img.shields.io/github/v/release/dipdup-net/dipdup-py?label=stable" alt="Latest stable release" /></a>
<a href="https://github.com/dipdup-net/dipdup-py/releases"><img src="https://img.shields.io/github/v/release/dipdup-net/dipdup-py?include_prereleases&amp;label=latest" alt="Latest pre-release)" /></a>
<a href="https://pypi.org/project/dipdup/"><img src="https://img.shields.io/pypi/dm/dipdup" alt="PyPI monthly downloads" /></a>
<br>
<a href="https://github.com/dipdup-net/dipdup-py/actions"><img src="https://img.shields.io/github/workflow/status/dipdup-net/dipdup-py/Test" alt="GitHub tests" /></a>
<a href="https://github.com/dipdup-net/dipdup-py/issues"><img src="https://img.shields.io/github/issues/dipdup-net/dipdup-py" alt="GitHub issues" /></a>
<a href="https://github.com/dipdup-net/dipdup-py/pulls"><img src="https://img.shields.io/github/issues-pr/dipdup-net/dipdup-py" alt="GitHub pull requests" /></a>
<a href="https://github.com/dipdup-net/dipdup-py/blob/master/LICENSE"><img src="https://img.shields.io/github/license/dipdup-net/dipdup-py" alt="License: MIT" /></a></p>
<pre><code class="language-text">        ____   _         ____              
       / __ \ (_)____   / __ \ __  __ ____ 
      / / / // // __ \ / / / // / / // __ \
     / /_/ // // /_/ // /_/ // /_/ // /_/ /
    /_____//_// .___//_____/ \__,_// .___/ 
             /_/                  /_/      
</code></pre>
<p>DipDup is a Python framework for building indexers of <a href="https://tezos.com/">Tezos</a> smart-contracts. It helps developers focus on the business logic instead of writing data storing and serving boilerplate. DipDup-based indexers are selective, which means only required data is requested. This approach allows to achieve faster indexing times and decreased load on APIs DipDup uses.</p>
<ul>
<li>
<p><strong>Ready to build your first indexer?</strong> Head to <a href="https://dipdup.net/docs/quickstart">Quickstart</a>.</p>
</li>
<li>
<p><strong>Looking for examples?</strong> Check out <a href="https://github.com/dipdup-net/dipdup-py/tree/master/src">Demo Projects</a>.</p>
</li>
<li>
<p><strong>Want to contribute?</strong> See <a href="https://github.com/dipdup-net/dipdup-py/tree/master/CONTRIBUTING.md">Contribution Guide</a>.</p>
</li>
<li>
<p><strong>Have a question?</strong> Contact us on <a href="https://discord.com/invite/RcPGSdcVSx">Discord</a>, <a href="https://t.me/baking_bad_chat">Telegram</a>, or <a href="https://tezos-dev.slack.com/archives/CV5NX7F2L">Slack</a>!</p>
</li>
</ul>
<p>This project is maintained by the <a href="https://baking-bad.org/">Baking Bad</a> team.
Development is supported by <a href="https://tezos.foundation/">Tezos Foundation</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="quickstart"><a class="header" href="#quickstart">Quickstart</a></h1>
<p>This page will guide you through the steps to get your first selective indexer up and running in a few minutes without getting too deep into the details.</p>
<p>Let's create an indexer for the <a href="https://tzkt.io/KT1PWx2mnDueood7fEmfbBDKx1D9BAnnXitn/operations/">tzBTC FA1.2 token contract</a>. Our goal is to save all token transfers to the database and then calculate some statistics of its holders' activity.</p>
<p>A Linux environment with Python 3.10+ installed is required to use DipDup.</p>
<h2 id="create-a-new-project"><a class="header" href="#create-a-new-project">Create a new project</a></h2>
<h3 id="from-template"><a class="header" href="#from-template">From template</a></h3>
<p>Cookiecutter is a cool <code>jinja2</code> wrapper to initialize hello-world templates of various frameworks and toolkits interactively. Install <code>python-cookiecutter</code> package systemwide, then call:</p>
<pre><code class="language-shell">cookiecutter https://github.com/dipdup-net/cookiecutter-dipdup
</code></pre>
<h3 id="from-scratch"><a class="header" href="#from-scratch">From scratch</a></h3>
<p>We advise using the <code>poetry</code> package manager for new projects.</p>
<pre><code class="language-shell">poetry init
poetry add dipdup
poetry shell
</code></pre>
<blockquote>
<p>🤓 <strong>SEE ALSO</strong></p>
<ul>
<li><a href="https://dipdup.net/docs-next/getting-started/installation.html">2.1. Installation</a></li>
<li><a href="https://python-poetry.org/docs/">Poetry documentation</a></li>
</ul>
</blockquote>
<h2 id="write-a-configuration-file"><a class="header" href="#write-a-configuration-file">Write a configuration file</a></h2>
<p>DipDup configuration is stored in YAML files of a specific format. Create a new file named <code>dipdup.yml</code> in your current working directory with the following content:</p>
<pre><code class="language-yaml">spec_version: 1.2
package: demo_tzbtc

database:
  kind: sqlite
  path: demo_tzbtc.sqlite3
  
contracts:
  tzbtc_mainnet:
    address: KT1PWx2mnDueood7fEmfbBDKx1D9BAnnXitn
    typename: tzbtc

datasources:
  tzkt_mainnet:
    kind: tzkt
    url: https://api.tzkt.io
    
indexes:
  tzbtc_holders_mainnet:
    kind: operation
    datasource: tzkt_mainnet
    contracts: 
      - tzbtc_mainnet
    handlers:
      - callback: on_transfer
        pattern:
          - destination: tzbtc_mainnet
            entrypoint: transfer
      - callback: on_mint
        pattern:
          - destination: tzbtc_mainnet
            entrypoint: mint
</code></pre>
<blockquote>
<p>🤓 <strong>SEE ALSO</strong></p>
<ul>
<li><a href="https://dipdup.net/docs-next/getting-started/templates-and-variables.html">2.5. Templates and variables</a></li>
<li><a href="https://dipdup.net/docs-next/config/index.html">11. Config file reference</a></li>
</ul>
</blockquote>
<h2 id="initialize-project-tree"><a class="header" href="#initialize-project-tree">Initialize project tree</a></h2>
<p>Now it's time to generate typeclasses and callback stubs. Run the following command:</p>
<pre><code class="language-shell">dipdup init
</code></pre>
<p>DipDup will create a Python package <code>demo_tzbtc</code> having the following structure:</p>
<pre><code class="language-text">demo_tzbtc
├── graphql
├── handlers
│   ├── __init__.py
│   ├── on_mint.py
│   └── on_transfer.py
├── hooks
│   ├── __init__.py
│   ├── on_reindex.py
│   ├── on_restart.py
│   ├── on_index_rollback.py
│   └── on_synchronized.py
├── __init__.py
├── models.py
├── sql
│   ├── on_reindex
│   ├── on_restart
│   ├── on_index_rollback
│   └── on_synchronized
└── types
    ├── __init__.py
    └── tzbtc
        ├── __init__.py
        ├── parameter
        │   ├── __init__.py
        │   ├── mint.py
        │   └── transfer.py
        └── storage.py
</code></pre>
<p>That's a lot of files and directories! But don't worry, we will need only <code>models.py</code> and <code>handlers</code> modules in this guide.</p>
<blockquote>
<p>🤓 <strong>SEE ALSO</strong></p>
<ul>
<li><a href="https://dipdup.net/docs-next/getting-started/project-structure.html">2.4. Project structure</a></li>
<li><a href="https://dipdup.net/docs-next/cli-reference.html#init">10. Command-line reference → init</a></li>
</ul>
</blockquote>
<h2 id="define-data-models"><a class="header" href="#define-data-models">Define data models</a></h2>
<p>Our schema will consist of a single model <code>Holder</code> having several fields:</p>
<ul>
<li><code>address</code> — account address</li>
<li><code>balance</code> — in tzBTC</li>
<li><code>volume</code> — total transfer/mint amount bypassed</li>
<li><code>tx_count</code> — number of transfers/mints</li>
<li><code>last_seen</code> — time of the last transfer/mint</li>
</ul>
<p>Put the following content in the <code>models.py</code> file:</p>
<pre><code class="language-python">from tortoise import Model, fields


class Holder(Model):
    address = fields.CharField(max_length=36, pk=True)
    balance = fields.DecimalField(decimal_places=8, max_digits=20, default=0)
    volume = fields.DecimalField(decimal_places=8, max_digits=20, default=0)
    tx_count = fields.BigIntField(default=0)
    last_seen = fields.DatetimeField(null=True)
</code></pre>
<blockquote>
<p>🤓 <strong>SEE ALSO</strong></p>
<ul>
<li><a href="https://dipdup.net/docs-next/getting-started/defining-models.html">2.6. Defining models</a></li>
<li><a href="https://tortoise-orm.readthedocs.io/en/latest/">Tortoise ORM documentation</a></li>
<li><a href="https://tortoise-orm.readthedocs.io/en/latest/examples.html">Tortoise ORM examples</a></li>
</ul>
</blockquote>
<h2 id="implement-handlers"><a class="header" href="#implement-handlers">Implement handlers</a></h2>
<p>Everything's ready to implement an actual indexer logic.</p>
<p>Our task is to index all the balance updates, so we'll start with a helper method to handle them. Create a file named <code>on_balance_update.py</code> in the <code>handlers</code> package with the following content:</p>
<pre><code class="language-python">from decimal import Decimal
import demo_tzbtc.models as models


async def on_balance_update(
    address: str,
    balance_update: Decimal, 
    timestamp: str
) -&gt; None:
    holder, _ = await models.Holder.get_or_create(address=address)
    holder.balance += balance_update
    holder.tx_count += 1
    holder.last_seen = timestamp
    assert holder.balance &gt;= 0, address
    await holder.save()
</code></pre>
<p>Three methods of tzBTC contract can alter token balances — <code>transfer</code>, <code>mint</code>, and <code>burn</code>. The last one is omitted in this tutorial for simplicity. Edit corresponding handlers to call the <code>on_balance_update</code> method with data from matched operations:</p>
<p><code>on_transfer.py</code></p>
<pre><code class="language-python">from typing import Optional
from decimal import Decimal

from dipdup.models import Transaction
from dipdup.context import HandlerContext

import demo_tzbtc.models as models

from demo_tzbtc.types.tzbtc.parameter.transfer import TransferParameter
from demo_tzbtc.types.tzbtc.storage import TzbtcStorage
from demo_tzbtc.handlers.on_balance_update import on_balance_update


async def on_transfer(
    ctx: HandlerContext,
    transfer: Transaction[TransferParameter, TzbtcStorage],
) -&gt; None:
    if transfer.parameter.from_ == transfer.parameter.to:
        # NOTE: Internal tzBTC transaction
        return

    amount = Decimal(transfer.parameter.value) / (10 ** 8)
    await on_balance_update(
        address=transfer.parameter.from_,
        balance_update=-amount,
        timestamp=transfer.data.timestamp,
    )
    await on_balance_update(address=transfer.parameter.to,
                            balance_update=amount,
                            timestamp=transfer.data.timestamp)
</code></pre>
<p><code>on_mint.py</code></p>
<pre><code class="language-python">from typing import Optional
from decimal import Decimal

from dipdup.models import Transaction
from dipdup.context import HandlerContext

import demo_tzbtc.models as models

from demo_tzbtc.types.tzbtc.parameter.mint import MintParameter
from demo_tzbtc.types.tzbtc.storage import TzbtcStorage
from demo_tzbtc.handlers.on_balance_update import on_balance_update


async def on_mint(
    ctx: HandlerContext,
    mint: Transaction[MintParameter, TzbtcStorage],
) -&gt; None:
    amount = Decimal(mint.parameter.value) / (10 ** 8)
    await on_balance_update(
        address=mint.parameter.to,
        balance_update=amount,
        timestamp=mint.data.timestamp
    )
</code></pre>
<p>And that's all! We can run the indexer now.</p>
<blockquote>
<p>🤓 <strong>SEE ALSO</strong></p>
<ul>
<li><a href="https://dipdup.net/docs-next/getting-started/implementing-handlers.html">2.7. Implementing handlers</a></li>
</ul>
</blockquote>
<h2 id="run-your-indexer"><a class="header" href="#run-your-indexer">Run your indexer</a></h2>
<pre><code class="language-shell">dipdup run
</code></pre>
<p>DipDup will fetch all the historical data and then switch to realtime updates. Your application data has been successfully indexed!</p>
<blockquote>
<p>🤓 <strong>SEE ALSO</strong></p>
<ul>
<li><a href="https://dipdup.net/docs-next/cli-reference.html">10. Command-line reference</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="getting-started"><a class="header" href="#getting-started">Getting started</a></h1>
<p>This part of the docs covers the same features the <a href="getting-started/../quickstart.html">Quickstart</a> article does but is more focused on details.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installation"><a class="header" href="#installation">Installation</a></h1>
<p>This page covers the installation of DipDup in different environments.</p>
<h2 id="host-requirements"><a class="header" href="#host-requirements">Host requirements</a></h2>
<p>A Linux environment with <strong>Python 3.10</strong> installed is required to use DipDup.</p>
<p>Minimum hardware requirements are 256 MB RAM, 1 CPU core, and some disk space for the database.</p>
<h3 id="non-linux-environments"><a class="header" href="#non-linux-environments">Non-Linux environments</a></h3>
<p>Other UNIX-like systems (macOS, FreeBSD, etc.) should work but are not supported officially.</p>
<p>DipDup currently doesn't work in Windows environments due to incompatibilities in libraries it depends on. Please use WSL or Docker.</p>
<p>We <a href="https://github.com/dipdup-net/dipdup-py/pull/358">aim to improve</a> cross-platform compatibility in future releases.</p>
<blockquote>
<p>🤓 <strong>SEE ALSO</strong></p>
<ul>
<li><a href="https://dipdup.net/docs-next/advanced/performance.html">3.6. Improving performance</a></li>
<li><a href="https://docs.microsoft.com/en-us/windows/wsl/about">What is the Windows Subsystem for Linux?</a></li>
</ul>
</blockquote>
<h2 id="local-installation"><a class="header" href="#local-installation">Local installation</a></h2>
<p>To begin with, create a new directory for your project and enter it. Now choose one way of managing virtual environments:</p>
<h3 id="poetry-recommended"><a class="header" href="#poetry-recommended">Poetry (recommended)</a></h3>
<p>Initialize a new PEP 518 project and add DipDip to dependencies.</p>
<pre><code class="language-shell">poetry init
poetry add dipdup
</code></pre>
<h3 id="pip"><a class="header" href="#pip">pip</a></h3>
<p>Create a new virtual environment and install DipDup in it.</p>
<pre><code class="language-shell">python -m venv .venv
source .venv/bin/activate
pip install dipdup
</code></pre>
<h2 id="other-options"><a class="header" href="#other-options">Other options</a></h2>
<blockquote>
<p>🤓 <strong>SEE ALSO</strong></p>
<ul>
<li><a href="https://dipdup.net/docs-next/deployment/docker.html">6.2. Building Docker images</a></li>
<li><a href="https://dipdup.net/docs-next/deployment/docker-compose.html">6.3. Deploying with docker-compose</a></li>
<li><a href="https://dipdup.net/docs-next/deployment/swarm.html">6.4. Deploying with Docker Swarm</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="core-concepts"><a class="header" href="#core-concepts">Core concepts</a></h1>
<h2 id="big-picture"><a class="header" href="#big-picture">Big picture</a></h2>
<p>DipDup is heavily inspired by <a href="https://thegraph.com/">The Graph</a> Protocol, but there are several differences:</p>
<ul>
<li>DipDup works with operation groups (explicit operation and all internal ones) and <em>Big_map</em> updates (lazy hash map structures) — until fully-fledged events are implemented in Tezos.</li>
<li>DipDup utilizes a microservice approach and relies heavily on existing solutions, making the SDK very lightweight and allowing it to switch API engines on demand.</li>
</ul>
<p>Consider DipDup a set of best practices for building custom backends for decentralized applications, plus a toolkit that spares you from writing boilerplate code.</p>
<p>DipDup is tightly coupled with <a href="http://api.tzkt.io/">TzKT API</a> but can generally use any data provider which implements a particular feature set. TzKT provides REST endpoints and Websocket subscriptions with flexible filters enabling selective indexing and returns &quot;humanified&quot; contract data, which means you don't have to handle raw Michelson expressions.</p>
<p>DipDup offers PostgreSQL + Hasura GraphQL Engine combo out-of-the-box to expose indexed data via REST and GraphQL with minimal configuration. However, you can use any database and API engine (e.g., write your own API backend).</p>
<p><img src="getting-started/../assets/dipdup.svg" alt="Default DipDup setup and data flow" /></p>
<h2 id="how-it-works"><a class="header" href="#how-it-works">How it works</a></h2>
<p>From the developer's perspective, there are three main steps for creating an indexer using DipDup framework:</p>
<ol>
<li>Write a declarative configuration file containing all the inventory and indexing rules.</li>
<li>Describe your domain-specific data models.</li>
<li>Implement the business logic, which is how to convert blockchain data to your models.</li>
</ol>
<p>As a result, you get a service responsible for filling the database with the indexed data.</p>
<p>Within this service, there can be multiple indexers running independently.</p>
<h2 id="atomicity-and-persistency"><a class="header" href="#atomicity-and-persistency">Atomicity and persistency</a></h2>
<p>DipDup applies all updates atomically block by block. In case of an emergency shutdown, it can safely recover later and continue from the level it ended. DipDup state is stored in the database per index and can be used by API consumers to determine the current indexer head.</p>
<p>Here are a few essential things to know before running your indexer:</p>
<ul>
<li>Ensure that the database you're connecting to is used by DipDup exclusively. Changes in index configuration or models require DipDup to <strong>drop the whole database</strong> and start indexing from scratch.</li>
<li>Do not rename existing indexes in the config file without cleaning up the database first. DipDup won't handle that automatically and will treat the renamed index as new.</li>
<li>Multiple indexes pointing to different contracts should not reuse the same models (unless you know what you are doing) because synchronization is done sequentially by index.</li>
</ul>
<h2 id="schema-migration"><a class="header" href="#schema-migration">Schema migration</a></h2>
<p>DipDup does not support database schema migration: if there's any model change, it will trigger reindexing. The rationale is that it's easier and faster to start over than handle migrations that can be of arbitrary complexity and do not guarantee data consistency.</p>
<p>DipDup stores a hash of the SQL version of the DB schema and checks for changes each time you run indexing.</p>
<h2 id="handling-chain-reorgs"><a class="header" href="#handling-chain-reorgs">Handling chain reorgs</a></h2>
<p>Reorg messages signaling chain reorganizations. That means some blocks, including all operations, are rolled back in favor of another with higher fitness. Chain reorgs happen regularly (especially in testnets), so it's not something you can ignore. You must handle such messages correctly - otherwise, you will likely accumulate duplicate or invalid data. You can implement your rollback logic by editing the <code>on_index_rollback</code> hook.</p>
<h3 id="single-level"><a class="header" href="#single-level">Single level</a></h3>
<p>Single level rollbacks are processed in the following way:</p>
<ul>
<li>If the new block has the same subset of operations as the replaced one — do nothing;</li>
<li>If the new block has all the operations from the replaced one AND several new operations — process those new operations;</li>
<li>If the new block misses some operations from the replaced one: trigger full reindexing.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="preparing-inventory"><a class="header" href="#preparing-inventory">Preparing inventory</a></h1>
<blockquote>
<p>🚧 <strong>UNDER CONSTRUCTION</strong></p>
<p>This page or paragraph is yet to be written. Come back later.</p>
</blockquote>
<!-- TODO: Rewrite this page completely -->
<p>Before starting indexing, you need to set up several things:</p>
<ul>
<li>Contracts you want to process with your indexer. See <a href="getting-started/../config/contracts.html">12.2. contracts</a> for details.</li>
<li>Datasources used both by DipDup internally and user on demand. See <a href="getting-started/../config/datasources.html">12.4. datasources</a> for details.</li>
<li>Indexes. See <a href="getting-started/../config/indexes/README.html">12.7. indexes</a> for details.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="project-structure"><a class="header" href="#project-structure">Project structure</a></h1>
<p>The structure of the DipDup project package is the following:</p>
<pre><code class="language-text">demo_tzbtc
├── graphql
├── handlers
│   ├── __init__.py
│   ├── on_mint.py
│   └── on_transfer.py
├── hooks
│   ├── __init__.py
│   ├── on_reindex.py
│   ├── on_restart.py
│   ├── on_index_rollback.py
│   └── on_synchronized.py
├── __init__.py
├── models.py
├── sql
│   ├── on_reindex
│   ├── on_restart
│   ├── on_index_rollback
│   └── on_synchronized
└── types
    ├── __init__.py
    └── tzbtc
        ├── __init__.py
        ├── parameter
        │   ├── __init__.py
        │   ├── mint.py
        │   └── transfer.py
        └── storage.py
</code></pre>
<table><thead><tr><th>path</th><th>description</th></tr></thead><tbody>
<tr><td><code>graphql</code></td><td>GraphQL queries for Hasura (<code>*.graphql</code>)</td></tr>
<tr><td><code>handlers</code></td><td>User-defined callbacks to process matched operations and big map diffs</td></tr>
<tr><td><code>hooks</code></td><td>User-defined callbacks to run manually or by schedule</td></tr>
<tr><td><code>models.py</code></td><td>Tortoise ORM models</td></tr>
<tr><td><code>sql</code></td><td>SQL scripts to run from callbacks (<code>*.sql</code>)</td></tr>
<tr><td><code>types</code></td><td>Codegened Pydantic typeclasses for contract storage/parameter</td></tr>
</tbody></table>
<p>DipDup will generate all the necessary directories and files inside the project's root on <code>init</code> command. These include contract type definitions and callback stubs to be implemented by the developer.</p>
<h2 id="type-classes"><a class="header" href="#type-classes">Type classes</a></h2>
<!-- TODO: Move somewhere -->
<p>DipDup receives all smart contract data (transaction parameters, resulting storage, big_map updates) in normalized form (<a href="https://baking-bad.org/blog/2021/03/03/tzkt-v14-released-with-improved-smart-contract-data-and-websocket-api/">read more</a> about how TzKT handles Michelson expressions) but still as raw JSON. DipDup uses contract type information to generate data classes, which allow developers to work with strictly typed data.</p>
<p>DipDup generates <a href="https://pydantic-docs.helpmanual.io/datamodel_code_generator/">Pydantic</a> models out of JSONSchema. You might want to install additional plugins (<a href="https://pydantic-docs.helpmanual.io/pycharm_plugin/">PyCharm</a>, <a href="https://pydantic-docs.helpmanual.io/mypy_plugin/">mypy</a>) for convenient work with this library.</p>
<p>The following models are created at <code>init</code>:</p>
<ul>
<li><code>operation</code> indexes: storage type for all contracts met in handler patterns plus parameter type for all destination+entrypoint pairs.</li>
<li><code>big_map</code> indexes: key and storage types for all big map paths in handler configs.</li>
</ul>
<h2 id="nested-packages"><a class="header" href="#nested-packages">Nested packages</a></h2>
<p>Callback modules don't have to be in top-level <code>hooks</code>/<code>handlers</code> directories. Add one or multiple dots to the callback name to define nested packages:</p>
<pre><code class="language-yaml">package: indexer
hooks:
  foo.bar:
    callback: foo.bar
</code></pre>
<p>After running the <code>init</code> command, you'll get the following directory tree (shortened for readability):</p>
<pre><code class="language-text">indexer
├── hooks
│   ├── foo
│   │   ├── bar.py
│   │   └── __init__.py
│   └── __init__.py
└── sql
    └── foo
        └── bar
            └── .keep
</code></pre>
<p>The same rules apply to handler callbacks. Note that the <code>callback</code> field must be a valid Python package name - lowercase letters, underscores, and dots.</p>
<blockquote>
<p>🤓 <strong>SEE ALSO</strong></p>
<ul>
<li><a href="https://dipdup.net/docs-next/getting-started/defining-models.html">2.6. Defining models</a></li>
<li><a href="https://dipdup.net/docs-next/getting-started/implementing-handlers.html">2.7. Implementing handlers</a></li>
<li><a href="https://dipdup.net/docs-next/advanced/hooks/index.html">3.2. Hooks</a></li>
<li><a href="https://dipdup.net/docs-next/advanced/sql.html">3.5. Executing SQL scripts</a></li>
<li><a href="https://dipdup.net/docs-next/graphql/hasura.html">4.1. Hasura integration</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="templates-and-variables"><a class="header" href="#templates-and-variables">Templates and variables</a></h1>
<p>Templates allow you to reuse index configuration, e.g., for different networks (mainnet/testnet) or multiple contracts sharing the same codebase.</p>
<pre><code class="language-yaml">templates:
  my_template:
    kind: operation
    datasource: &lt;datasource&gt;
    contracts:
      - &lt;contract1&gt;
    handlers:
      - callback: callback1
        pattern:
          - destination: &lt;contract1&gt;
            entrypoint: call
</code></pre>
<p>Templates have the same syntax as <a href="getting-started/../config/indexes/README.html">indexes</a> of all kinds; the only difference is that they additionally support placeholders enabling parameterization:</p>
<pre><code class="language-yaml">field: &lt;placeholder&gt;
</code></pre>
<p>Any string value wrapped in angle brackets is treated as a placeholder, so make sure there are no collisions with the actual values. You can use a single placeholder multiple times.</p>
<p>Any index implementing a template must have a value for each existing placeholder; the exception raised otherwise. Those values are within the handler context at <code>ctx.template_values</code>.</p>
<blockquote>
<p>🤓 <strong>SEE ALSO</strong></p>
<ul>
<li><a href="https://dipdup.net/docs-next/advanced/index-factories.html">3.9. Spawning indexes at runtime</a></li>
<li><a href="https://dipdup.net/docs-next/config/templates.html">11.14. templates</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="defining-models"><a class="header" href="#defining-models">Defining models</a></h1>
<p>DipDup uses the Tortoise ORM library to cover database operations. During initialization, DipDup generates a <code>models.py</code> file on the top level of the package that will contain all database models. The name and location of this file cannot be changed.</p>
<p>A typical <code>models.py</code> file looks like the following:</p>
<pre><code class="language-python">from tortoise import Tortoise, fields
from tortoise.models import Model


class Event(Model):
    id = fields.IntField(pk=True)
    name = fields.TextField()
    datetime = fields.DatetimeField(null=True)
</code></pre>
<p>See the links below to learn how to use this library.</p>
<h2 id="limitations"><a class="header" href="#limitations">Limitations</a></h2>
<p>There are some limitations introduced to make Hasura GraphQL integration easier.</p>
<ul>
<li>Table names must be in <code>snake_case</code></li>
<li>Model fields must be in <code>snake_case</code></li>
<li>Model fields must differ from table name</li>
</ul>
<blockquote>
<p>🤓 <strong>SEE ALSO</strong></p>
<ul>
<li><a href="https://tortoise-orm.readthedocs.io/en/latest/">Tortoise ORM documentation</a></li>
<li><a href="https://tortoise-orm.readthedocs.io/en/latest/examples.html">Tortoise ORM examples</a></li>
<li><a href="https://dipdup.net/docs-next/deployment/database-engines.html">6.1. Database engines</a></li>
<li><a href="https://dipdup.net/docs-next/deployment/backups.html">6.9. Backup and restore</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="implementing-handlers"><a class="header" href="#implementing-handlers">Implementing handlers</a></h1>
<p>DipDup generates a separate file with a callback stub for each handler in every index specified in the configuration file.</p>
<p>In the case of the <code>transaction</code> handler, the callback method signature is the following:</p>
<pre><code class="language-python">from &lt;package&gt;.types.&lt;typename&gt;.parameter.&lt;entrypoint_1&gt; import EntryPoint1Parameter
from &lt;package&gt;.types.&lt;typename&gt;.parameter.&lt;entrypoint_n&gt; import EntryPointNParameter
from &lt;package&gt;.types.&lt;typename&gt;.storage import TypeNameStorage


async def on_transaction(
    ctx: HandlerContext,
    entrypoint_1: Transaction[EntryPoint1Parameter, TypeNameStorage],
    entrypoint_n: Transaction[EntryPointNParameter, TypeNameStorage]
) -&gt; None:
    ...
</code></pre>
<p>where:</p>
<ul>
<li><code>entrypoint_1 ... entrypoint_n</code> are items from the according to handler pattern.</li>
<li><code>ctx: HandlerContext</code> provides useful helpers and contains an internal state (see ).</li>
<li>A <code>Transaction</code> model contains transaction typed parameter and storage, plus other fields.</li>
</ul>
<p>For the <em>origination</em> case, the handler signature will look similar:</p>
<pre><code class="language-python">from &lt;package&gt;.types.&lt;typename&gt;.storage import TypeNameStorage


async def on_origination(
    ctx: HandlerContext,
    origination: Origination[TypeNameStorage],
)
</code></pre>
<p>An <code>Origination</code> model contains the origination script, initial storage (typed), amount, delegate, etc.</p>
<p>A <em>Big_map</em> update handler will look like the following:</p>
<pre><code class="language-python">from &lt;package&gt;.types.&lt;typename&gt;.big_map.&lt;path&gt;_key import PathKey
from &lt;package&gt;.types.&lt;typename&gt;.big_map.&lt;path&gt;_value import PathValue


async def on_update(
    ctx: HandlerContext,
    update: BigMapDiff[PathKey, PathValue],
)
</code></pre>
<p><code>BigMapDiff</code> contains action (allocate, update, or remove), nullable key and value (typed).</p>
<p>You can safely change argument names (e.g., in case of collisions).</p>
<!--
TODO: Rewrite

> 💡 **TIP**
>
> If you use index templates, your callback methods will be reused for potentially different contract addresses. DipDup checks that all those contracts have the same `typename` and raise an error otherwise.
-->
<h2 id="naming-conventions"><a class="header" href="#naming-conventions">Naming conventions</a></h2>
<p>Python language requires all module and function names in snake case and all class names in pascal case.</p>
<p>A typical imports section of <code>big_map</code> handler callback looks like this:</p>
<pre><code class="language-python">from &lt;package&gt;.types.&lt;typename&gt;.storage import TypeNameStorage
from &lt;package&gt;.types.&lt;typename&gt;.parameter.&lt;entrypoint&gt; import EntryPointParameter
from &lt;package&gt;.types.&lt;typename&gt;.big_map.&lt;path&gt;_key import PathKey
from &lt;package&gt;.types.&lt;typename&gt;.big_map.&lt;path&gt;_value import PathValue
</code></pre>
<p>Here <code>typename</code> is defined in the contract inventory, <code>entrypoint</code> is specified in the handler pattern, and <code>path</code> is in the handler config.</p>
<p>DipDup does not automatically handle name collisions. Use <code>import ... as</code> if multiple contracts have entrypoints that share the same name:</p>
<pre><code class="language-python">from &lt;package&gt;.types.&lt;typename&gt;.parameter.&lt;entrypoint&gt; import EntryPointParameter as Alias
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="advanced-usage"><a class="header" href="#advanced-usage">Advanced usage</a></h1>
<p>In this section, you will find information about advanced DipDup features.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="datasources"><a class="header" href="#datasources">Datasources</a></h1>
<p>Datasources are DipDup connectors to various APIs. TzKT data is used for indexing, other sources are complimentary.</p>
<table><thead><tr><th style="text-align: left"></th><th style="text-align: left"><code>tzkt</code></th><th style="text-align: left"><code>tezos-node</code></th><th style="text-align: left"><code>coinbase</code></th><th style="text-align: left"><code>metadata</code></th><th style="text-align: left"><code>ipfs</code></th><th style="text-align: left"><code>http</code></th></tr></thead><tbody>
<tr><td style="text-align: left">Callback context (via <code>ctx.datasources</code>)</td><td style="text-align: left">✅</td><td style="text-align: left">❌</td><td style="text-align: left">✅</td><td style="text-align: left">✅</td><td style="text-align: left">✅</td><td style="text-align: left">✅</td></tr>
<tr><td style="text-align: left">DipDup index</td><td style="text-align: left">✅*</td><td style="text-align: left">❌</td><td style="text-align: left">❌</td><td style="text-align: left">❌</td><td style="text-align: left">❌</td><td style="text-align: left">❌</td></tr>
<tr><td style="text-align: left"><code>mempool</code> service</td><td style="text-align: left">✅*</td><td style="text-align: left">✅*</td><td style="text-align: left">❌</td><td style="text-align: left">❌</td><td style="text-align: left">❌</td><td style="text-align: left">❌</td></tr>
<tr><td style="text-align: left"><code>metadata</code> service</td><td style="text-align: left">✅*</td><td style="text-align: left">❌</td><td style="text-align: left">❌</td><td style="text-align: left">❌</td><td style="text-align: left">❌</td><td style="text-align: left">❌</td></tr>
</tbody></table>
<p>* - required</p>
<h2 id="tzkt"><a class="header" href="#tzkt">TzKT</a></h2>
<p><a href="https://api.tzkt.io/">TzKT</a> provides REST endpoints to query historical data and SignalR (Websocket) subscriptions to get realtime updates. Flexible filters allow you to request only data needed for your application and drastically speed up the indexing process.</p>
<pre><code class="language-yaml">datasources:
  tzkt_mainnet:
    kind: tzkt
    url: https://api.tzkt.io
</code></pre>
<p>TzKT datasource is based on generic HTTP datasource and thus inherits its settings (optional):</p>
<pre><code class="language-yaml">datasources:
  tzkt_mainnet:
    http:
      cache: false
      retry_count:  # retry infinetely
      retry_sleep:
      retry_multiplier:
      ratelimit_rate:
      ratelimit_period:
      connection_limit: 100
      connection_timeout: 60
      batch_size: 10000
</code></pre>
<p>Also you can wait for several block confirmations before processing the operations, e.g. to mitigate chain reorgs:</p>
<pre><code class="language-yaml">datasources:
  tzkt_mainnet:
    buffer_size: 1  # indexing with single block lag
</code></pre>
<h2 id="tezos-node"><a class="header" href="#tezos-node">Tezos node</a></h2>
<p>Tezos RPC is a standard interface provided by the Tezos node. It's not suitable for indexing purposes but used for accessing mempool data and other things that are not available through TzKT.</p>
<pre><code class="language-yaml">datasources:
  tezos_node_mainnet:
    kind: tezos-node
    url: https://mainnet-tezos.giganode.io
</code></pre>
<h2 id="coinbase"><a class="header" href="#coinbase">Coinbase</a></h2>
<p>A connector for <a href="https://docs.pro.coinbase.com/">Coinbase Pro API</a>. Provides <code>get_candles</code> and <code>get_oracle_data</code> methods. It may be useful in enriching indexes of DeFi contracts with off-chain data.</p>
<pre><code class="language-yaml">datasources:
  coinbase:
    kind: coinbase
</code></pre>
<p>Please note that Coinbase can't replace TzKT being an index datasource. But you can access it via <code>ctx.datasources</code> mapping both within handler and job callbacks.</p>
<h2 id="dipdup-metadata"><a class="header" href="#dipdup-metadata">DipDup Metadata</a></h2>
<p><a href="https://github.com/dipdup-net/metadata">dipdup-metadata</a> is a standalone companion indexer for DipDup written in Go. Configure datasource in the following way:</p>
<pre><code class="language-yaml">datasources:
  metadata:
    kind: metadata
    url: https://metadata.dipdup.net
    network: mainnet|handzhounet
</code></pre>
<h2 id="ipfs"><a class="header" href="#ipfs">IPFS</a></h2>
<p>While working with contract/token metadata, a typical scenario is to fetch it from IPFS. DipDup now has a separate datasource to perform such requests.</p>
<pre><code class="language-yaml">datasources:
  ipfs:
    kind: ipfs
    url: https://ipfs.io/ipfs
</code></pre>
<p>You can use this datasource within any callback. Output is either JSON or binary data.</p>
<pre><code class="language-python">ipfs = ctx.get_ipfs_datasource('ipfs')

file = await ipfs.get('QmdCz7XGkBtd5DFmpDPDN3KFRmpkQHJsDgGiG16cgVbUYu')
assert file[:4].decode()[1:] == 'PDF'

file = await ipfs.get('QmSgSC7geYH3Ae4SpUHy4KutxqNH9ESKBGXoCN4JQdbtEz/package.json')
assert file['name'] == 'json-buffer'
</code></pre>
<h2 id="sending-arbitrary-requests"><a class="header" href="#sending-arbitrary-requests">Sending arbitrary requests</a></h2>
<p>DipDup datasources do not cover all available methods of underlying APIs. Let's say you want to fetch protocol of the chain you're currently indexing from TzKT:</p>
<pre><code class="language-python">tzkt = ctx.get_tzkt_datasource('tzkt_mainnet')
protocol_json = await tzkt.request(
    method='get',
    url='v1/protocols/current',
    weigth=1,  # ratelimiter leaky-bucket drops
)
assert protocol_json['hash'] == 'PtHangz2aRngywmSRGGvrcTyMbbdpWdpFKuS4uMWxg2RaH9i1qx'
</code></pre>
<p>Datasource HTTP connection parameters (ratelimit, backoff, etc.) are applied on every request.</p>
<blockquote>
<p>🤓 <strong>SEE ALSO</strong></p>
<ul>
<li><a href="https://dipdup.net/docs-next/config/datasources.html">11.5. datasources</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hooks"><a class="header" href="#hooks">Hooks</a></h1>
<p>Hooks are user-defined callbacks called either from the <a href="advanced/hooks/../context/reference.html"><code>ctx.fire_hook</code></a> method or by scheduler (<a href="advanced/hooks/jobs.html"><code>jobs</code></a> config section, we'll return to this topic later).</p>
<p>Let's assume we want to calculate some statistics on-demand to avoid blocking an indexer with heavy computations. Add the following lines to DipDup config:</p>
<pre><code class="language-yaml">hooks:
  calculate_stats:
    callback: calculate_stats
    atomic: False
    args:
     major: bool
     depth: int
</code></pre>
<p>A couple of things here to pay attention to:</p>
<ul>
<li>An <code>atomic</code> option defines whether hook callback will be wrapped in a single SQL transaction or not. If this option is set to true main indexing loop will be blocked until hook execution is complete. Some statements like <code>REFRESH MATERIALIZED VIEW</code> do not require to be wrapped in transactions, so choosing a value of the <code>atomic</code> option could decrease the time needed to perform initial indexing.</li>
<li>Values of <code>args</code> mapping are used as type hints in a signature of a generated callback. We will return to this topic later in this article.</li>
</ul>
<p>Now it's time to call <code>dipdup init</code>. The following files will be created in the project's root:</p>
<pre><code class="language-text">├── hooks
│   └── calculate_stats.py
└── sql
    └── calculate_stats
        └── .keep
</code></pre>
<p>Content of the generated callback stub:</p>
<pre><code class="language-python">from dipdup.context import HookContext

async def calculate_stats(
    ctx: HookContext,
    major: bool,
    depth: int,
) -&gt; None:
    await ctx.execute_sql('calculate_stats')
</code></pre>
<p>By default, hooks execute SQL scripts from the corresponding subdirectory of <code>sql/</code>. Remove or comment out the <code>execute_sql</code> call to prevent this. This way, both Python and SQL code may be executed in a single hook if needed.</p>
<blockquote>
<p>🤓 <strong>SEE ALSO</strong></p>
<ul>
<li><a href="https://dipdup.net/docs-next/config/hooks.html">11.7. hooks</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="default-hooks"><a class="header" href="#default-hooks">Default hooks</a></h1>
<p>Every DipDup project has multiple hooks called default; they fire on system-wide events and, like regular hooks, are not linked to any index. Names of those hooks are reserved; you can't use them in config.</p>
<h2 id="on_index_rollback"><a class="header" href="#on_index_rollback"><code>on_index_rollback</code></a></h2>
<p>Fires when TzKT datasource has received a chain reorg message which can't be processed automatically.</p>
<p>If your indexer is stateless, you can just drop DB data saved after <code>to_level</code> and continue indexing. Otherwize, implement more complex logic. By default, this hook triggers full reindexing.</p>
<h2 id="on_restart"><a class="header" href="#on_restart"><code>on_restart</code></a></h2>
<p>This hook executes right before starting indexing. It allows configuring DipDup in runtime based on data from external sources. Datasources are already initialized at execution and available at <code>ctx.datasources</code>. You can, for example, configure logging here or add contracts and indexes in runtime instead of from static config.</p>
<h2 id="on_reindex"><a class="header" href="#on_reindex"><code>on_reindex</code></a></h2>
<p>This hook fires after the database are re-initialized after reindexing (wipe). Helpful in modifying schema with arbitrary SQL scripts before indexing.</p>
<h2 id="on_synchronized"><a class="header" href="#on_synchronized"><code>on_synchronized</code></a></h2>
<p>This hook fires when every active index reaches a realtime state. Here you can clear caches internal caches or do other cleanups.</p>
<blockquote>
<p>🤓 <strong>SEE ALSO</strong></p>
<ul>
<li><a href="https://dipdup.net/docs-next/advanced/reindexing.html">3.3. Reindexing</a></li>
<li><a href="https://dipdup.net/docs-next/advanced/sql.html">3.5. Executing SQL scripts</a></li>
<li><a href="https://dipdup.net/docs-next/advanced/context/index.html">3.7. Callback context (ctx)</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="job-scheduler"><a class="header" href="#job-scheduler">Job scheduler</a></h1>
<p>Jobs are schedules for hooks. In some cases, it may come in handy to have the ability to run some code on schedule. For example, you want to calculate statistics once per hour instead of every time handler gets matched.</p>
<h2 id="arguments-typechecking"><a class="header" href="#arguments-typechecking">Arguments typechecking</a></h2>
<p>DipDup will ensure that arguments passed to the hooks have correct types when possible. <code>CallbackTypeError</code> exception will be raised otherwise. Values of an <code>args</code> mapping in a hook config should be either built-in types or <code>__qualname__</code> of external type like <code>decimal.Decimal</code>. Generic types are not supported: hints like <code>Optional[int] = None</code> will be correctly parsed during codegen but ignored on type checking.</p>
<p>See <a href="advanced/hooks/../../config/jobs.html">12.8. jobs</a> for details.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="reindexing"><a class="header" href="#reindexing">Reindexing</a></h1>
<p>In some cases, DipDup can't proceed with indexing without a full wipe. Several reasons trigger reindexing; some are avoidable, some are not:</p>
<table><thead><tr><th>reason</th><th>description</th></tr></thead><tbody>
<tr><td><code>manual</code></td><td>Reindexing triggered manually from callback with <code>ctx.reindex</code>.</td></tr>
<tr><td><code>migration</code></td><td>Applied migration requires reindexing. Check release notes before switching between major DipDup versions to be prepared.</td></tr>
<tr><td><code>rollback</code></td><td>Reorg message received from TzKT can not be processed.</td></tr>
<tr><td><code>config_modified</code></td><td>One of the index configs has been modified.</td></tr>
<tr><td><code>schema_modified</code></td><td>Database schema has been modified. Try to avoid manual schema modifications in favor of <a href="advanced/../advanced/sql.html">SQL scripts</a>.</td></tr>
</tbody></table>
<p>It is possible to configure desirable action on reindexing triggered by the specific reason.</p>
<table><thead><tr><th>action</th><th>description</th></tr></thead><tbody>
<tr><td><code>exception</code> (default)</td><td>Raise <code>ReindexingRequiredError</code> and quit with error code. The safest option since you can trigger reindexing accidentally, e.g., by a typo in config. Don't forget to set up the correct restart policy when using it with containers.</td></tr>
<tr><td><code>wipe</code></td><td>Drop the whole database and start indexing from scratch. Be careful with this option!</td></tr>
<tr><td><code>ignore</code></td><td>Ignore the event and continue indexing as usual. It can lead to unexpected side-effects up to data corruption; make sure you know what you are doing.</td></tr>
</tbody></table>
<p>To configure actions for each reason, add the following section to the DipDup config:</p>
<pre><code class="language-yaml">advanced:
  ...
  reindex:
    manual: wipe
    migration: exception
    rollback: ignore
    config_modified: exception
    schema_modified: exception
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="feature-flags"><a class="header" href="#feature-flags">Feature flags</a></h1>
<p>Feature flags allow users to modify some system-wide tunables that affect the behavior of the whole framework. These options are either experimental or unsuitable for generic configurations.</p>
<table><thead><tr><th><code>run</code> command option</th><th>config path</th><th>is stable</th></tr></thead><tbody>
<tr><td><code>--early-realtime</code></td><td><code>advanced.early_realtime</code></td><td>✅</td></tr>
<tr><td><code>--merge-subscriptions</code></td><td><code>advanced.merge_subscriptions</code></td><td>✅</td></tr>
<tr><td><code>--postpone-jobs</code></td><td><code>advanced.postpone_jobs</code></td><td>✅</td></tr>
<tr><td><code>--metadata-interface</code></td><td><code>advanced.metadata_interface</code></td><td>✅</td></tr>
<tr><td></td><td><code>advanced.skip-version-check</code></td><td>✅</td></tr>
</tbody></table>
<p>A good practice is to use set feature flags in environment-specific config files.</p>
<h2 id="early-realtime"><a class="header" href="#early-realtime">Early realtime</a></h2>
<p>By default, DipDup enters a sync state twice: before and after establishing a realtime connection. This flag allows starting collecting realtime messages while sync is in progress, right after indexes load.</p>
<p>Let's consider two scenarios:</p>
<ol>
<li>
<p>Indexing 10 contracts with 10 000 operations each. Initial indexing could take several hours. There is no need to accumulate incoming operations since resync time after establishing a realtime connection depends on the contract number, thus taking a negligible amount of time.</p>
</li>
<li>
<p>Indexing 10 000 contracts with 10 operations each. Both initial sync and resync will take a while. But the number of operations received during this time won't affect RAM consumption much.</p>
</li>
</ol>
<p>If you do not have strict RAM constraints, it's recommended to enable this flag. You'll get faster indexing times and decreased load on TzKT API.</p>
<h2 id="merge-subscriptions"><a class="header" href="#merge-subscriptions">Merge subscriptions</a></h2>
<p>Subscribe to all operations/big map diffs during realtime indexing instead of separate channels. This flag helps to avoid the 10.000 subscription limit of TzKT and speed up processing. The downside is an increased RAM consumption during sync, especially if <code>early_realtimm</code> flag is enabled too.</p>
<h2 id="postpone-jobs"><a class="header" href="#postpone-jobs">Postpone jobs</a></h2>
<p>Do not start the job scheduler until all indexes are synchronized. If your jobs perform some calculations that make sense only after indexing is fully finished, this toggle can save you some IOPS.</p>
<h2 id="metadata-interface"><a class="header" href="#metadata-interface">Metadata interface</a></h2>
<p>Without this flag calling <code>ctx.update_contract_metadata</code> and <code>ctx.update_token_metadata</code> will make no effect. Corresponding internal tables are created on reindex in any way.</p>
<h2 id="skip-version-check"><a class="header" href="#skip-version-check">Skip version check</a></h2>
<p>Disables warning about running unstable or out-of-date DipDup version.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="executing-sql-scripts"><a class="header" href="#executing-sql-scripts">Executing SQL scripts</a></h1>
<p>Put your <code>*.sql</code> scripts to <code>&lt;package&gt;/sql</code>. You can run these scripts from any callback with <code>ctx.execute_sql('name')</code>. If <code>name</code> is a directory, each script it contains will be executed.</p>
<p>Both types of scripts are executed without being wrapped with SQL transactions. It's generally a good idea to avoid touching table data in scripts;</p>
<p>SQL scripts are ignored if SQLite is used as a database backend.</p>
<p>By default, an empty <code>sql/&lt;hook_name&gt;</code> directory is generated for every hook in config during init. Comment out <code>execute_sql</code> in hook code to avoid executing them.</p>
<h2 id="default-hooks-1"><a class="header" href="#default-hooks-1">Default hooks</a></h2>
<p>Scripts from <code>sql/on_restart</code> directory are executed each time you run DipDup. Those scripts may contain <code>CREATE OR REPLACE VIEW</code> or similar non-destructive operations.</p>
<p>Scripts from <code>sql/on_reindex</code> directory are executed <em>after</em> the database schema is created based on the <code>models.py</code> module but <em>before</em>_ indexing starts. It may be useful to change the database schema in the ways that are not supported by the Tortoise ORM, e.g., to create a composite primary key;</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="improving-performance"><a class="header" href="#improving-performance">Improving performance</a></h1>
<p>This page contains tips that may help to increase indexing speed.</p>
<h2 id="optimize-database-schema"><a class="header" href="#optimize-database-schema">Optimize database schema</a></h2>
<p><a href="https://www.postgresql.org/docs/9.5/indexes-types.html">Postgres indexes</a> are tables that Postgres can use to speed up data lookup. A database index acts like a pointer to data in a table, just like an index in a printed book. If you look in the index first, you will find the data much quicker than searching the whole book (or — in this case — database).</p>
<p>You should add indexes on columns often appearing in `WHERE`` clauses in your GraphQL queries and subscriptions.</p>
<p>Tortoise ORM uses BTree indexes by default. To set index on a field, add <code>index=True</code> to the field definition:</p>
<pre><code class="language-python">from tortoise import Model, fields


class Trade(Model):
    id = fields.BigIntField(pk=True)
    amount = fields.BigIntField()
    level = fields.BigIntField(index=True)
    timestamp = fields.DatetimeField(index=True)
</code></pre>
<h2 id="tune-datasources"><a class="header" href="#tune-datasources">Tune datasources</a></h2>
<p>All datasources now share the same code under the hood to communicate with underlying APIs via HTTP. Configs of all datasources and also Hasura's one can have an optional section <code>http</code> with any number of the following parameters set:</p>
<pre><code class="language-yaml">datasources:
  tzkt:
    kind: tzkt
    ...
    http:
      retry_count: 10
      retry_sleep: 1
      retry_multiplier: 1.2
      ratelimit_rate: 100
      ratelimit_period: 60
      connection_limit: 25
      batch_size: 10000
hasura:
  url: http://hasura:8080
  http:
    ...
</code></pre>
<table><thead><tr><th>field</th><th>description</th></tr></thead><tbody>
<tr><td><code>cache</code></td><td>Whether to cache responses</td></tr>
<tr><td><code>retry_count</code></td><td>Number of retries after request failed before giving up</td></tr>
<tr><td><code>retry_sleep</code></td><td>Sleep time between retries</td></tr>
<tr><td><code>retry_multiplier</code></td><td>Multiplier for sleep time between retries</td></tr>
<tr><td><code>ratelimit_rate</code></td><td>Number of requests per period (&quot;drops&quot; in leaky bucket)</td></tr>
<tr><td><code>ratelimit_period</code></td><td>Period for rate limiting in seconds</td></tr>
<tr><td><code>connection_limit</code></td><td>Number of simultaneous connections</td></tr>
<tr><td><code>connection_timeout</code></td><td>Connection timeout in seconds</td></tr>
<tr><td><code>batch_size</code></td><td>Number of items fetched in a single paginated request (for some APIs)</td></tr>
</tbody></table>
<p>Each datasource has its defaults. Usually, there's no reason to alter these settings unless you use self-hosted instances of TzKT or other datasource.</p>
<p>By default, DipDup retries failed requests infinitely, exponentially increasing the delay between attempts. Set <code>retry_count</code> parameter to limit the number of attempts.</p>
<p><code>batch_size</code> parameter is TzKT-specific. By default, DipDup limit requests to 10000 items, the maximum value allowed on public instances provided by Baking Bad. Decreasing this value will reduce the time required for TzKT to process a single request and thus reduce the load. By reducing the <code>connection_limit</code> parameter, you can achieve the same effect (limited to synchronizing multiple indexes concurrently).</p>
<blockquote>
<p>🤓 <strong>SEE ALSO</strong></p>
<ul>
<li><a href="https://tortoise-orm.readthedocs.io/en/latest/">Tortoise ORM documentation</a></li>
<li><a href="https://tortoise-orm.readthedocs.io/en/latest/examples.html">Tortoise ORM examples</a></li>
<li><a href="https://dipdup.net/docs-next/deployment/database-engines.html">6.1. Database engines</a></li>
<li><a href="https://dipdup.net/docs-next/deployment/backups.html">6.9. Backup and restore</a></li>
</ul>
</blockquote>
<p>See <a href="advanced/../config/datasources.html">12.4. datasources</a> for details.</p>
<h2 id="use-timescaledb-for-time-series"><a class="header" href="#use-timescaledb-for-time-series">Use TimescaleDB for time-series</a></h2>
<blockquote>
<p>🚧 <strong>UNDER CONSTRUCTION</strong></p>
<p>This page or paragraph is yet to be written. Come back later.</p>
</blockquote>
<p>DipDup is fully compatible with <a href="https://docs.timescale.com/">TimescaleDB</a>. Try its &quot;continuous aggregates&quot; feature, especially if dealing with market data like DEX quotes.</p>
<h2 id="cache-commonly-used-models"><a class="header" href="#cache-commonly-used-models">Cache commonly used models</a></h2>
<p>If your indexer contains models having few fields and used primarily on relations, you can cache such models during synchronization.</p>
<p>Example code:</p>
<pre><code class="language-python">class Trader(Model):
    address = fields.CharField(36, pk=True)


class TraderCache:
    def __init__(self, size: int = 1000) -&gt; None:
        self._size = size
        self._traders: OrderedDict[str, Trader] = OrderedDict()

    async def get(self, address: str) -&gt; Trader:
        if address not in self._traders:
            # NOTE: Already created on origination
            self._traders[address], _ = await Trader.get_or_create(address=address)
              if len(self._traders) &gt; self._size:
                self._traders.popitem(last=False)

        return self._traders[address]

trader_cache = TraderCache()
</code></pre>
<p>Use <code>trader_cache.get</code> in handlers. After sync is complete, you can clear this cache to free some RAM:</p>
<pre><code class="language-python">async def on_synchronized(
    ctx: HookContext,
) -&gt; None:
    ...
    models.trader_cache.clear()
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="callback-context-ctx"><a class="header" href="#callback-context-ctx">Callback context (<code>ctx</code>)</a></h1>
<blockquote>
<p>🚧 <strong>UNDER CONSTRUCTION</strong></p>
<p>This page or paragraph is yet to be written. Come back later.</p>
</blockquote>
<p>An instance of the <code>HandlerContext</code> class is passed to every handler providing a set of helper methods and read-only properties.</p>
<h2 id="reindex---none"><a class="header" href="#reindex---none"><code>.reindex() -&gt; None</code></a></h2>
<p>Drops the entire database and starts the indexing process from scratch. <code>on_index_rollback</code> hook calls this helper by default.</p>
<h2 id="add_contractname-address-typename---coroutine"><a class="header" href="#add_contractname-address-typename---coroutine"><code>.add_contract(name, address, typename) -&gt; Coroutine</code></a></h2>
<p>Add a new contract to the inventory.</p>
<h2 id="add_indexname-template-values---coroutine"><a class="header" href="#add_indexname-template-values---coroutine"><code>.add_index(name, template, values) -&gt; Coroutine</code></a></h2>
<p>Add a new index to the current configuration.</p>
<h2 id="fire_hookname-waittrue-kwargs---none"><a class="header" href="#fire_hookname-waittrue-kwargs---none"><code>.fire_hook(name, wait=True, **kwargs) -&gt; None</code></a></h2>
<p>Trigger hook execution. Unset <code>wait</code> to execute hook outside of the current database transaction.</p>
<h2 id="execute_sqlname---none"><a class="header" href="#execute_sqlname---none"><code>.execute_sql(name) -&gt; None</code></a></h2>
<p>The <code>execute_sql</code> argument could be either name of SQL script in <code>sql</code> directory or an absolute/relative path. If the path is a directory, all <code>.sql</code> scripts within it will be executed in alphabetical order.</p>
<h2 id="update_contract_metadatanetwork-address-token_id-metadata---none"><a class="header" href="#update_contract_metadatanetwork-address-token_id-metadata---none"><code>.update_contract_metadata(network, address, token_id, metadata) -&gt; None</code></a></h2>
<p>Inserts or updates the corresponding row in the service <code>dipdup_contract_metadata</code> table used for exposing the <a href="advanced/context/../metadata-interface.html">5.11 Metadata interface</a></p>
<h2 id="update_token_metadatanetwork-address-token_id-metadata---none"><a class="header" href="#update_token_metadatanetwork-address-token_id-metadata---none"><code>.update_token_metadata(network, address, token_id, metadata) -&gt; None</code></a></h2>
<p>Inserts or updates the corresponding row in the service <code>dipdup_token_metadata</code> table used for exposing the <a href="advanced/context/../metadata-interface.html">5.11 Metadata interface</a></p>
<h2 id="logger"><a class="header" href="#logger"><code>.logger</code></a></h2>
<p>Use this instance for logging.</p>
<h2 id="template_values"><a class="header" href="#template_values"><code>.template_values</code></a></h2>
<p>You can access values used for initializing a template index.</p>
<div style="break-before: page; page-break-before: always;"></div><p><span class="target" id="module-dipdup.context"></span><dl class="py class"></p>
<dt class="sig sig-object py" id="dipdup.context.DipDupContext">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dipdup.context.</span></span><span class="sig-name descname"><span class="pre">DipDupContext</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">datasources</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">dipdup.datasources.datasource.Datasource</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">config</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="advanced/context/config-reference.html#dipdup.config.DipDupConfig" title="dipdup.config.DipDupConfig"><span class="pre">dipdup.config.DipDupConfig</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">callbacks</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dipdup.context.CallbackManager</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="advanced/context/reference.html#dipdup.context.DipDupContext" title="Permalink to this definition">¶</a></dt>
<dd><p>Class to store application context</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>datasources</strong> – Mapping of available datasources</p></li>
<li><p><strong>config</strong> – DipDup configuration</p></li>
<li><p><strong>callbacks</strong> – Low-level callback interface (intented for internal use)</p></li>
<li><p><strong>logger</strong> – Context-aware logger instance</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="dipdup.context.DipDupContext.execute_sql">
<em class="property"><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">execute_sql</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="advanced/context/reference.html#dipdup.context.DipDupContext.execute_sql" title="Permalink to this definition">¶</a></dt>
<dd><p>Execute SQL script with given name</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>name</strong> – SQL script name within <cite>&lt;project&gt;/sql</cite> directory</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="dipdup.context.DipDupContext.fire_handler">
<em class="property"><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">fire_handler</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">datasource</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dipdup.datasources.tzkt.datasource.TzktDatasource</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fmt</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="advanced/context/reference.html#dipdup.context.DipDupContext.fire_handler" title="Permalink to this definition">¶</a></dt>
<dd><p>Fire handler with given name and arguments.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> – Handler name</p></li>
<li><p><strong>index</strong> – Index name</p></li>
<li><p><strong>datasource</strong> – An instance of datasource that triggered the handler</p></li>
<li><p><strong>fmt</strong> – Format string for <cite>ctx.logger</cite> messages</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="dipdup.context.DipDupContext.fire_hook">
<em class="property"><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">fire_hook</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fmt</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wait</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="advanced/context/reference.html#dipdup.context.DipDupContext.fire_hook" title="Permalink to this definition">¶</a></dt>
<dd><p>Fire hook with given name and arguments.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> – Hook name</p></li>
<li><p><strong>fmt</strong> – Format string for <cite>ctx.logger</cite> messages</p></li>
<li><p><strong>wait</strong> – Wait for hook to finish or fire and forget</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="dipdup.context.DipDupContext.reindex">
<em class="property"><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">reindex</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">reason</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">dipdup.enums.ReindexingReason</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">context</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="advanced/context/reference.html#dipdup.context.DipDupContext.reindex" title="Permalink to this definition">¶</a></dt>
<dd><p>Drop the whole database and restart with the same CLI arguments</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="dipdup.context.DipDupContext.restart">
<em class="property"><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">restart</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="advanced/context/reference.html#dipdup.context.DipDupContext.restart" title="Permalink to this definition">¶</a></dt>
<dd><p>Restart indexer preserving CLI arguments</p>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="dipdup.context.HandlerContext">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dipdup.context.</span></span><span class="sig-name descname"><span class="pre">HandlerContext</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">datasources</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">dipdup.datasources.datasource.Datasource</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">config</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="advanced/context/config-reference.html#dipdup.config.DipDupConfig" title="dipdup.config.DipDupConfig"><span class="pre">dipdup.config.DipDupConfig</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">callbacks</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dipdup.context.CallbackManager</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dipdup.utils.FormattedLogger</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">handler_config</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="advanced/context/config-reference.html#dipdup.config.HandlerConfig" title="dipdup.config.HandlerConfig"><span class="pre">dipdup.config.HandlerConfig</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">datasource</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dipdup.datasources.tzkt.datasource.TzktDatasource</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="advanced/context/reference.html#dipdup.context.HandlerContext" title="Permalink to this definition">¶</a></dt>
<dd><p>Common handler context.</p>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="dipdup.context.HookContext">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dipdup.context.</span></span><span class="sig-name descname"><span class="pre">HookContext</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">datasources</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">dipdup.datasources.datasource.Datasource</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">config</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="advanced/context/config-reference.html#dipdup.config.DipDupConfig" title="dipdup.config.DipDupConfig"><span class="pre">dipdup.config.DipDupConfig</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">callbacks</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dipdup.context.CallbackManager</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dipdup.utils.FormattedLogger</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hook_config</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="advanced/context/config-reference.html#dipdup.config.HookConfig" title="dipdup.config.HookConfig"><span class="pre">dipdup.config.HookConfig</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="advanced/context/reference.html#dipdup.context.HookContext" title="Permalink to this definition">¶</a></dt>
<dd><p>Hook callback context.</p>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="dipdup.context.TemplateValuesDict">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dipdup.context.</span></span><span class="sig-name descname"><span class="pre">TemplateValuesDict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ctx</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="advanced/context/reference.html#dipdup.context.TemplateValuesDict" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<div style="break-before: page; page-break-before: always;"></div><h1 id="internal-models"><a class="header" href="#internal-models">Internal models</a></h1>
<table><thead><tr><th style="text-align: left">model</th><th style="text-align: left">table</th><th style="text-align: left">description</th></tr></thead><tbody>
<tr><td style="text-align: left"><code>dipdup.models.Schema</code></td><td style="text-align: left"><code>dipdup_schema</code></td><td style="text-align: left">Hash of database schema to detect changes that require reindexing.</td></tr>
<tr><td style="text-align: left"><code>dipdup.models.Index</code></td><td style="text-align: left"><code>dipdup_index</code></td><td style="text-align: left">Indexing status, level of the latest processed block, template, and template values if applicable. Relates to <code>Head</code> when status is <code>REALTIME</code> (see <code>dipdup.models.IndexStatus</code> for possible values of <code>status</code> field)</td></tr>
<tr><td style="text-align: left"><code>dipdup.models.Head</code></td><td style="text-align: left"><code>dipdup_head</code></td><td style="text-align: left">The latest block received by a datasource from a WebSocket connection.</td></tr>
<tr><td style="text-align: left"><code>dipdup.models.Contract</code></td><td style="text-align: left"><code>dipdup_contract</code></td><td style="text-align: left">Nothing useful for us humans. It helps DipDup to keep track of dynamically spawned contracts. A Contract with the same name from the config takes priority over one from this table if {any, exists, provided?}.</td></tr>
</tbody></table>
<p>With the help of these tables, you can set up monitoring of DipDup deployment to know when something goes wrong:</p>
<pre><code class="language-sql">SELECT NOW() - timestamp FROM dipdup_head;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="spawning-indexes-at-runtime"><a class="header" href="#spawning-indexes-at-runtime">Spawning indexes at runtime</a></h1>
<p>DipDup allows spawning new indexes from a template in runtime. There are two ways to do that:</p>
<ul>
<li>From another index (e.g., handling factory originations)</li>
<li>In <code>on_configure</code> hook (see <a href="https://dipdup.net/docs-next/advanced/hooks/default.html">3.2.1. Default hooks</a>)</li>
</ul>
<blockquote>
<p>⚠ <strong>WARNING</strong></p>
<p>DipDup is currently not able to automatically generate types and handlers for template indexes unless there is at least one <a href="advanced/../config/indexes/template.html">static instance</a>.</p>
</blockquote>
<p>DipDup exposes several context methods that extend the current configuration with new contracts and template instances. See <a href="https://dipdup.net/docs-next/advanced/context/index.html">3.7. Callback context (ctx)</a> for details.</p>
<p>See <a href="https://dipdup.net/docs-next/config/templates.html">11.14. templates</a> for details.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="scheduler-configuration"><a class="header" href="#scheduler-configuration">Scheduler configuration</a></h1>
<p>DipDup utilizes <code>apscheduler</code> library to run hooks according to schedules in <code>jobs</code> config section. In the following example, <code>apscheduler</code> will spawn up to three instances of the same job every time the trigger is fired, even if previous runs are in progress:</p>
<pre><code class="language-yaml">advanced:
  scheduler:
    apscheduler.job_defaults.coalesce: True
    apscheduler.job_defaults.max_instances: 3
</code></pre>
<p>See <a href="https://apscheduler.readthedocs.io/en/stable/userguide.html#configuring-the-scheduler"><code>apscheduler</code> docs</a> for details.</p>
<p>Note that you can't use executors from <code>apscheduler.executors.pool</code> module - <code>ConfigurationError</code> exception will be raised.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="metadata-interface-1"><a class="header" href="#metadata-interface-1">Metadata Interface</a></h1>
<p>When issuing a token on Tezos blockchain, there is an important yet not enough covered aspect related to how various ecosystem applications (wallets, explorers, marketplaces, and others) will display and interact with it. It's about token metadata, stored wholly or partially on-chain but intended for off-chain use only.</p>
<h2 id="token-metadata-standards"><a class="header" href="#token-metadata-standards">Token metadata standards</a></h2>
<p>There are several standards regulating the metadata file format and the way it can be stored and exposed to consumers:</p>
<ul>
<li><a href="https://tzip.tezosagora.org/proposal/tzip-21/">TZIP-21 | Rich Metadata</a> — describes a metadata schema and standards for contracts and tokens</li>
<li><a href="https://tzip.tezosagora.org/proposal/tzip-12/">TZIP-12 | FA2.0</a> — a standard for a unified token contract interface, includes an article about how to store and encode token metadata</li>
<li><a href="https://tzip.tezosagora.org/proposal/tzip-7/">TZIP-7 | FA1.2</a> — single asset token standard; reuses the token metadata approach from FA2.0</li>
</ul>
<p>Keeping aside the metadata schema, let's focus on which approaches for storing are currently standardized, their pros and cons, and what to do if any of the options available do not fit your case.</p>
<h3 id="basic-on-chain-links--off-chain-storage"><a class="header" href="#basic-on-chain-links--off-chain-storage">Basic: on-chain links / off-chain storage</a></h3>
<p>The most straightforward approach is to store everything in the contract storage, especially if it's just the basic fields (name, symbol, decimals):</p>
<pre><code class="language-text">storage
└── token_metadata [big_map]
    └── 0
        ├── token_id: 0
        └── token_info
            ├── name: &quot;&quot;
            ├── symbol: &quot;&quot;
            └── decimals: &quot;&quot;
</code></pre>
<p>But typically, you want to store more like a token thumbnail icon, and it is no longer feasible to keep such large data on-chain (because you pay gas for every byte stored).<br />
Then you can put large files somewhere off-chain (e.g., IPFS) and store just links:</p>
<pre><code class="language-text">storage
└── token_metadata [big_map]
    └── 0
        ├── token_id: 0
        └── token_info
            ├── ...
            └── thumbnailUri: &quot;ipfs://&quot;
</code></pre>
<p>This approach is still costly, but sometimes (in rare cases), you need to have access to the metadata from the contract (example: <a href="https://tzkt.io/KT1NVvPsNDChrLRH5K2cy6Sc9r1uuUwdiZQd/storage/115420">Dogami</a>).<br />
We can go further and put the entire token info structure to IPFS:</p>
<pre><code class="language-text">storage
└── token_metadata [big_map]
    └── 0
        ├── token_id: 0
        └── token_info
            └── &quot;&quot;: &quot;ipfs://&quot;
</code></pre>
<p>It is the most common case right now (example: <a href="https://tzkt.io/KT1RJ6PbjHpwc3M5rw5s2Nbmefwbuwbdxton/storage/514">HEN</a>).</p>
<p>The main advantage of the basic approach is that all the changes applied to token metadata will result in big map diffs that are easily traceable by indexers. Even if you decide to replace the off-chain file, it will cause the IPFS link to change. In the case of HTTP links, indexers cannot detect the content change; thus, token metadata won't be updated.</p>
<h3 id="custom-off-chain-view"><a class="header" href="#custom-off-chain-view">Custom: off-chain view</a></h3>
<p>The second approach presented in the TZIP-12 spec was intended to cover the cases when there's a need in reusing the same token info or when it's not possible to expose the <code>%token_metadata</code> big map in the standard form. Instead, it's offered to execute a special Michelson script against the contract storage and treat the result as the token info for a particular token (requested). The tricky part is that the script code itself is typically stored off-chain, and the whole algorithm would look like this:</p>
<ol>
<li>Try to fetch the empty string key of the <code>%metadata</code> big map to retrieve the <a href="https://tzip.tezosagora.org/proposal/tzip-16/">TZIP-16</a> file location</li>
<li>Resolve the TZIP-16 file (typically from IPFS) — it should contain the off-chain view body</li>
<li>Fetch the current contract storage</li>
<li>Build arguments for the off-chain view <code>token_metadata</code> using fetched storage and</li>
<li>Execute the script using Tezos node RPC</li>
</ol>
<p>Although this approach is more or less viable for wallets (when you need to fetch metadata for a relatively small amount of tokens), it becomes very inefficient for indexers dealing with millions of tokens:</p>
<ul>
<li>After every contract origination, one has to try to fetch the views (even if there aren't any) — it means synchronous fetching, which can take seconds in the case of IPFS</li>
<li>Executing a Michelson script is currently only* possible via Tezos node, and it's quite a heavy call (setting up the VM and contract context takes time)</li>
<li>There's no clear way to detect new token metadata addition or change — that is actually the most critical one; you never know for sure when to call the view</li>
</ul>
<p>Off-chain view approach is not supported by <a href="https://tzkt.io/">TzKT</a> indexer, and we strongly recommend not to use it, especially for contracts that can issue multiple tokens.</p>
<h2 id="dipdup-based-solution"><a class="header" href="#dipdup-based-solution">DipDup-based solution</a></h2>
<p>The alternative we offer for the very non-standard cases is using our selective indexing framework for custom token metadata retrieval and then feeding it back to the TzKT indexer, which essentially acts as a metadata aggregator. Note that while this can seem like a circular dependency, it's resolved on the interface level: all custom DipDup metadata indexers should expose specific GraphQL tables with certain fields:</p>
<pre><code class="language-js">query MyQuery {
  token_metadata() {
    metadata    // TZIP-21 JSON
    network     // mainnet or &lt;protocol&gt;net
    contract    // token contract address
    token_id    // token ID in the scope of the contract
    update_id   // integer cursor used for pagination
  }
}
</code></pre>
<p>DipDup handles table management for you and exposes a <a href="advanced/../advanced/context/README.html">context-level helper</a>.</p>
<p>Tezos Domains example:</p>
<pre><code class="language-python">await ctx.update_token_metadata(
    network=ctx.datasource.network,
    address=store_records.data.contract_address,
    token_id=token_id,
    metadata={
        'name': record_name,
        'symbol': 'TD',
        'decimals': '0',
        'isBooleanAmount': True,
        'domainData': decode_domain_data(store_records.value.data)
    },
)
</code></pre>
<p>TzKT can be configured to subscribe to one or multiple DipDup metadata sources, currently we use in production:</p>
<ul>
<li>Generic TZIP-16/TZIP-12 metadata indexer <a href="https://github.com/dipdup-net/metadata">Github</a> | <a href="https://dipdup.net/sandbox.html?service=metadata">Playground</a></li>
<li>Tezos Domains metadata indexer <a href="https://github.com/dipdup-net/tezos-domains">Github</a> | <a href="https://dipdup.net/sandbox.html?service=domains">Playground</a></li>
<li>Ubisoft Quartz metadata indexer <a href="https://github.com/dipdup-net/quartz-metadata">Github</a> | <a href="https://dipdup.net/sandbox.html?service=quartz">Playground</a></li>
</ul>
<p><img src="advanced/../assets/metadata_interface.svg" alt="TzKT token metadata flow" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="graphql-api"><a class="header" href="#graphql-api">GraphQL API</a></h1>
<p>In this section, we assume you use Hasura GraphQL Engine integration to power your API.</p>
<p>Before starting to do client integration, it's good to know the specifics of Hasura GraphQL protocol implementation and the general state of the GQL ecosystem.</p>
<h2 id="queries"><a class="header" href="#queries">Queries</a></h2>
<p>By default, Hasura generates three types of queries for each table in your schema:</p>
<ul>
<li>Generic query enabling filters by all columns</li>
<li>Single item query (by primary key)</li>
<li>Aggregation query (can be <a href="graphql/../config/hasura.html#disable-aggregation-queries">disabled</a>)</li>
</ul>
<p>All the GQL features such as fragments, variables, aliases, directives are supported, as well as batching.<br />
Read more in <a href="https://hasura.io/docs/latest/graphql/core/databases/postgres/queries/index.html">Hasura docs</a>.</p>
<p>It's important to understand that GraphQL query is just a <a href="https://graphql.org/graphql-js/graphql-clients/">POST request</a> with JSON payload, and in some instances, you don't need a complicated library to talk to your backend.</p>
<h3 id="pagination"><a class="header" href="#pagination">Pagination</a></h3>
<p>By default, Hasura does not restrict the number of rows returned per request, which could lead to abuses and heavy load to your server. You can set up limits in the configuration file. See <a href="graphql/../config/hasura.html#limit-number-of-rows">12.5. hasura</a> for details. But then you will face the need to <a href="https://hasura.io/docs/latest/graphql/core/databases/postgres/queries/pagination.html">paginate</a> over the items if the response does not fit into the limits.</p>
<h2 id="subscriptions"><a class="header" href="#subscriptions">Subscriptions</a></h2>
<p>From <a href="https://hasura.io/docs/latest/graphql/core/databases/postgres/subscriptions/index.html">Hasura documentation</a>:</p>
<p>Hasura GraphQL engine subscriptions are <strong>live queries</strong>, i.e., a subscription will return the latest result of the query and not necessarily all the individual events leading up to it.</p>
<p>This feature is essential to avoid complex state management (merging query results and subscription feed). In most scenarios, live queries are what you need to sync the latest changes from the backend.</p>
<blockquote>
<p>⚠ <strong>WARNING</strong></p>
<p>If the live query has a significant response size that does not fit into the <a href="graphql/../config/hasura.html#limit-number-of-rows">limits</a>, you need one of the following:</p>
<ol>
<li>Paginate with offset (which is not convenient)</li>
<li>Use cursor-based pagination (e.g., by an increasing unique id).</li>
<li>Narrow down request scope with filtering (e.g., by timestamp or level).</li>
</ol>
</blockquote>
<p>Ultimately you can get &quot;subscriptions&quot; on top of live quires by requesting all the items having ID greater than the maximum existing or all the items with a timestamp greater than now.</p>
<h3 id="websocket-transport"><a class="header" href="#websocket-transport">Websocket transport</a></h3>
<p>Hasura is compatible with <a href="https://github.com/apollographql/subscriptions-transport-ws">subscriptions-transport-ws</a> library, which is currently deprecated by still used by the majority of the clients.</p>
<h2 id="mutations"><a class="header" href="#mutations">Mutations</a></h2>
<p>The purpose of DipDup is to create indexers, which means you can consistently reproduce the state as long as data sources are accessible. It makes your backend &quot;stateless&quot; in a sense because it's tolerant of data loss.</p>
<p>However, you might need to introduce a non-recoverable state and mix indexed and user-generated content in some cases. DipDup allows marking these UGC tables &quot;immune&quot;, protecting them from being wiped. In addition to that, you will need to set up <a href="https://hasura.io/docs/latest/graphql/core/auth/index.html">Hasura Auth</a> and adjust write permissions for the tables (by default, they are read-only).</p>
<p>Lastly, you will need to execute GQL mutations to modify the state from the client side. <a href="https://hasura.io/docs/latest/graphql/core/databases/postgres/mutations/index.html">Read more</a> about how to do that with Hasura.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hasura-integration"><a class="header" href="#hasura-integration">Hasura integration</a></h1>
<p>DipDup uses this optional section to configure the Hasura engine to track your tables automatically.</p>
<pre><code class="language-yaml">hasura:
  url: http://hasura:8080
  admin_secret: ${HASURA_ADMIN_SECRET:-changeme}
</code></pre>
<p>Under the hood, DipDup generates Hasura metadata from your DB schema and applies it using <a href="https://hasura.io/docs/latest/graphql/core/api-reference/metadata-api/index.html">Metadata API</a>.</p>
<p>Hasura metadata is all about data representation in GraphQL API. The structure of the database itself is managed solely by Tortoise ORM.</p>
<p>Metadata configuration is idempotent: each time you call <code>run</code> or <code>hasura configure</code> command, DipDup queries the existing schema and does the merge if required. DipDup configures Hasura after reindexing, saves the hash of resulting metadata in the <code>dipdup_schema</code> table, and doesn't touch Hasura until needed.</p>
<h2 id="database-limitations"><a class="header" href="#database-limitations">Database limitations</a></h2>
<p>The current version of Hasura GraphQL Engine treats <code>public</code> and other schemas differently. Table <code>schema.customer</code> becomes <code>schema_customer</code> root field (or <code>schemaCustomer</code> if <code>camel_case</code> option is enabled in DipDup config). Table <code>public.customer</code> becomes <code>customer</code> field, without schema prefix. There's no way to remove this prefix for now. You can track related <a href="https://github.com/hasura/graphql-engine/issues/5394">issue (opens new window)</a>at Hasura's GitHub to know when the situation will change. Since 3.0.0-rc1, DipDup enforces <code>public</code> schema name to avoid ambiguity and issues with the GenQL library. You can still use any schema name if Hasura integration is not enabled.</p>
<h2 id="authentication"><a class="header" href="#authentication">Authentication</a></h2>
<p>DipDup sets read-only permissions for all tables and enables non-authorized access to the <code>/graphql</code> endpoint.</p>
<h2 id="limit-the-number-of-rows"><a class="header" href="#limit-the-number-of-rows">Limit the number of rows</a></h2>
<p>DipDup creates <code>user</code> role that allows performing queries without authorization. Now you can limit the maximum number of rows such queries return and also disable aggregation queries automatically generated by Hasura:</p>
<pre><code class="language-yaml">hasura:
  select_limit: 100
</code></pre>
<p>Note that with limits enabled, you have to use either offset or cursor-based pagination on the client-side.</p>
<h2 id="disable-aggregation-queries"><a class="header" href="#disable-aggregation-queries">Disable aggregation queries</a></h2>
<pre><code class="language-yaml">hasura:
  allow_aggregations: False
</code></pre>
<h2 id="convert-field-names-to-camel-case"><a class="header" href="#convert-field-names-to-camel-case">Convert field names to camel case</a></h2>
<p>For those of you from the JavaScript world, it may be more familiar to use <em>camelCase</em> for variable names instead of <em>snake_case</em> Hasura uses by default. DipDup now allows to convert all fields in metadata to this casing:</p>
<pre><code class="language-yaml">hasura:
  camel_case: true
</code></pre>
<p>Now this example query to hic et nunc demo indexer...</p>
<pre><code class="language-graphql">query MyQuery {
  hic_et_nunc_token(limit: 1) {
    id
    creator_id
  }
}
</code></pre>
<p>...will become this one:</p>
<pre><code class="language-graphql">query MyQuery {
  hicEtNuncToken(limit: 1) {
    id
    creatorId
  }
}
</code></pre>
<p>All fields auto generated by Hasura will be renamed accordingly: <code>hic_et_nunc_token_by_pk</code> to <code>hicEtNuncTokenByPk</code>, <code>delete_hic_et_nunc_token</code> to <code>deleteHicEtNuncToken</code> and so on. To return to defaults, set <code>camel_case</code> to False and run <code>hasura configure --force</code>.</p>
<p>Keep in mind that &quot;camelcasing&quot; is a separate stage performed after all tables are registered. So during configuration, you can observe fields in <code>snake_case</code> for several seconds even if <code>hasura.camel_case</code> flag is set.</p>
<blockquote>
<p>🤓 <strong>SEE ALSO</strong></p>
<ul>
<li><a href="https://dipdup.net/docs-next/config/hasura.html">11.6. hasura</a></li>
<li><a href="https://dipdup.net/docs-next/cli-reference.html#hasura-configure">10. Command-line reference → hasura-configure</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rest-endpoints"><a class="header" href="#rest-endpoints">REST endpoints</a></h1>
<p>Hasura 2.0 introduced the ability to expose arbitrary GraphQL queries as REST endpoints. By default, DipDup will generate GET and POST endpoints to fetch rows by primary key for all tables:</p>
<pre><code class="language-shell">curl http://127.0.0.1:8080/api/rest/hicEtNuncHolder?address=tz1UBZUkXpKGhYsP5KtzDNqLLchwF4uHrGjw
{
  &quot;hicEtNuncHolderByPk&quot;: {
    &quot;address&quot;: &quot;tz1UBZUkXpKGhYsP5KtzDNqLLchwF4uHrGjw&quot;
  }
}
</code></pre>
<p>However, there's a limitation dictated by how Hasura parses HTTP requests: only models with primary keys of basic types (int, string, and so on) can be fetched with GET requests. An attempt to fetch model with BIGINT primary key will lead to the error: <code>Expected bigint for variable id got Number</code>.
A workaround to fetching any model is to send a POST request containing a JSON payload with a single key:</p>
<pre><code class="language-shell">curl -d '{&quot;id&quot;: 152}' http://127.0.0.1:8080/api/rest/hicEtNuncToken
{
  &quot;hicEtNuncTokenByPk&quot;: {
    &quot;creatorId&quot;: &quot;tz1UBZUkXpKGhYsP5KtzDNqLLchwF4uHrGjw&quot;,
    &quot;id&quot;: 152,
    &quot;level&quot;: 1365242,
    &quot;supply&quot;: 1,
    &quot;timestamp&quot;: &quot;2021-03-01T03:39:21+00:00&quot;
  }
}
</code></pre>
<p>We hope to get rid of this limitation someday and will let you know as soon as it happens.</p>
<h2 id="custom-endpoints"><a class="header" href="#custom-endpoints">Custom endpoints</a></h2>
<p>You can put any number of <code>.graphql</code> files into <code>graphql</code> directory in your project's root, and DipDup will create REST endpoints for each of those queries. Let's say we want to fetch not only a specific token, but also the number of all tokens minted by its creator:</p>
<pre><code class="language-graphql">query token_and_mint_count($id: bigint) {
  hicEtNuncToken(where: {id: {_eq: $id}}) {
    creator {
      address
      tokens_aggregate {
        aggregate {
          count
        }
      }
    }
    id
    level
    supply
    timestamp
  }
}
</code></pre>
<p>Save this query as <code>graphql/token_and_mint_count.graphql</code> and run <code>dipdup configure-hasura</code>. Now, this query is available via REST endpoint at <code>http://127.0.0.1:8080/api/rest/token_and_mint_count</code>.</p>
<p>You can disable exposing of REST endpoints in the config:</p>
<pre><code class="language-yaml">hasura:
  rest: False
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="genql"><a class="header" href="#genql">GenQL</a></h1>
<p><a href="https://genql.vercel.app">GenQL</a> is a great library and CLI tool that automatically generates a fully typed SDK with a built-in GQL client. It works flawlessly with Hasura and is recommended for DipDup on the client-side.</p>
<h2 id="project-structure-1"><a class="header" href="#project-structure-1">Project structure</a></h2>
<p>GenQL CLI generates a ready-to-use package, compiled and prepared to publish to NPM. A typical setup is a mono repository containing several packages, including the auto-generated SDK and your front-end application.</p>
<pre><code class="language-text">project_root/
├── package.json
└── packages/
    ├── app/
    │   ├── package.json
    │   └── src/
    └── sdk/
        └── package.json
</code></pre>
<h2 id="sdk-package-config"><a class="header" href="#sdk-package-config">SDK package config</a></h2>
<p>Your minimal <em>package.json</em> file will look like the following:</p>
<pre><code class="language-typescript">{
  &quot;name&quot;: &quot;%PACKAGE_NAME%&quot;,
  &quot;version&quot;: &quot;0.0.1&quot;,
  &quot;main&quot;: &quot;dist/index.js&quot;,
  &quot;types&quot;: &quot;dist/index.d.ts&quot;,
  &quot;devDependencies&quot;: {
    &quot;@genql/cli&quot;: &quot;^2.6.0&quot;
  },
  &quot;dependencies&quot;: {
    &quot;@genql/runtime&quot;: &quot;2.6.0&quot;,
    &quot;graphql&quot;: &quot;^15.5.0&quot;
  },
  &quot;scripts&quot;: {
    &quot;build&quot;: &quot;genql --endpoint %GRAPHQL_ENDPOINT% --output ./dist&quot;
  }
}
</code></pre>
<p>That's it! Now you only need to install dependencies and execute the build target:</p>
<pre><code class="language-shell">yarn
yarn build
</code></pre>
<p>Read more about CLI <a href="https://genql.vercel.app/docs/cli/generate">options</a> available.</p>
<h3 id="demo"><a class="header" href="#demo">Demo</a></h3>
<p>Create a <code>package.json</code> file with</p>
<ul>
<li><code>%PACKAGE_NAME%</code> =&gt; <code>metadata-sdk</code></li>
<li><code>%GRAPHQL_ENDPOINT%</code> =&gt; <code>https://metadata.dipdup.net/v1/graphql</code></li>
</ul>
<p>And generate the client:</p>
<pre><code class="language-shell">yarn
yarn build
</code></pre>
<p>Then create new file <code>index.ts</code> and paste this query:</p>
<pre><code class="language-typescript">import { createClient, everything } from './dist'

const client = createClient()

client.chain.query
    .token_metadata({ where: { network: { _eq: 'mainnet' } }})
    .get({ ...everything })
    .then(res =&gt; console.log(res))
</code></pre>
<p>We need some additional dependencies to run our sample:</p>
<pre><code class="language-shell">yarn add typescript ts-node
</code></pre>
<p>Finally:</p>
<pre><code class="language-shell">npx ts-node index.ts
</code></pre>
<p>You should see a list of tokens with metadata attached in your console.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="troubleshooting"><a class="header" href="#troubleshooting">Troubleshooting</a></h1>
<blockquote>
<p>🚧 <strong>UNDER CONSTRUCTION</strong></p>
<p>This page or paragraph is yet to be written. Come back later.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="common-issues"><a class="header" href="#common-issues">Common issues</a></h1>
<h2 id="dipduperror"><a class="header" href="#dipduperror">DipDupError</a></h2>
<h3 id="unknown-dipdup-error"><a class="header" href="#unknown-dipdup-error">Unknown DipDup error</a></h3>
<p>An unexpected error has occurred!</p>
<p>Please file a bug report at https://github.com/dipdup-net/dipdup/issues</p>
<h2 id="datasourceerror"><a class="header" href="#datasourceerror">DatasourceError</a></h2>
<h3 id="one-of-datasources-returned-an-error"><a class="header" href="#one-of-datasources-returned-an-error">One of datasources returned an error</a></h3>
<p><code>[datasource_name]</code> datasource returned an error: [error_message]</p>
<p>Please file a bug report at https://github.com/dipdup-net/dipdup/issues</p>
<h2 id="configurationerror"><a class="header" href="#configurationerror">ConfigurationError</a></h2>
<h3 id="dipdup-yaml-config-is-invalid"><a class="header" href="#dipdup-yaml-config-is-invalid">DipDup YAML config is invalid</a></h3>
<p>[error_message]</p>
<p>DipDup config reference: https://dipdup.net/docs/config</p>
<h2 id="databaseconfigurationerror"><a class="header" href="#databaseconfigurationerror">DatabaseConfigurationError</a></h2>
<h3 id="dipdup-cant-initialize-database-with-given-models-and-parameters"><a class="header" href="#dipdup-cant-initialize-database-with-given-models-and-parameters">DipDup can't initialize database with given models and parameters</a></h3>
<p>[error_message]</p>
<p>Model: <code>Model</code>
Table: ``</p>
<p>Tortoise ORM examples: https://tortoise-orm.readthedocs.io/en/latest/examples.html
DipDup config reference: https://dipdup.net/docs/config/database</p>
<h2 id="reindexingrequirederror"><a class="header" href="#reindexingrequirederror">ReindexingRequiredError</a></h2>
<h3 id="unable-to-continue-indexing-with-existing-database"><a class="header" href="#unable-to-continue-indexing-with-existing-database">Unable to continue indexing with existing database</a></h3>
<p>Reindexing required! Reason: manual.</p>
<p>You may want to backup database before proceeding. After that perform one of the following actions:</p>
<ul>
<li>Eliminate the cause of reindexing and run <code>dipdup schema approve</code>.</li>
<li>Drop database and start indexing from scratch with <code>dipdup schema wipe</code> command.</li>
</ul>
<p>See https://dipdup.net/docs/advanced/reindexing for more information.</p>
<h2 id="initializationrequirederror"><a class="header" href="#initializationrequirederror">InitializationRequiredError</a></h2>
<h3 id="project-initialization-required"><a class="header" href="#project-initialization-required">Project initialization required</a></h3>
<p>Project initialization required! Reason: [error_message].</p>
<p>Perform the following actions:</p>
<ul>
<li>Run <code>dipdup init</code>.</li>
<li>Review and commit changes.</li>
</ul>
<h2 id="projectimporterror"><a class="header" href="#projectimporterror">ProjectImportError</a></h2>
<h3 id="cant-import-type-or-callback-from-the-project-package"><a class="header" href="#cant-import-type-or-callback-from-the-project-package">Can't import type or callback from the project package</a></h3>
<p>Failed to import <code>[name]</code> from module <code>[module_qualname]</code>.</p>
<p>Reasons in order of possibility:</p>
<ol>
<li><code>init</code> command has not been called after modifying the config</li>
<li>Type or callback has been renamed or removed manually</li>
<li><code>package</code> name is occupied by existing non-DipDup package</li>
<li>Package exists, but not discoverable - check <code>$PYTHONPATH</code></li>
</ol>
<h2 id="contractalreadyexistserror"><a class="header" href="#contractalreadyexistserror">ContractAlreadyExistsError</a></h2>
<h3 id="attempt-to-add-a-contract-with-alias-or-address-already-in-use"><a class="header" href="#attempt-to-add-a-contract-with-alias-or-address-already-in-use">Attempt to add a contract with alias or address already in use</a></h3>
<p>Contract with name <code>[name]</code> or address <code>tz1deadbeafdeadbeafdeadbeafdeadbeafdeadbeaf</code> already exists.</p>
<p>Active contracts:</p>
<h2 id="indexalreadyexistserror"><a class="header" href="#indexalreadyexistserror">IndexAlreadyExistsError</a></h2>
<h3 id="attemp-to-add-an-index-with-an-alias-already-in-use"><a class="header" href="#attemp-to-add-an-index-with-an-alias-already-in-use">Attemp to add an index with an alias already in use</a></h3>
<p>Index with name <code>[index_name]</code> already exists.</p>
<p>Active indexes:</p>
<h2 id="invaliddataerror"><a class="header" href="#invaliddataerror">InvalidDataError</a></h2>
<h3 id="failed-to-validate-datasource-message-against-generated-type-class"><a class="header" href="#failed-to-validate-datasource-message-against-generated-type-class">Failed to validate datasource message against generated type class</a></h3>
<p>Failed to validate datasource message against generated type class.</p>
<p>Expected type:
<code>type</code></p>
<p>Invalid data:
[path]</p>
<p>Parsed object:
{'[key]': '[value]'}</p>
<h2 id="callbackerror"><a class="header" href="#callbackerror">CallbackError</a></h2>
<h3 id="an-error-occured-during-callback-execution"><a class="header" href="#an-error-occured-during-callback-execution">An error occured during callback execution</a></h3>
<p><code>[callback_qualname]</code> callback execution failed:</p>
<p>Exception: </p>
<p>Eliminate the reason of failure and restart DipDup.</p>
<h2 id="callbacktypeerror"><a class="header" href="#callbacktypeerror">CallbackTypeError</a></h2>
<h3 id="agrument-of-invalid-type-was-passed-to-a-callback"><a class="header" href="#agrument-of-invalid-type-was-passed-to-a-callback">Agrument of invalid type was passed to a callback</a></h3>
<p><code>[name]</code> [kind] callback was called with an argument of invalid type.</p>
<p>argument: <code>[arg]</code>
type: &lt;class 'type'&gt;
expected type: &lt;class 'type'&gt;</p>
<p>Make sure to set correct typenames in config and run <code>dipdup init --overwrite-types</code> to regenerate typeclasses.</p>
<h2 id="hasuraerror"><a class="header" href="#hasuraerror">HasuraError</a></h2>
<h3 id="failed-to-configure-hasura-instance"><a class="header" href="#failed-to-configure-hasura-instance">Failed to configure Hasura instance</a></h3>
<p>Failed to configure Hasura:</p>
<p>[error_message]</p>
<p>Check out Hasura logs for more information.</p>
<p>GraphQL integration docs: https://dipdup.net/docs/graphql/</p>
<h2 id="conflictinghookserror"><a class="header" href="#conflictinghookserror">ConflictingHooksError</a></h2>
<h3 id="project-contains-hooks-that-conflict-with-each-other"><a class="header" href="#project-contains-hooks-that-conflict-with-each-other">Project contains hooks that conflict with each other</a></h3>
<p><code>[old_hook]</code> hook was superseded by the <code>[new_hook]</code> one; they can't be used together.</p>
<p>Perform one of the following actions:</p>
<ul>
<li>Follow the docs to migrate to the <code>[new_hook]</code> hook, then remove <code>[old_hook]</code> hook from the project.</li>
<li>Remove <code>[new_hook]</code> hook from the project to preserve current behavior.</li>
</ul>
<p>Release notes: https://dipdup.net/docs/release-notes/</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="reporting-bugs"><a class="header" href="#reporting-bugs">Reporting bugs</a></h1>
<blockquote>
<p>🚧 <strong>UNDER CONSTRUCTION</strong></p>
<p>This page or paragraph is yet to be written. Come back later.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="deployment-and-operations"><a class="header" href="#deployment-and-operations">Deployment and operations</a></h1>
<p>This section contains recipes to deploy and maintain DipDup instances.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="database-engines"><a class="header" href="#database-engines">Database engines</a></h1>
<p>DipDup officially supports the following databases: SQLite, PostgreSQL, TimescaleDB. This page will help you choose a database engine that mostly suits your needs.</p>
<table><thead><tr><th></th><th>SQLite</th><th>PostgreSQL</th><th>TimescaleDB</th></tr></thead><tbody>
<tr><td>Supported versions</td><td>any</td><td>any</td><td>any</td></tr>
<tr><td>When to use</td><td>early development</td><td>general usage</td><td>working with timeseries</td></tr>
<tr><td>Performance</td><td>good</td><td>better</td><td>great in some scenarios</td></tr>
<tr><td>SQL scripts</td><td>❌</td><td>✅</td><td>✅</td></tr>
<tr><td>Immune tables*</td><td>❌</td><td>✅</td><td>✅</td></tr>
<tr><td>Hasura integration</td><td>❌</td><td>✅**</td><td>✅**</td></tr>
</tbody></table>
<p>* — see <a href="deployment/../config/database.html#immune-tables"><code>immune_tables</code> config reference</a> for details.</p>
<p>** — schema name must be <code>public</code></p>
<p>While sometimes it's convenient to use one database engine for development and another one for production, be careful with specific column types that behave differently in various engines.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="building-docker-images"><a class="header" href="#building-docker-images">Building Docker images</a></h1>
<pre><code class="language-Dockerfile">FROM dipdup/dipdup:5.0.0

# Uncomment if you have an additional dependencies in pyproject.toml
# COPY pyproject.toml poetry.lock ./
# RUN inject_pyproject

COPY indexer indexer
COPY dipdup.yml dipdup.prod.yml ./
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="docker-compose"><a class="header" href="#docker-compose">Docker compose</a></h1>
<p>Make sure you have <a href="https://docs.docker.com/get-docker/">docker</a> run and <a href="https://docs.docker.com/compose/install/">docker-compose</a> installed.</p>
<p>Example <code>docker-compose.yml</code> file:</p>
<pre><code class="language-yaml">version: &quot;3.8&quot;

services:
  indexer:
    build: .
    depends_on:
      - db
    command: [&quot;-c&quot;, &quot;dipdup.yml&quot;, &quot;-c&quot;, &quot;dipdup.prod.yml&quot;, &quot;run&quot;]
    restart: &quot;no&quot;
    environment:
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD:-changeme}
      - ADMIN_SECRET=${ADMIN_SECRET:-changeme}
    volumes:
      - ./dipdup.yml:/home/dipdup/dipdup.yml
      - ./dipdup.prod.yml:/home/dipdup/dipdup.prod.yml
      - ./indexer:/home/dipdup/indexer
    ports:
      - 127.0.0.1:9000:9000

  db:
    image: timescale/timescaledb:latest-pg13
    ports:
      - 127.0.0.1:5432:5432
    volumes:
      - db:/var/lib/postgresql/data
    environment:
      - POSTGRES_USER=dipdup
      - POSTGRES_DB=dipdup
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD:-changeme}
    healthcheck:
      test: [&quot;CMD-SHELL&quot;, &quot;pg_isready -U postgres&quot;]
      interval: 10s
      timeout: 5s
      retries: 5
    deploy:
      mode: replicated
      replicas: 1

  hasura:
    image: hasura/graphql-engine:v2.8.3
    ports:
      - 127.0.0.1:8080:8080
    depends_on:
      - db
    restart: always
    environment:
      - HASURA_GRAPHQL_DATABASE_URL=postgres://dipdup:${POSTGRES_PASSWORD:-changeme}@db:5432/dipdup
      - HASURA_GRAPHQL_ENABLE_CONSOLE=true
      - HASURA_GRAPHQL_DEV_MODE=true
      - HASURA_GRAPHQL_ENABLED_LOG_TYPES=startup, http-log, webhook-log, websocket-log, query-log
      - HASURA_GRAPHQL_ADMIN_SECRET=${ADMIN_SECRET:-changeme}
      - HASURA_GRAPHQL_UNAUTHORIZED_ROLE=user
      - HASURA_GRAPHQL_STRINGIFY_NUMERIC_TYPES=true

volumes:
  db:
</code></pre>
<p>Environment variables are expanded in the DipDup config file; Postgres password and Hasura secret are forwarded in this example.</p>
<p>Create a separate <code>dipdup.&lt;environment&gt;.yml</code> file for this stack:</p>
<pre><code class="language-yaml">database:
  kind: postgres
  host: db
  port: 5432
  user: dipdup
  password: ${POSTGRES_PASSWORD:-changeme}
  database: dipdup
  schema_name: demo

hasura:
  url: http://hasura:8080
  admin_secret: ${ADMIN_SECRET:-changeme}
  allow_aggregations: False
  camel_case: true
  select_limit: 100
</code></pre>
<p>Note the hostnames (resolved in the docker network) and environment variables (expanded by DipDup).</p>
<p>Build and run the containers:</p>
<pre><code class="language-shell">docker-compose up -d --build
</code></pre>
<p>We recommend <a href="https://github.com/jesseduffield/lazydocker">lazydocker</a> for monitoring your application.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="deploying-with-docker-swarm"><a class="header" href="#deploying-with-docker-swarm">Deploying with Docker Swarm</a></h1>
<blockquote>
<p>🚧 <strong>UNDER CONSTRUCTION</strong></p>
<p>This page or paragraph is yet to be written. Come back later.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sentry-integration"><a class="header" href="#sentry-integration">Sentry integration</a></h1>
<p>Sentry is an error tracking software that can be used either as a service or on-premise. It dramatically improves the troubleshooting experience and requires nearly zero configuration. To start catching exceptions with Sentry in your project, add the following section in <code>dipdup.yml</code> config:</p>
<pre><code class="language-yaml">sentry:
  dsn: https://...
  environment: dev
  debug: False
</code></pre>
<p>You can obtain Sentry DSN from the web interface at <em>Settings -&gt; Projects -&gt; &lt;project_name&gt; -&gt; Client Keys (DSN)</em>. The cool thing is that if you catch an exception and suspect there's a bug in DipDup, you can share this event with us using a public link (created at <em>Share</em> menu).</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="prometheus-integration"><a class="header" href="#prometheus-integration">Prometheus integration</a></h1>
<h2 id="available-metrics"><a class="header" href="#available-metrics">Available metrics</a></h2>
<p>The following metrics will be exposed:</p>
<table><thead><tr><th>metric name</th><th>description</th></tr></thead><tbody>
<tr><td><code>dipdup_indexes_total</code></td><td>Number of indexes in operation by status</td></tr>
<tr><td><code>dipdup_index_level_sync_duration_seconds</code></td><td>Duration of indexing a single level</td></tr>
<tr><td><code>dipdup_index_level_realtime_duration_seconds</code></td><td>Duration of last index syncronization</td></tr>
<tr><td><code>dipdup_index_total_sync_duration_seconds</code></td><td>Duration of the last index syncronization</td></tr>
<tr><td><code>dipdup_index_total_realtime_duration_seconds</code></td><td>Duration of the last index realtime syncronization</td></tr>
<tr><td><code>dipdup_index_levels_to_sync_total</code></td><td>Number of levels to reach synced state</td></tr>
<tr><td><code>dipdup_index_levels_to_realtime_total</code></td><td>Number of levels to reach realtime state</td></tr>
<tr><td><code>dipdup_index_handlers_matched_total</code></td><td>Index total hits</td></tr>
<tr><td><code>dipdup_datasource_head_updated_timestamp</code></td><td>Timestamp of the last head update</td></tr>
<tr><td><code>dipdup_datasource_rollbacks_total</code></td><td>Number of rollbacks</td></tr>
<tr><td><code>dipdup_http_errors_total</code></td><td>Number of http errors</td></tr>
<tr><td><code>dipdup_callback_duration_seconds</code></td><td>Duration of callback execution</td></tr>
</tbody></table>
<div style="break-before: page; page-break-before: always;"></div><h1 id="logging"><a class="header" href="#logging">Logging</a></h1>
<p>To control the number of logs DipDup produces, set the <code>logging</code> field in config:</p>
<pre><code class="language-yaml">logging: default|verbose|quiet
</code></pre>
<p>If you need more fined tuning, perform it in the <code>on_restart</code> hook:</p>
<pre><code class="language-python">import logging

async def on_restart(
    ctx: HookContext,
) -&gt; None:
    logging.getLogger('some_logger').setLevel('DEBUG')
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="monitoring"><a class="header" href="#monitoring">Monitoring</a></h1>
<blockquote>
<p>🚧 <strong>UNDER CONSTRUCTION</strong></p>
<p>This page or paragraph is yet to be written. Come back later.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="backup-and-restore"><a class="header" href="#backup-and-restore">Backup and restore</a></h1>
<p>DipDup has no built-in functionality to backup and restore database at the moment. Good news is that DipDup indexes are <strong>fully atomic</strong>. That means you can perform backup with regular <code>psql</code>/<code>pgdump</code> regardless of the DipDup state.</p>
<p>This page contains several recipes for backup/restore.</p>
<h2 id="scheduled-backup-to-s3"><a class="header" href="#scheduled-backup-to-s3">Scheduled backup to S3</a></h2>
<p>This example is for Swarm deployments. We use this solution to backup our services in production. Adapt it to your needs if needed.</p>
<pre><code class="language-yaml">version: &quot;3.8&quot;
services:
  indexer:
    ...
  db:
    ...
  hasura:
    ...

  backuper:
    image: ghcr.io/dipdup-net/postgres-s3-backup:master
    environment:
      - S3_ENDPOINT=${S3_ENDPOINT:-https://fra1.digitaloceanspaces.com}
      - S3_ACCESS_KEY_ID=${S3_ACCESS_KEY_ID}
      - S3_SECRET_ACCESS_KEY=${S3_SECRET_ACCESS_KEY}
      - S3_BUCKET=dipdup
      - S3_PATH=dipdup
      - S3_FILENAME=${SERVICE}-postgres
      - PG_BACKUP_FILE=${PG_BACKUP_FILE}
      - PG_BACKUP_ACTION=${PG_BACKUP_ACTION:-dump}
      - PG_RESTORE_JOBS=${PG_RESTORE_JOBS:-8}
      - POSTGRES_USER=${POSTGRES_USER:-dipdup}
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD:-changeme}
      - POSTGRES_DB=${POSTGRES_DB:-dipdup}
      - POSTGRES_HOST=${POSTGRES_HOST:-db}
      - HEARTBEAT_URI=${HEARTBEAT_URI}
      - SCHEDULE=${SCHEDULE}
    deploy:
      mode: replicated
      replicas: ${BACKUP_ENABLED:-0}
      restart_policy:
        condition: on-failure
        delay: 10s
        max_attempts: 5
        window: 120s
      placement: *placement
    networks:
      - internal
    logging: *logging

</code></pre>
<h2 id="automatic-restore-on-rollback"><a class="header" href="#automatic-restore-on-rollback">Automatic restore on rollback</a></h2>
<p>This awesome code was contributed by <a href="https://github.com/852Kerfunkle">@852Kerfunkle</a>, author of <a href="https://github.com/tz1and/">tz1and</a> project.</p>
<p><code>&lt;project&gt;/backups.py</code></p>
<pre><code class="language-python">...

def backup(level: int, database_config: PostgresDatabaseConfig):
    ...

    with open('backup.sql', 'wb') as f:
        try:
            err_buf = StringIO()
            pg_dump('-d', f'postgresql://{database_config.user}:{database_config.password}@{database_config.host}:{database_config.port}/{database_config.database}', '--clean',
                '-n', database_config.schema_name, _out=f, _err=err_buf) #, '-E', 'UTF8'
        except ErrorReturnCode:
            err = err_buf.getvalue()
            _logger.error(f'Database backup failed: {err}')


def restore(level: int, database_config: PostgresDatabaseConfig):
    ...

    with open('backup.sql', 'r') as f:
        try:
            err_buf = StringIO()
            psql('-d', f'postgresql://{database_config.user}:{database_config.password}@{database_config.host}:{database_config.port}/{database_config.database}',
                '-n', database_config.schema_name, _in=f, _err=err_buf)
        except ErrorReturnCode:
            err = err_buf.getvalue()
            _logger.error(f'Database restore failed: {err}')
            raise Exception(&quot;Failed to restore&quot;)

def get_available_backups():
    ...


def delete_old_backups():
    ...
</code></pre>
<p><code>&lt;project&gt;/hooks/on_index_rollback.py</code></p>
<pre><code class="language-python">...

async def on_index_rollback(
    ctx: HookContext,
    index: Index,
    from_level: int,
    to_level: int,
) -&gt; None:
    await ctx.execute_sql('on_index_rollback')

    database_config: Union[SqliteDatabaseConfig, PostgresDatabaseConfig] = ctx.config.database

    # if not a postgres db, reindex.
    if database_config.kind != &quot;postgres&quot;:
        await ctx.reindex(ReindexingReason.ROLLBACK)

    available_levels = backups.get_available_backups()

    # if no backups available, reindex
    if not available_levels:
        await ctx.reindex(ReindexingReason.ROLLBACK)

    # find the right level. ie the on that's closest to to_level
    chosen_level = 0
    for level in available_levels:
        if level &lt;= to_level and level &gt; chosen_level:
            chosen_level = level

    # try to restore or reindex
    try:
        backups.restore(chosen_level, database_config)
        await ctx.restart()
    except Exception:
        await ctx.reindex(ReindexingReason.ROLLBACK)
</code></pre>
<p><code>&lt;project&gt;/hooks/run_backups.py</code></p>
<pre><code class="language-python">...

async def run_backups(
    ctx: HookContext,
) -&gt; None:
    database_config: Union[SqliteDatabaseConfig, PostgresDatabaseConfig] = ctx.config.database

    if database_config.kind != &quot;postgres&quot;:
        return

    level = ctx.get_tzkt_datasource(&quot;tzkt_mainnet&quot;)._level.get(MessageType.head)

    if level is None:
        return

    backups.backup(level, database_config)
    backups.delete_old_backups()
</code></pre>
<p><code>&lt;project&gt;/hooks/simulate_reorg.py</code></p>
<pre><code class="language-python">...

async def simulate_reorg(
    ctx: HookContext
) -&gt; None:
    level = ctx.get_tzkt_datasource(&quot;tzkt_mainnet&quot;)._level.get(MessageType.head)

    if level:
        await ctx.fire_hook(
            &quot;on_index_rollback&quot;,
            wait=True
            index=None,  # type: ignore
            from_level=level,
            to_level=level - 2,
        )
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cookbook"><a class="header" href="#cookbook">Cookbook</a></h1>
<blockquote>
<p>🚧 <strong>UNDER CONSTRUCTION</strong></p>
<p>This page or paragraph is yet to be written. Come back later.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="processing-offchain-data"><a class="header" href="#processing-offchain-data">Processing offchain data</a></h1>
<blockquote>
<p>🚧 <strong>UNDER CONSTRUCTION</strong></p>
<p>This page or paragraph is yet to be written. Come back later.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="reusing-typename-for-different-contracts"><a class="header" href="#reusing-typename-for-different-contracts">Reusing typename for different contracts</a></h1>
<p>In some cases, you may want to make some manual changes in typeclasses and ensure they won't be lost on init. Let's say you want to reuse typename for multiple contracts providing the same interface (like FA1.2 and FA2 tokens) but having different storage structure. You can comment out differing fields which are not important for your index.</p>
<p><code>types/contract_typename/storage.py</code></p>
<pre><code class="language-python"># dipdup: ignore

...

class ContractStorage(BaseModel):
    class Config:
        extra = Extra.ignore

    some_common_big_map: Dict[str, str]
    # unique_big_map_a: Dict[str, str]
    # unique_big_map_b: Dict[str, str]
</code></pre>
<p>Don't forget <code>Extra.ignore</code> Pydantic hint, otherwise indexing will fail. Files starting with <code># dipdup: ignore</code> won't be overwritten on init.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="synchronizing-multiple-handlershooks"><a class="header" href="#synchronizing-multiple-handlershooks">Synchronizing multiple handlers/hooks</a></h1>
<blockquote>
<p>🚧 <strong>UNDER CONSTRUCTION</strong></p>
<p>This page or paragraph is yet to be written. Come back later.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="multiprocessing"><a class="header" href="#multiprocessing">Multiprocessing</a></h1>
<p>It's impossible to use <code>apscheduler</code> pool executors with hooks because <code>HookContext</code> is not pickle-serializable. So, they are forbidden now in <code>advanced.scheduler</code> config. However, thread/process pools can come in handy in many situations, and it would be nice to have them in DipDup context. For now, I can suggest implementing custom commands as a workaround to perform any resource-hungry tasks within them. Put the following code in <code>&lt;project&gt;/cli.py</code>:</p>
<pre><code class="language-python">from contextlib import AsyncExitStack

import asyncclick as click
from dipdup.cli import cli, cli_wrapper
from dipdup.config import DipDupConfig
from dipdup.context import DipDupContext
from dipdup.utils.database import tortoise_wrapper


@cli.command(help='Run heavy calculations')
@click.pass_context
@cli_wrapper
async def do_something_heavy(ctx):
    config: DipDupConfig = ctx.obj.config
    url = config.database.connection_string
    models = f'{config.package}.models'

    async with AsyncExitStack() as stack:
        await stack.enter_async_context(tortoise_wrapper(url, models))
        ...

if __name__ == '__main__':
    cli(prog_name='dipdup', standalone_mode=False)  # type: ignore
</code></pre>
<p>Then use <code>python -m &lt;project&gt;.cli</code> instead of <code>dipdup</code> as an entrypoint. Now you can call <code>do-something-heavy</code> like any other <code>dipdup</code> command. <code>dipdup.cli:cli</code> group handles arguments and config parsing, graceful shutdown, and other boilerplate. The rest is on you; use <code>dipdup.dipdup:DipDup.run</code> as a reference. And keep in mind that Tortoise ORM is not thread-safe. I aim to implement <code>ctx.pool_apply</code> and <code>ctx.pool_map</code> methods to execute code in pools with <em>magic</em> within existing DipDup hooks, but no ETA yet.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="examples"><a class="header" href="#examples">Examples</a></h1>
<blockquote>
<p>🚧 <strong>UNDER CONSTRUCTION</strong></p>
<p>This page or paragraph is yet to be written. Come back later.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="demo-projects"><a class="header" href="#demo-projects">Demo projects</a></h1>
<p>Here are several minimal examples how to use various DipDup features for a real case scenario:</p>
<ul>
<li><a href="https://github.com/dipdup-net/dipdup-py/tree/master/src/demo_hic_et_nunc">Hic-et-nunc</a></li>
<li><a href="https://github.com/dipdup-net/dipdup-py/tree/master/src/demo_quipuswap">Quipuswap</a></li>
<li><a href="https://github.com/dipdup-net/dipdup-py/tree/master/src/demo_registrydao">RegistryDAO</a></li>
<li><a href="https://github.com/dipdup-net/dipdup-py/tree/master/src/demo_tezos_domains_big_map">Tezos domains</a></li>
<li><a href="https://github.com/dipdup-net/dipdup-py/tree/master/src/demo_tzcolors">Tzcolors</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="built-with-dipdup"><a class="header" href="#built-with-dipdup">Built with DipDup</a></h1>
<p>This page is a brief overview of projects which use DipDup as an indexing solution.</p>
<p>Want to see your project at this page? Create an issue on <a href="https://github.com/dipdup-net/dipdup-docs/issues">GitHub</a>!</p>
<h2 id="hicdex"><a class="header" href="#hicdex">HicDEX</a></h2>
<p><a href="https://hicdex.com/">Homepage</a> | <a href="https://api.hicdex.com/graphiql/">API</a> | <a href="https://github.com/hicdex/hicdex">GitHub</a></p>
<p>HicDEX is a Tezos indexer for hicetnunc.art marketplace. Indexed data is available with a public GraphQL endpoint.</p>
<ul>
<li><a href="https://leonnicholls.medium.com/hicdex-the-hic-et-nunc-indexer-bd45f27a228f">Hicdex: the Hic Et Nunc indexer (Medium)</a></li>
</ul>
<h2 id="homebase"><a class="header" href="#homebase">Homebase</a></h2>
<p><a href="https://tezos-homebase.io/">Homepage</a> | <a href="https://github.com/dOrgTech/homebase-app">GitHub</a></p>
<p>Homebase is a web application that enables users to create and manage/use DAOs on the Tezos blockchain. This application aims to help empower community members and developers to launch and participate in Tezos-based DAOs.</p>
<h2 id="tezos-profiles"><a class="header" href="#tezos-profiles">Tezos Profiles</a></h2>
<p><a href="https://tzprofiles.com/">Homepage</a> | <a href="https://dipdup.net/sandbox.html?service=tzprofiles">API</a> | <a href="https://github.com/spruceid/tzprofiles">GitHub</a></p>
<p>Tezos Profiles enables you to associate your online identity with your Tezos account.</p>
<h2 id="juster"><a class="header" href="#juster">Juster</a></h2>
<p><a href="https://app.juster.fi">Homepage</a> | <a href="https://dipdup.net/sandbox.html?service=juster">API</a> | <a href="https://github.com/juster-finance/juster-dipdup">GitHub</a></p>
<p>Juster is an on-chain smart contract platform allowing users to take part in an automated betting market by creating events, providing liquidity to them, and making bets.</p>
<h2 id="tz1and"><a class="header" href="#tz1and">tz1and</a></h2>
<p>A Virtual World and NFT Marketplace.</p>
<p><a href="https://www.tz1and.com/">Homepage</a> | <a href="https://indexer.tz1and.com/v1/graphql">API</a> | <a href="https://github.com/tz1and/tezland-indexer">GitHub</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="services-plugins"><a class="header" href="#services-plugins">Services (plugins)</a></h1>
<p>Services are standalone companion indexers written in Go.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="mempool"><a class="header" href="#mempool">mempool</a></h1>
<p>This is an optional section used by the <a href="https://github.com/dipdup-net/mempool">mempool</a> indexer plugin. It uses <a href="services/../config/contracts.html"><code>contracts</code></a> and <a href="services/../config/datasources.html"><code>datasources</code></a> aliases as well as the <a href="services/../config/database.html"><code>database</code></a> connection.</p>
<p>Mempool configuration has two sections: <code>settings</code> and <code>indexers</code> (required).</p>
<p>{% page-ref page=&quot;../advanced/mempool-plugin.md&quot; %}</p>
<h2 id="settings"><a class="header" href="#settings">Settings</a></h2>
<p>This section is optional so are all the setting keys.</p>
<pre><code class="language-yaml">mempool:
  settings:
    keep_operations_seconds: 172800
    expired_after_blocks: 60
    keep_in_chain_blocks: 10
    mempool_request_interval_seconds: 10
    rpc_timeout_seconds: 10
  indexers:
    ...
</code></pre>
<h3 id="keep_operations_seconds"><a class="header" href="#keep_operations_seconds">keep_operations_seconds</a></h3>
<p>How long to store operations that did not get into the chain. After that period, such operations will be wiped from the database. Default value is <strong>172800</strong> <strong>seconds</strong> (2 days).</p>
<h3 id="expired_after_blocks"><a class="header" href="#expired_after_blocks">expired_after_blocks</a></h3>
<p>When <code>level(head) - level(operation.branch) &gt;= expired_after_blocks</code> and operation is still on in chain it's marked as expired. Default value is <strong>60 blocks</strong> (~1 hour).</p>
<h3 id="keep_in_chain_blocks"><a class="header" href="#keep_in_chain_blocks">keep_in_chain_blocks</a></h3>
<p>Since the main purpose of this plugin is to index mempool operations (actually it's a rolling index), all the operations that were included in the chain are removed from the database after specified period of time. Default value is <strong>10 blocks</strong> (~10 minutes).</p>
<h3 id="mempool_request_interval_seconds"><a class="header" href="#mempool_request_interval_seconds">mempool_request_interval_seconds</a></h3>
<p>How often Tezos nodes should be polled for pending mempool operations. Default value is <strong>10 seconds</strong>.</p>
<h3 id="rpc_timeout_seconds"><a class="header" href="#rpc_timeout_seconds">rpc_timeout_seconds</a></h3>
<p>Tezos node request timeout. Default value is <strong>10 seconds</strong>.</p>
<h2 id="indexers"><a class="header" href="#indexers">Indexers</a></h2>
<p>You can index several networks at once, or index different nodes independently. Indexer names are not standardized, but for clarity it's better to stick with some meaningful keys:</p>
<pre><code class="language-yaml"> mempool:
   settings:
     ...
   indexers:
     mainnet:
       filters:
         kinds:
           - transaction
         accounts:
           - contract_alias
       datasources:
         tzkt: tzkt_mainnet
         rpc: 
           - node_mainnet
     edonet:
     florencenet: 
</code></pre>
<p>Each indexer object has two keys: <code>filters</code> and <code>datasources</code> (required).</p>
<h3 id="filters"><a class="header" href="#filters">Filters</a></h3>
<p>An optional section specifying which mempool operations should be indexed. By default all transactions will be indexed.</p>
<h4 id="kinds"><a class="header" href="#kinds">kinds</a></h4>
<p>Array of operations kinds, default value is <code>transaction</code> (single item).<br />
The complete list of values allowed:</p>
<ul>
<li><code>activate_account</code></li>
<li><code>ballot</code></li>
<li><code>delegation*</code></li>
<li><code>double_baking_evidence</code></li>
<li><code>double_endorsement_evidence</code></li>
<li><code>endorsement</code></li>
<li><code>origination*</code></li>
<li><code>proposal</code></li>
<li><code>reveal*</code></li>
<li><code>seed_nonce_revelation</code></li>
<li><code>transaction*</code></li>
</ul>
<p><code>*</code>  — manager operations.</p>
<h4 id="accounts"><a class="header" href="#accounts">accounts</a></h4>
<p>Array of <a href="services/../config/contracts.html">contract</a> aliases used to filter operations by source or destination.<br />
<strong>NOTE</strong>: applied to manager operations only.</p>
<h3 id="datasources-1"><a class="header" href="#datasources-1">Datasources</a></h3>
<p>Mempool plugin is tightly coupled with <a href="services/../config/datasources.html#tzkt">TzKT</a> and <a href="services/../config/datasources.html#tezos-node">Tezos node</a> providers.</p>
<h4 id="tzkt-1"><a class="header" href="#tzkt-1">tzkt</a></h4>
<p>An alias pointing to a <a href="services/../config/datasources.html">datasource</a> of kind <code>tzkt</code> is expected.</p>
<h4 id="rpc"><a class="header" href="#rpc">rpc</a></h4>
<p>An array of aliases pointing to <a href="services/../config/datasources.html">datasources</a> of kind <code>tezos-node</code><br />
Polling multiple nodes allows to detect more refused operations and makes indexing more robust in general.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="metadata"><a class="header" href="#metadata">metadata</a></h1>
<p>This is an optional section used by the <a href="https://github.com/dipdup-net/metadata">metadata</a> indexer plugin. It uses <a href="services/../config/contracts.html"><code>contracts</code></a> and <a href="services/../config/datasources.html"><code>datasources</code></a> aliases as well as the <a href="services/../config/database.html"><code>database</code></a> connection.</p>
<p>Metadata configuration has two required sections: <code>settings</code> and <code>indexers</code></p>
<h2 id="settings-1"><a class="header" href="#settings-1">Settings</a></h2>
<pre><code class="language-yaml">metadata:
  settings:
    ipfs_gateways:
      - https://cloudflare-ipfs.com
    ipfs_timeout: 10
    http_timeout: 10
    max_retry_count_on_error: 3
    contract_service_workers: 15
    token_service_workers: 75
  indexers:
    ...
</code></pre>
<h3 id="ipfs_gateways"><a class="header" href="#ipfs_gateways">ipfs_gateways</a></h3>
<p>An array of IPFS gateways. The indexer polls them sequentially until it gets a result or runs out of attempts. It is recommended to specify more than one gateway to overcome propagation issues, rate limits, and other problems.</p>
<h3 id="ipfs_timeout"><a class="header" href="#ipfs_timeout">ipfs_timeout</a></h3>
<p>How long DipDup will wait for a single IPFS gateway response. Default value is <strong>10 seconds</strong>.</p>
<h3 id="http_timeout"><a class="header" href="#http_timeout">http_timeout</a></h3>
<p>How long DipDup will wait for a HTTP server response. Default value is <strong>10 seconds</strong>.</p>
<h3 id="max_retry_count_on_error"><a class="header" href="#max_retry_count_on_error">max_retry_count_on_error</a></h3>
<p>If DipDup fails to get a response from IPFS gateway or HTTP server, it will try again after some time, until it runs out of attempts. Default value is <strong>3 attempts</strong>.</p>
<h3 id="contract_service_workers"><a class="header" href="#contract_service_workers">contract_service_workers</a></h3>
<p>Count of contract service workers which resolves contract metadata. Default value is 5.</p>
<h3 id="token_service_workers"><a class="header" href="#token_service_workers">token_service_workers</a></h3>
<p>Count of token service workers which resolves token metadata. Default value is 5.</p>
<h2 id="indexers-1"><a class="header" href="#indexers-1">Indexers</a></h2>
<p>You can index several networks at once, or go with a single one. Indexer names are not standardized, but for clarity it's better to stick with some meaningful keys:</p>
<pre><code class="language-yaml">metadata:
  settings:
    ...
  indexers:
    mainnet:
      filters:
        accounts:
          - contract_alias
      datasources:
        tzkt: tzkt_mainnet
</code></pre>
<p>Each indexer object has two keys: <code>filters</code> and <code>datasources</code> (required).</p>
<h3 id="filters-1"><a class="header" href="#filters-1">Filters</a></h3>
<h4 id="accounts-1"><a class="header" href="#accounts-1">accounts</a></h4>
<p>Array of <a href="services/../config/contracts.html">contract</a> aliases used to filter Big_map updates by the owner contract address.</p>
<h3 id="datasources-2"><a class="header" href="#datasources-2">Datasources</a></h3>
<p>Metadata plugin is tightly coupled with <a href="services/../config/datasources.html#tzkt">TzKT</a> provider.</p>
<h4 id="tzkt-2"><a class="header" href="#tzkt-2">tzkt</a></h4>
<p>An alias pointing to a <a href="services/../config/datasources.html">datasource</a> of kind <code>tzkt</code> is expected.</p>
<div style="break-before: page; page-break-before: always;"></div><section id="dipdup">
<h1 id="dipdup"><a class="header" href="#dipdup">dipdup<a class="headerlink" href="cli-reference.html#dipdup" title="Permalink to this headline">¶</a></a></h1>
<p>Manage and run DipDup indexers.</p>
<p>Full docs: <a class="reference external" href="https://dipdup.net/docs">https://dipdup.net/docs</a></p>
<p>Report an issue: <a class="reference external" href="https://github.com/dipdup-net/dipdup-py/issues">https://github.com/dipdup-net/dipdup-py/issues</a></p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>dipdup <span class="o">[</span>OPTIONS<span class="o">]</span> COMMAND <span class="o">[</span>ARGS<span class="o">]</span>...
</pre></div>
</div>
<p class="rubric">Options</p>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dipdup-version">
<span class="sig-name descname"><span class="pre">--version</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="cli-reference.html#cmdoption-dipdup-version" title="Permalink to this definition">¶</a></dt>
<dd><p>Show the version and exit.</p>
</dd></dl>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dipdup-c">
<span id="cmdoption-dipdup-config"></span><span class="sig-name descname"><span class="pre">-c</span></span><span class="sig-prename descclassname"></span><span class="sig-prename descclassname"><span class="pre">,</span> </span><span class="sig-name descname"><span class="pre">--config</span></span><span class="sig-prename descclassname"> <span class="pre">&lt;config&gt;</span></span><a class="headerlink" href="cli-reference.html#cmdoption-dipdup-c" title="Permalink to this definition">¶</a></dt>
<dd><p>A path to DipDup project config (default: dipdup.yml).</p>
</dd></dl>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dipdup-e">
<span id="cmdoption-dipdup-env-file"></span><span class="sig-name descname"><span class="pre">-e</span></span><span class="sig-prename descclassname"></span><span class="sig-prename descclassname"><span class="pre">,</span> </span><span class="sig-name descname"><span class="pre">--env-file</span></span><span class="sig-prename descclassname"> <span class="pre">&lt;env_file&gt;</span></span><a class="headerlink" href="cli-reference.html#cmdoption-dipdup-e" title="Permalink to this definition">¶</a></dt>
<dd><p>A path to .env file containing <cite>KEY=value</cite> strings.</p>
</dd></dl>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dipdup-l">
<span id="cmdoption-dipdup-logging-config"></span><span class="sig-name descname"><span class="pre">-l</span></span><span class="sig-prename descclassname"></span><span class="sig-prename descclassname"><span class="pre">,</span> </span><span class="sig-name descname"><span class="pre">--logging-config</span></span><span class="sig-prename descclassname"> <span class="pre">&lt;logging_config&gt;</span></span><a class="headerlink" href="cli-reference.html#cmdoption-dipdup-l" title="Permalink to this definition">¶</a></dt>
<dd><p>A path to Python logging config in YAML format.</p>
</dd></dl>
<section id="dipdup-cache">
<h2 id="cache"><a class="header" href="#cache">cache<a class="headerlink" href="cli-reference.html#dipdup-cache" title="Permalink to this headline">¶</a></a></h2>
<p>Manage internal cache.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>dipdup cache <span class="o">[</span>OPTIONS<span class="o">]</span> COMMAND <span class="o">[</span>ARGS<span class="o">]</span>...
</pre></div>
</div>
<section id="dipdup-cache-clear">
<h3 id="clear"><a class="header" href="#clear">clear<a class="headerlink" href="cli-reference.html#dipdup-cache-clear" title="Permalink to this headline">¶</a></a></h3>
<p>Clear request cache of DipDup datasources.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>dipdup cache clear <span class="o">[</span>OPTIONS<span class="o">]</span>
</pre></div>
</div>
</section>
<section id="dipdup-cache-show">
<h3 id="show"><a class="header" href="#show">show<a class="headerlink" href="cli-reference.html#dipdup-cache-show" title="Permalink to this headline">¶</a></a></h3>
<p>Show information about DipDup disk caches.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>dipdup cache show <span class="o">[</span>OPTIONS<span class="o">]</span>
</pre></div>
</div>
</section>
</section>
<section id="dipdup-config">
<h2 id="config"><a class="header" href="#config">config<a class="headerlink" href="cli-reference.html#dipdup-config" title="Permalink to this headline">¶</a></a></h2>
<p>Commands to manage DipDup configuration.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>dipdup config <span class="o">[</span>OPTIONS<span class="o">]</span> COMMAND <span class="o">[</span>ARGS<span class="o">]</span>...
</pre></div>
</div>
<section id="dipdup-config-env">
<h3 id="env"><a class="header" href="#env">env<a class="headerlink" href="cli-reference.html#dipdup-config-env" title="Permalink to this headline">¶</a></a></h3>
<p>Dump environment variables used in DipDup config.</p>
<p>If variable is not set, default value will be used.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>dipdup config env <span class="o">[</span>OPTIONS<span class="o">]</span>
</pre></div>
</div>
<p class="rubric">Options</p>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dipdup-config-env-f">
<span id="cmdoption-dipdup-config-env-file"></span><span class="sig-name descname"><span class="pre">-f</span></span><span class="sig-prename descclassname"></span><span class="sig-prename descclassname"><span class="pre">,</span> </span><span class="sig-name descname"><span class="pre">--file</span></span><span class="sig-prename descclassname"> <span class="pre">&lt;file&gt;</span></span><a class="headerlink" href="cli-reference.html#cmdoption-dipdup-config-env-f" title="Permalink to this definition">¶</a></dt>
<dd><p>Output to file instead of stdout.</p>
</dd></dl>
</section>
<section id="dipdup-config-export">
<h3 id="export"><a class="header" href="#export">export<a class="headerlink" href="cli-reference.html#dipdup-config-export" title="Permalink to this headline">¶</a></a></h3>
<p>Print config after resolving all links and templates.</p>
<p>WARNING: Avoid sharing output with 3rd-parties when <cite>–unsafe</cite> flag set - it may contain secrets!</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>dipdup config <span class="nb">export</span> <span class="o">[</span>OPTIONS<span class="o">]</span>
</pre></div>
</div>
<p class="rubric">Options</p>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dipdup-config-export-unsafe">
<span class="sig-name descname"><span class="pre">--unsafe</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="cli-reference.html#cmdoption-dipdup-config-export-unsafe" title="Permalink to this definition">¶</a></dt>
<dd><p>Resolve environment variables or use default values from config.</p>
</dd></dl>
</section>
</section>
<section id="dipdup-hasura">
<h2 id="hasura"><a class="header" href="#hasura">hasura<a class="headerlink" href="cli-reference.html#dipdup-hasura" title="Permalink to this headline">¶</a></a></h2>
<p>Hasura integration related commands.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>dipdup hasura <span class="o">[</span>OPTIONS<span class="o">]</span> COMMAND <span class="o">[</span>ARGS<span class="o">]</span>...
</pre></div>
</div>
<section id="dipdup-hasura-configure">
<h3 id="configure"><a class="header" href="#configure">configure<a class="headerlink" href="cli-reference.html#dipdup-hasura-configure" title="Permalink to this headline">¶</a></a></h3>
<p>Configure Hasura GraphQL Engine to use with DipDup.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>dipdup hasura configure <span class="o">[</span>OPTIONS<span class="o">]</span>
</pre></div>
</div>
<p class="rubric">Options</p>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dipdup-hasura-configure-force">
<span class="sig-name descname"><span class="pre">--force</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="cli-reference.html#cmdoption-dipdup-hasura-configure-force" title="Permalink to this definition">¶</a></dt>
<dd><p>Proceed even if Hasura is already configured.</p>
</dd></dl>
</section>
</section>
<section id="dipdup-init">
<h2 id="init"><a class="header" href="#init">init<a class="headerlink" href="cli-reference.html#dipdup-init" title="Permalink to this headline">¶</a></a></h2>
<p>Generate project tree, missing callbacks and types.</p>
<p>This command is idempotent, meaning it won’t overwrite previously generated files unless asked explicitly.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>dipdup init <span class="o">[</span>OPTIONS<span class="o">]</span>
</pre></div>
</div>
<p class="rubric">Options</p>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dipdup-init-overwrite-types">
<span class="sig-name descname"><span class="pre">--overwrite-types</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="cli-reference.html#cmdoption-dipdup-init-overwrite-types" title="Permalink to this definition">¶</a></dt>
<dd><p>Regenerate existing types.</p>
</dd></dl>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dipdup-init-keep-schemas">
<span class="sig-name descname"><span class="pre">--keep-schemas</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="cli-reference.html#cmdoption-dipdup-init-keep-schemas" title="Permalink to this definition">¶</a></dt>
<dd><p>Do not remove JSONSchemas after generating types.</p>
</dd></dl>
</section>
<section id="dipdup-migrate">
<h2 id="migrate"><a class="header" href="#migrate">migrate<a class="headerlink" href="cli-reference.html#dipdup-migrate" title="Permalink to this headline">¶</a></a></h2>
<p>Migrate project to the new spec version.</p>
<p>If you’re getting <cite>MigrationRequiredError</cite> after updating DipDup, this command will fix imports and type annotations to match the current <cite>spec_version</cite>. Review and commit changes after running it.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>dipdup migrate <span class="o">[</span>OPTIONS<span class="o">]</span>
</pre></div>
</div>
</section>
<section id="dipdup-run">
<h2 id="run"><a class="header" href="#run">run<a class="headerlink" href="cli-reference.html#dipdup-run" title="Permalink to this headline">¶</a></a></h2>
<p>Run indexer.</p>
<p>Execution can be gracefully interrupted with <cite>Ctrl+C</cite> or <cite>SIGTERM</cite> signal.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>dipdup run <span class="o">[</span>OPTIONS<span class="o">]</span>
</pre></div>
</div>
<p class="rubric">Options</p>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dipdup-run-postpone-jobs">
<span class="sig-name descname"><span class="pre">--postpone-jobs</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="cli-reference.html#cmdoption-dipdup-run-postpone-jobs" title="Permalink to this definition">¶</a></dt>
<dd><p>Do not start job scheduler until all indexes are synchronized.</p>
</dd></dl>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dipdup-run-early-realtime">
<span class="sig-name descname"><span class="pre">--early-realtime</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="cli-reference.html#cmdoption-dipdup-run-early-realtime" title="Permalink to this definition">¶</a></dt>
<dd><p>Establish a realtime connection before all indexes are synchronized.</p>
</dd></dl>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dipdup-run-merge-subscriptions">
<span class="sig-name descname"><span class="pre">--merge-subscriptions</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="cli-reference.html#cmdoption-dipdup-run-merge-subscriptions" title="Permalink to this definition">¶</a></dt>
<dd><p>Subscribe to all operations/big map diffs during realtime indexing.</p>
</dd></dl>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dipdup-run-metadata-interface">
<span class="sig-name descname"><span class="pre">--metadata-interface</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="cli-reference.html#cmdoption-dipdup-run-metadata-interface" title="Permalink to this definition">¶</a></dt>
<dd><p>Enable metadata interface.</p>
</dd></dl>
</section>
<section id="dipdup-schema">
<h2 id="schema"><a class="header" href="#schema">schema<a class="headerlink" href="cli-reference.html#dipdup-schema" title="Permalink to this headline">¶</a></a></h2>
<p>Manage database schema.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>dipdup schema <span class="o">[</span>OPTIONS<span class="o">]</span> COMMAND <span class="o">[</span>ARGS<span class="o">]</span>...
</pre></div>
</div>
<section id="dipdup-schema-approve">
<h3 id="approve"><a class="header" href="#approve">approve<a class="headerlink" href="cli-reference.html#dipdup-schema-approve" title="Permalink to this headline">¶</a></a></h3>
<p>Continue to use existing schema after reindexing was triggered.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>dipdup schema approve <span class="o">[</span>OPTIONS<span class="o">]</span>
</pre></div>
</div>
</section>
<section id="dipdup-schema-export">
<h3 id="export-1"><a class="header" href="#export-1">export<a class="headerlink" href="cli-reference.html#dipdup-schema-export" title="Permalink to this headline">¶</a></a></h3>
<p>Print SQL schema including scripts from <cite>sql/on_reindex</cite>.</p>
<p>This command may help you debug inconsistency between project models and expected SQL schema.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>dipdup schema <span class="nb">export</span> <span class="o">[</span>OPTIONS<span class="o">]</span>
</pre></div>
</div>
</section>
<section id="dipdup-schema-init">
<h3 id="init-1"><a class="header" href="#init-1">init<a class="headerlink" href="cli-reference.html#dipdup-schema-init" title="Permalink to this headline">¶</a></a></h3>
<p>Prepare a database for running DipDip.</p>
<p>This command creates tables based on your models, then executes <cite>sql/on_reindex</cite> to finish preparation - the same things DipDup does when run on a clean database.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>dipdup schema init <span class="o">[</span>OPTIONS<span class="o">]</span>
</pre></div>
</div>
</section>
<section id="dipdup-schema-wipe">
<h3 id="wipe"><a class="header" href="#wipe">wipe<a class="headerlink" href="cli-reference.html#dipdup-schema-wipe" title="Permalink to this headline">¶</a></a></h3>
<p>Drop all database tables, functions and views.</p>
<p>WARNING: This action is irreversible! All indexed data will be lost!</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>dipdup schema wipe <span class="o">[</span>OPTIONS<span class="o">]</span>
</pre></div>
</div>
<p class="rubric">Options</p>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dipdup-schema-wipe-immune">
<span class="sig-name descname"><span class="pre">--immune</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="cli-reference.html#cmdoption-dipdup-schema-wipe-immune" title="Permalink to this definition">¶</a></dt>
<dd><p>Drop immune tables too.</p>
</dd></dl>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dipdup-schema-wipe-force">
<span class="sig-name descname"><span class="pre">--force</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="cli-reference.html#cmdoption-dipdup-schema-wipe-force" title="Permalink to this definition">¶</a></dt>
<dd><p>Skip confirmation prompt.</p>
</dd></dl>
</section>
</section>
<section id="dipdup-status">
<h2 id="status"><a class="header" href="#status">status<a class="headerlink" href="cli-reference.html#dipdup-status" title="Permalink to this headline">¶</a></a></h2>
<p>Show the current status of indexes in the database.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>dipdup status <span class="o">[</span>OPTIONS<span class="o">]</span>
</pre></div>
</div>
</section>
</section>
<div style="break-before: page; page-break-before: always;"></div><h1 id="config-file-reference"><a class="header" href="#config-file-reference">Config file reference</a></h1>
<p>DipDup configuration is stored in YAML files of a specific format. By default, DipDup searches for <code>dipdup.yml</code> file in the current working directory, but you can provide any path with a <code>-c</code> CLI option:</p>
<pre><code class="language-shell">dipdup -c configs/config.yml run
</code></pre>
<h2 id="general-structure"><a class="header" href="#general-structure">General structure</a></h2>
<p>DipDup configuration file consists of several logical blocks:</p>
<table><thead><tr><th></th><th></th></tr></thead><tbody>
<tr><td>Header</td><td><code>spec_version</code>*</td></tr>
<tr><td></td><td><code>package</code>*</td></tr>
<tr><td>Inventory</td><td><code>database</code>*</td></tr>
<tr><td></td><td><code>contracts</code>*</td></tr>
<tr><td></td><td><code>datasources</code>*</td></tr>
<tr><td>Index definitions</td><td><code>indexes</code></td></tr>
<tr><td></td><td><code>templates</code></td></tr>
<tr><td>Integrations</td><td><code>sentry</code></td></tr>
<tr><td></td><td><code>hasura</code></td></tr>
<tr><td>Hooks</td><td><code>hooks</code></td></tr>
<tr><td></td><td><code>jobs</code></td></tr>
</tbody></table>
<p><code>*</code>  — required sections</p>
<h2 id="environment-variables"><a class="header" href="#environment-variables">Environment variables</a></h2>
<p>DipDup supports compose-style variable expansion with optional default value:</p>
<pre><code class="language-yaml">field: ${ENV_VAR:-default_value}
</code></pre>
<p>You can use environment variables throughout the configuration file, except for property names (YAML object keys).</p>
<h2 id="merging-config-files"><a class="header" href="#merging-config-files">Merging config files</a></h2>
<p>DipDup allows you to customize the configuration for a specific environment or a workflow. It works similar to docker-compose, but only for top-level sections. If you want to override a nested property, you need to recreate a whole top-level section. To merge several DipDup config files, provide <code>-c</code> command-line option multiple times:</p>
<pre><code class="language-shell">dipdup -c dipdup.yml -c dipdup.prod.yml run
</code></pre>
<p>Run <a href="config/../cli-reference.html#dipdup-config-export"><code>config export</code></a> command if unsure about final config used by DipDup.</p>
<div style="break-before: page; page-break-before: always;"></div><p><span class="target" id="module-dipdup.config"></span><dl class="py class"></p>
<dt class="sig sig-object py" id="dipdup.config.AdvancedConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dipdup.config.</span></span><span class="sig-name descname"><span class="pre">AdvancedConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">reindex:</span> <span class="pre">typing.Dict[dipdup.enums.ReindexingReason</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dipdup.enums.ReindexingAction]</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scheduler:</span> <span class="pre">typing.Optional[typing.Dict[str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">typing.Any]]</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">postpone_jobs:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">early_realtime:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">merge_subscriptions:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metadata_interface:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skip_version_check:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="config/reference.html#dipdup.config.AdvancedConfig" title="Permalink to this definition">¶</a></dt>
<dd><p>Feature flags and other advanced config.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>reindex</strong> – Mapping of reindexing reasons and actions DipDup performs</p></li>
<li><p><strong>scheduler</strong> – <cite>apscheduler</cite> scheduler config</p></li>
<li><p><strong>postpone_jobs</strong> – Do not start job scheduler until all indexes are in realtime state</p></li>
<li><p><strong>early_realtime</strong> – Establish realtime connection immediately after startup</p></li>
<li><p><strong>merge_subscriptions</strong> – Subscribe to all operations instead of exact channels</p></li>
<li><p><strong>metadata_interface</strong> – Expose metadata interface for TzKT</p></li>
<li><p><strong>skip_version_check</strong> – Do not check for new DipDup versions on startup</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="dipdup.config.BigMapHandlerConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dipdup.config.</span></span><span class="sig-name descname"><span class="pre">BigMapHandlerConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">callback</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">contract</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="config/reference.html#dipdup.config.ContractConfig" title="dipdup.config.ContractConfig"><span class="pre">dipdup.config.ContractConfig</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="config/reference.html#dipdup.config.BigMapHandlerConfig" title="Permalink to this definition">¶</a></dt>
<dd><p>Big map handler config</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>contract</strong> – Contract to fetch big map from</p></li>
<li><p><strong>path</strong> – Path to big map (alphanumeric string with dots)</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="dipdup.config.BigMapHandlerConfig.initialize_big_map_type">
<span class="sig-name descname"><span class="pre">initialize_big_map_type</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">package</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="config/reference.html#dipdup.config.BigMapHandlerConfig.initialize_big_map_type" title="Permalink to this definition">¶</a></dt>
<dd><p>Resolve imports and initialize key and value type classes</p>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="dipdup.config.BigMapIndexConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dipdup.config.</span></span><span class="sig-name descname"><span class="pre">BigMapIndexConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">kind</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'big_map'</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">datasource</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="config/reference.html#dipdup.config.TzktDatasourceConfig" title="dipdup.config.TzktDatasourceConfig"><span class="pre">dipdup.config.TzktDatasourceConfig</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">handlers</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="config/reference.html#dipdup.config.BigMapHandlerConfig" title="dipdup.config.BigMapHandlerConfig"><span class="pre">dipdup.config.BigMapHandlerConfig</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skip_history</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dipdup.enums.SkipHistory</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">SkipHistory.never</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">first_level</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">last_level</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="config/reference.html#dipdup.config.BigMapIndexConfig" title="Permalink to this definition">¶</a></dt>
<dd><p>Big map index config</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>kind</strong> – always <cite>big_map</cite></p></li>
<li><p><strong>datasource</strong> – Index datasource to fetch big maps with</p></li>
<li><p><strong>handlers</strong> – Description of big map diff handlers</p></li>
<li><p><strong>skip_history</strong> – Fetch only current big map keys ignoring historical changes</p></li>
<li><p><strong>first_level</strong> – Level to start indexing from</p></li>
<li><p><strong>last_level</strong> – Level to stop indexing at (Dipdup will terminate at this level)</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="dipdup.config.CallbackMixin">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dipdup.config.</span></span><span class="sig-name descname"><span class="pre">CallbackMixin</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">callback</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="config/reference.html#dipdup.config.CallbackMixin" title="Permalink to this definition">¶</a></dt>
<dd><p>Mixin for callback configs</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>callback</strong> – Callback name</p>
</dd>
</dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="dipdup.config.CodegenMixin">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dipdup.config.</span></span><span class="sig-name descname"><span class="pre">CodegenMixin</span></span><a class="headerlink" href="config/reference.html#dipdup.config.CodegenMixin" title="Permalink to this definition">¶</a></dt>
<dd><p>Base for pattern config classes containing methods required for codegen</p>
<dl class="py method">
<dt class="sig sig-object py" id="dipdup.config.CodegenMixin.locate_arguments">
<span class="sig-name descname"><span class="pre">locate_arguments</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Type</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="config/reference.html#dipdup.config.CodegenMixin.locate_arguments" title="Permalink to this definition">¶</a></dt>
<dd><p>Try to resolve scope annotations for arguments</p>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="dipdup.config.CoinbaseDatasourceConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dipdup.config.</span></span><span class="sig-name descname"><span class="pre">CoinbaseDatasourceConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">kind</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'coinbase'</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">api_key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">secret_key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">passphrase</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">http</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="config/reference.html#dipdup.config.HTTPConfig" title="dipdup.config.HTTPConfig"><span class="pre">dipdup.config.HTTPConfig</span></a><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="config/reference.html#dipdup.config.CoinbaseDatasourceConfig" title="Permalink to this definition">¶</a></dt>
<dd><p>Coinbase datasource config</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>kind</strong> – always ‘coinbase’</p></li>
<li><p><strong>api_key</strong> – API key</p></li>
<li><p><strong>secret_key</strong> – API secret key</p></li>
<li><p><strong>passphrase</strong> – API passphrase</p></li>
<li><p><strong>http</strong> – HTTP client configuration</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="dipdup.config.ContractConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dipdup.config.</span></span><span class="sig-name descname"><span class="pre">ContractConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">address</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">typename</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="config/reference.html#dipdup.config.ContractConfig" title="Permalink to this definition">¶</a></dt>
<dd><p>Contract config</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>address</strong> – Contract address</p></li>
<li><p><strong>typename</strong> – User-defined alias for the contract script</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="dipdup.config.DipDupConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dipdup.config.</span></span><span class="sig-name descname"><span class="pre">DipDupConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">spec_version:</span> <span class="pre">str,</span> <span class="pre">package:</span> <span class="pre">str,</span> <span class="pre">datasources:</span> <span class="pre">typing.Dict[str,</span> <span class="pre">typing.Union[dipdup.config.TzktDatasourceConfig,</span> <span class="pre">dipdup.config.CoinbaseDatasourceConfig,</span> <span class="pre">dipdup.config.MetadataDatasourceConfig,</span> <span class="pre">dipdup.config.IpfsDatasourceConfig,</span> <span class="pre">dipdup.config.HttpDatasourceConfig]],</span> <span class="pre">database:</span> <span class="pre">typing.Union[dipdup.config.SqliteDatabaseConfig,</span> <span class="pre">dipdup.config.PostgresDatabaseConfig]</span> <span class="pre">=</span> <span class="pre">SqliteDatabaseConfig(kind='sqlite',</span> <span class="pre">path=':memory:'),</span> <span class="pre">contracts:</span> <span class="pre">typing.Dict[str,</span> <span class="pre">dipdup.config.ContractConfig]</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;,</span> <span class="pre">indexes:</span> <span class="pre">typing.Dict[str,</span> <span class="pre">typing.Union[dipdup.config.OperationIndexConfig,</span> <span class="pre">dipdup.config.BigMapIndexConfig,</span> <span class="pre">dipdup.config.HeadIndexConfig,</span> <span class="pre">dipdup.config.TokenTransferIndexConfig,</span> <span class="pre">dipdup.config.IndexTemplateConfig]]</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;,</span> <span class="pre">templates:</span> <span class="pre">typing.Dict[str,</span> <span class="pre">typing.Union[dipdup.config.OperationIndexConfig,</span> <span class="pre">dipdup.config.BigMapIndexConfig,</span> <span class="pre">dipdup.config.HeadIndexConfig,</span> <span class="pre">dipdup.config.TokenTransferIndexConfig]]</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;,</span> <span class="pre">jobs:</span> <span class="pre">typing.Dict[str,</span> <span class="pre">dipdup.config.JobConfig]</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;,</span> <span class="pre">hooks:</span> <span class="pre">typing.Dict[str,</span> <span class="pre">dipdup.config.HookConfig]</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;,</span> <span class="pre">hasura:</span> <span class="pre">typing.Optional[dipdup.config.HasuraConfig]</span> <span class="pre">=</span> <span class="pre">None,</span> <span class="pre">sentry:</span> <span class="pre">typing.Optional[dipdup.config.SentryConfig]</span> <span class="pre">=</span> <span class="pre">None,</span> <span class="pre">prometheus:</span> <span class="pre">typing.Optional[dipdup.config.PrometheusConfig]</span> <span class="pre">=</span> <span class="pre">None,</span> <span class="pre">advanced:</span> <span class="pre">dipdup.config.AdvancedConfig</span> <span class="pre">=</span> <span class="pre">AdvancedConfig(reindex={},</span> <span class="pre">scheduler=None,</span> <span class="pre">postpone_jobs=False,</span> <span class="pre">early_realtime=False,</span> <span class="pre">merge_subscriptions=False,</span> <span class="pre">metadata_interface=False,</span> <span class="pre">skip_version_check=False),</span> <span class="pre">custom:</span> <span class="pre">typing.Dict[str,</span> <span class="pre">typing.Any]</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;,</span> <span class="pre">logging:</span> <span class="pre">dipdup.enums.LoggingValues</span> <span class="pre">=</span> <span class="pre">LoggingValues.default</span></em><span class="sig-paren">)</span><a class="headerlink" href="config/reference.html#dipdup.config.DipDupConfig" title="Permalink to this definition">¶</a></dt>
<dd><p>Main indexer config</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>spec_version</strong> – Version of specification</p></li>
<li><p><strong>package</strong> – Name of indexer’s Python package, existing or not</p></li>
<li><p><strong>datasources</strong> – Mapping of datasource aliases and datasource configs</p></li>
<li><p><strong>database</strong> – Database config</p></li>
<li><p><strong>contracts</strong> – Mapping of contract aliases and contract configs</p></li>
<li><p><strong>indexes</strong> – Mapping of index aliases and index configs</p></li>
<li><p><strong>templates</strong> – Mapping of template aliases and index templates</p></li>
<li><p><strong>jobs</strong> – Mapping of job aliases and job configs</p></li>
<li><p><strong>hooks</strong> – Mapping of hook aliases and hook configs</p></li>
<li><p><strong>hasura</strong> – Hasura integration config</p></li>
<li><p><strong>sentry</strong> – Sentry integration config</p></li>
<li><p><strong>prometheus</strong> – Prometheus integration config</p></li>
<li><p><strong>advanced</strong> – Advanced config</p></li>
<li><p><strong>custom</strong> – User-defined Custom config</p></li>
</ul>
</dd>
</dl>
<dl class="py property">
<dt class="sig sig-object py" id="dipdup.config.DipDupConfig.oneshot">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">oneshot</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span></em><a class="headerlink" href="config/reference.html#dipdup.config.DipDupConfig.oneshot" title="Permalink to this definition">¶</a></dt>
<dd><p>Whether all indexes have <cite>last_level</cite> field set</p>
</dd></dl>
<dl class="py property">
<dt class="sig sig-object py" id="dipdup.config.DipDupConfig.package_path">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">package_path</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span></em><a class="headerlink" href="config/reference.html#dipdup.config.DipDupConfig.package_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Absolute path to the indexer package, existing or default</p>
</dd></dl>
<dl class="py property">
<dt class="sig sig-object py" id="dipdup.config.DipDupConfig.per_index_rollback">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">per_index_rollback</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span></em><a class="headerlink" href="config/reference.html#dipdup.config.DipDupConfig.per_index_rollback" title="Permalink to this definition">¶</a></dt>
<dd><p>Check if package has <cite>on_index_rollback</cite> hook</p>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="dipdup.config.HTTPConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dipdup.config.</span></span><span class="sig-name descname"><span class="pre">HTTPConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cache</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">retry_count</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">retry_sleep</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">retry_multiplier</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ratelimit_rate</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ratelimit_period</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">connection_limit</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">connection_timeout</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="config/reference.html#dipdup.config.HTTPConfig" title="Permalink to this definition">¶</a></dt>
<dd><p>Advanced configuration of HTTP client</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cache</strong> – Whether to cache responses</p></li>
<li><p><strong>retry_count</strong> – Number of retries after request failed before giving up</p></li>
<li><p><strong>retry_sleep</strong> – Sleep time between retries</p></li>
<li><p><strong>retry_multiplier</strong> – Multiplier for sleep time between retries</p></li>
<li><p><strong>ratelimit_rate</strong> – Number of requests per period (“drops” in leaky bucket)</p></li>
<li><p><strong>ratelimit_period</strong> – Time period for rate limiting in seconds</p></li>
<li><p><strong>connection_limit</strong> – Number of simultaneous connections</p></li>
<li><p><strong>connection_timeout</strong> – Connection timeout in seconds</p></li>
<li><p><strong>batch_size</strong> – Number of items fetched in a single paginated request (for some APIs)</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="dipdup.config.HTTPConfig.merge">
<span class="sig-name descname"><span class="pre">merge</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="config/reference.html#dipdup.config.HTTPConfig" title="dipdup.config.HTTPConfig"><span class="pre">dipdup.config.HTTPConfig</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="config/reference.html#dipdup.config.HTTPConfig" title="dipdup.config.HTTPConfig"><span class="pre">dipdup.config.HTTPConfig</span></a></span></span><a class="headerlink" href="config/reference.html#dipdup.config.HTTPConfig.merge" title="Permalink to this definition">¶</a></dt>
<dd><p>Set missing values from other config</p>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="dipdup.config.HandlerConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dipdup.config.</span></span><span class="sig-name descname"><span class="pre">HandlerConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">callback</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="config/reference.html#dipdup.config.HandlerConfig" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="dipdup.config.HasuraConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dipdup.config.</span></span><span class="sig-name descname"><span class="pre">HasuraConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">url</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">admin_secret</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">create_source</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">source</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'default'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">select_limit</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">allow_aggregations</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">camel_case</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rest</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">http</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="config/reference.html#dipdup.config.HTTPConfig" title="dipdup.config.HTTPConfig"><span class="pre">dipdup.config.HTTPConfig</span></a><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="config/reference.html#dipdup.config.HasuraConfig" title="Permalink to this definition">¶</a></dt>
<dd><p>Config for the Hasura integration.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>url</strong> – URL of the Hasura instance.</p></li>
<li><p><strong>admin_secret</strong> – Admin secret of the Hasura instance.</p></li>
<li><p><strong>create_source</strong> – Whether source should be added to Hasura if missing.</p></li>
<li><p><strong>source</strong> – Hasura source for DipDup to configure, others will be left untouched.</p></li>
<li><p><strong>select_limit</strong> – Row limit for unauthenticated queries.</p></li>
<li><p><strong>allow_aggregations</strong> – Whether to allow aggregations in unauthenticated queries.</p></li>
<li><p><strong>camel_case</strong> – Whether to use camelCase instead of default pascal_case for the field names (incompatible with <cite>metadata_interface</cite> flag)</p></li>
<li><p><strong>rest</strong> – Enable REST API both for autogenerated and custom queries.</p></li>
<li><p><strong>http</strong> – HTTP connection tunables</p></li>
</ul>
</dd>
</dl>
<dl class="py property">
<dt class="sig sig-object py" id="dipdup.config.HasuraConfig.headers">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">headers</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="config/reference.html#dipdup.config.HasuraConfig.headers" title="Permalink to this definition">¶</a></dt>
<dd><p>Headers to include with every request</p>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="dipdup.config.HeadHandlerConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dipdup.config.</span></span><span class="sig-name descname"><span class="pre">HeadHandlerConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">callback</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="config/reference.html#dipdup.config.HeadHandlerConfig" title="Permalink to this definition">¶</a></dt>
<dd><p>Head block handler config</p>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="dipdup.config.HeadIndexConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dipdup.config.</span></span><span class="sig-name descname"><span class="pre">HeadIndexConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">kind</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'head'</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">datasource</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="config/reference.html#dipdup.config.TzktDatasourceConfig" title="dipdup.config.TzktDatasourceConfig"><span class="pre">dipdup.config.TzktDatasourceConfig</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">handlers</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="config/reference.html#dipdup.config.HeadHandlerConfig" title="dipdup.config.HeadHandlerConfig"><span class="pre">dipdup.config.HeadHandlerConfig</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="headerlink" href="config/reference.html#dipdup.config.HeadIndexConfig" title="Permalink to this definition">¶</a></dt>
<dd><p>Head block index config</p>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="dipdup.config.HookConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dipdup.config.</span></span><span class="sig-name descname"><span class="pre">HookConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">callback:</span> <span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">args:</span> <span class="pre">typing.Dict[str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">str]</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">atomic:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="config/reference.html#dipdup.config.HookConfig" title="Permalink to this definition">¶</a></dt>
<dd><p>Hook config</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>args</strong> – Mapping of argument names and annotations (checked lazily when possible)</p></li>
<li><p><strong>atomic</strong> – Wrap hook in a single database transaction</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="dipdup.config.HttpDatasourceConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dipdup.config.</span></span><span class="sig-name descname"><span class="pre">HttpDatasourceConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">kind</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'http'</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">url</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">http</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="config/reference.html#dipdup.config.HTTPConfig" title="dipdup.config.HTTPConfig"><span class="pre">dipdup.config.HTTPConfig</span></a><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="config/reference.html#dipdup.config.HttpDatasourceConfig" title="Permalink to this definition">¶</a></dt>
<dd><p>Generic HTTP datasource config</p>
<p>kind: always ‘http’
url: URL to fetch data from
http: HTTP client configuration</p>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="dipdup.config.IndexConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dipdup.config.</span></span><span class="sig-name descname"><span class="pre">IndexConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">kind</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">datasource</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="config/reference.html#dipdup.config.TzktDatasourceConfig" title="dipdup.config.TzktDatasourceConfig"><span class="pre">dipdup.config.TzktDatasourceConfig</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="headerlink" href="config/reference.html#dipdup.config.IndexConfig" title="Permalink to this definition">¶</a></dt>
<dd><p>Index config</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>datasource</strong> – Alias of index datasource in <cite>datasources</cite> section</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="dipdup.config.IndexConfig.hash">
<span class="sig-name descname"><span class="pre">hash</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="headerlink" href="config/reference.html#dipdup.config.IndexConfig.hash" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate hash to ensure config has not changed since last run.</p>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="dipdup.config.IndexTemplateConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dipdup.config.</span></span><span class="sig-name descname"><span class="pre">IndexTemplateConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">template</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">values</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">first_level</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">last_level</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="config/reference.html#dipdup.config.IndexTemplateConfig" title="Permalink to this definition">¶</a></dt>
<dd><p>Index template config</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>kind</strong> – always <cite>template</cite></p></li>
<li><p><strong>name</strong> – Name of index template</p></li>
<li><p><strong>template_values</strong> – Values to be substituted in template (<cite>&lt;key&gt;</cite> -&gt; <cite>value</cite>)</p></li>
<li><p><strong>first_level</strong> – Level to start indexing from</p></li>
<li><p><strong>last_level</strong> – Level to stop indexing at (DipDup will terminate at this level)</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="dipdup.config.IpfsDatasourceConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dipdup.config.</span></span><span class="sig-name descname"><span class="pre">IpfsDatasourceConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">kind</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'ipfs'</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">url</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'https://ipfs.io/ipfs'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">http</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="config/reference.html#dipdup.config.HTTPConfig" title="dipdup.config.HTTPConfig"><span class="pre">dipdup.config.HTTPConfig</span></a><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="config/reference.html#dipdup.config.IpfsDatasourceConfig" title="Permalink to this definition">¶</a></dt>
<dd><p>IPFS datasource config</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>kind</strong> – always ‘ipfs’</p></li>
<li><p><strong>url</strong> – IPFS node URL, e.g. <a class="reference external" href="https://ipfs.io/ipfs/">https://ipfs.io/ipfs/</a></p></li>
<li><p><strong>http</strong> – HTTP client configuration</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="dipdup.config.JobConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dipdup.config.</span></span><span class="sig-name descname"><span class="pre">JobConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">hook:</span> <span class="pre">typing.Union[str,</span> <span class="pre">dipdup.config.HookConfig],</span> <span class="pre">crontab:</span> <span class="pre">typing.Optional[str]</span> <span class="pre">=</span> <span class="pre">None,</span> <span class="pre">interval:</span> <span class="pre">typing.Optional[int]</span> <span class="pre">=</span> <span class="pre">None,</span> <span class="pre">daemon:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False,</span> <span class="pre">args:</span> <span class="pre">typing.Dict[str,</span> <span class="pre">typing.Any]</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></em><span class="sig-paren">)</span><a class="headerlink" href="config/reference.html#dipdup.config.JobConfig" title="Permalink to this definition">¶</a></dt>
<dd><p>Job schedule config</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>hook</strong> – Name of hook to run</p></li>
<li><p><strong>crontab</strong> – Schedule with crontab syntax (<cite>* * * * *</cite>)</p></li>
<li><p><strong>interval</strong> – Schedule with interval in seconds</p></li>
<li><p><strong>daemon</strong> – Run hook as a daemon (never stops)</p></li>
<li><p><strong>args</strong> – Arguments to pass to the hook</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="dipdup.config.LoggingConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dipdup.config.</span></span><span class="sig-name descname"><span class="pre">LoggingConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="headerlink" href="config/reference.html#dipdup.config.LoggingConfig" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="dipdup.config.MetadataDatasourceConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dipdup.config.</span></span><span class="sig-name descname"><span class="pre">MetadataDatasourceConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">kind</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'metadata'</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">network</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dipdup.datasources.metadata.enums.MetadataNetwork</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">url</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'https://metadata.dipdup.net'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">http</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="config/reference.html#dipdup.config.HTTPConfig" title="dipdup.config.HTTPConfig"><span class="pre">dipdup.config.HTTPConfig</span></a><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="config/reference.html#dipdup.config.MetadataDatasourceConfig" title="Permalink to this definition">¶</a></dt>
<dd><p>DipDup Metadata datasource config</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>kind</strong> – always ‘metadata’</p></li>
<li><p><strong>network</strong> – Network name, e.g. mainnet, hangzhounet, etc.</p></li>
<li><p><strong>url</strong> – GraphQL API URL, e.g. <a class="reference external" href="https://metadata.dipdup.net">https://metadata.dipdup.net</a></p></li>
<li><p><strong>http</strong> – HTTP client configuration</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="dipdup.config.NameMixin">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dipdup.config.</span></span><span class="sig-name descname"><span class="pre">NameMixin</span></span><a class="headerlink" href="config/reference.html#dipdup.config.NameMixin" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="dipdup.config.OperationHandlerConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dipdup.config.</span></span><span class="sig-name descname"><span class="pre">OperationHandlerConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">callback</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pattern</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="config/reference.html#dipdup.config.OperationHandlerOriginationPatternConfig" title="dipdup.config.OperationHandlerOriginationPatternConfig"><span class="pre">dipdup.config.OperationHandlerOriginationPatternConfig</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="config/reference.html#dipdup.config.OperationHandlerTransactionPatternConfig" title="dipdup.config.OperationHandlerTransactionPatternConfig"><span class="pre">dipdup.config.OperationHandlerTransactionPatternConfig</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="headerlink" href="config/reference.html#dipdup.config.OperationHandlerConfig" title="Permalink to this definition">¶</a></dt>
<dd><p>Operation handler config</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>callback</strong> – Name of method in <cite>handlers</cite> package</p></li>
<li><p><strong>pattern</strong> – Filters to match operation groups</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="dipdup.config.OperationHandlerOriginationPatternConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dipdup.config.</span></span><span class="sig-name descname"><span class="pre">OperationHandlerOriginationPatternConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'origination'</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'origination'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">source</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="config/reference.html#dipdup.config.ContractConfig" title="dipdup.config.ContractConfig"><span class="pre">dipdup.config.ContractConfig</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">similar_to</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="config/reference.html#dipdup.config.ContractConfig" title="dipdup.config.ContractConfig"><span class="pre">dipdup.config.ContractConfig</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">originated_contract</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="config/reference.html#dipdup.config.ContractConfig" title="dipdup.config.ContractConfig"><span class="pre">dipdup.config.ContractConfig</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">optional</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">strict</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="config/reference.html#dipdup.config.OperationHandlerOriginationPatternConfig" title="Permalink to this definition">¶</a></dt>
<dd><p>Origination handler pattern config</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>type</strong> – always ‘origination’</p></li>
<li><p><strong>source</strong> – Match operations by source contract alias</p></li>
<li><p><strong>similar_to</strong> – Match operations which have the same code/signature (depending on <cite>strict</cite> field)</p></li>
<li><p><strong>originated_contract</strong> – Match origination of exact contract</p></li>
<li><p><strong>optional</strong> – Whether can operation be missing in operation group</p></li>
<li><p><strong>strict</strong> – Match operations by storage only or by the whole code</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="dipdup.config.OperationHandlerTransactionPatternConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dipdup.config.</span></span><span class="sig-name descname"><span class="pre">OperationHandlerTransactionPatternConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'transaction'</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'transaction'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">source</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="config/reference.html#dipdup.config.ContractConfig" title="dipdup.config.ContractConfig"><span class="pre">dipdup.config.ContractConfig</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">destination</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="config/reference.html#dipdup.config.ContractConfig" title="dipdup.config.ContractConfig"><span class="pre">dipdup.config.ContractConfig</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">entrypoint</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">optional</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="config/reference.html#dipdup.config.OperationHandlerTransactionPatternConfig" title="Permalink to this definition">¶</a></dt>
<dd><p>Operation handler pattern config</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>type</strong> – always ‘transaction’</p></li>
<li><p><strong>source</strong> – Match operations by source contract alias</p></li>
<li><p><strong>destination</strong> – Match operations by destination contract alias</p></li>
<li><p><strong>entrypoint</strong> – Match operations by contract entrypoint</p></li>
<li><p><strong>optional</strong> – Whether can operation be missing in operation group</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="dipdup.config.OperationIndexConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dipdup.config.</span></span><span class="sig-name descname"><span class="pre">OperationIndexConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">kind:</span> <span class="pre">typing.Literal['operation'],</span> <span class="pre">datasource:</span> <span class="pre">typing.Union[str,</span> <span class="pre">dipdup.config.TzktDatasourceConfig],</span> <span class="pre">handlers:</span> <span class="pre">typing.Tuple[dipdup.config.OperationHandlerConfig,</span> <span class="pre">...],</span> <span class="pre">types:</span> <span class="pre">typing.Tuple[dipdup.enums.OperationType,</span> <span class="pre">...]</span> <span class="pre">=</span> <span class="pre">(&lt;OperationType.transaction:</span> <span class="pre">'transaction'&gt;,),</span> <span class="pre">contracts:</span> <span class="pre">typing.List[typing.Union[str,</span> <span class="pre">dipdup.config.ContractConfig]]</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;,</span> <span class="pre">first_level:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">0,</span> <span class="pre">last_level:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">0</span></em><span class="sig-paren">)</span><a class="headerlink" href="config/reference.html#dipdup.config.OperationIndexConfig" title="Permalink to this definition">¶</a></dt>
<dd><p>Operation index config</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>kind</strong> – always <cite>operation</cite></p></li>
<li><p><strong>handlers</strong> – List of indexer handlers</p></li>
<li><p><strong>types</strong> – Types of transaction to fetch</p></li>
<li><p><strong>contracts</strong> – Aliases of contracts being indexed in <cite>contracts</cite> section</p></li>
<li><p><strong>first_level</strong> – Level to start indexing from</p></li>
<li><p><strong>last_level</strong> – Level to stop indexing at (DipDup will terminate at this level)</p></li>
</ul>
</dd>
</dl>
<dl class="py property">
<dt class="sig sig-object py" id="dipdup.config.OperationIndexConfig.address_filter">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">address_filter</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Set</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="config/reference.html#dipdup.config.OperationIndexConfig.address_filter" title="Permalink to this definition">¶</a></dt>
<dd><p>Set of addresses (any field) to filter operations with before an actual matching</p>
</dd></dl>
<dl class="py property">
<dt class="sig sig-object py" id="dipdup.config.OperationIndexConfig.entrypoint_filter">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">entrypoint_filter</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Set</span><span class="p"><span class="pre">[</span></span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="config/reference.html#dipdup.config.OperationIndexConfig.entrypoint_filter" title="Permalink to this definition">¶</a></dt>
<dd><p>Set of entrypoints to filter operations with before an actual matching</p>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="dipdup.config.ParameterTypeMixin">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dipdup.config.</span></span><span class="sig-name descname"><span class="pre">ParameterTypeMixin</span></span><a class="headerlink" href="config/reference.html#dipdup.config.ParameterTypeMixin" title="Permalink to this definition">¶</a></dt>
<dd><p><cite>parameter_type_cls</cite> field</p>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="dipdup.config.ParentMixin">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dipdup.config.</span></span><span class="sig-name descname"><span class="pre">ParentMixin</span></span><a class="headerlink" href="config/reference.html#dipdup.config.ParentMixin" title="Permalink to this definition">¶</a></dt>
<dd><p><cite>parent</cite> field for index and template configs</p>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="dipdup.config.PatternConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dipdup.config.</span></span><span class="sig-name descname"><span class="pre">PatternConfig</span></span><a class="headerlink" href="config/reference.html#dipdup.config.PatternConfig" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="dipdup.config.PostgresDatabaseConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dipdup.config.</span></span><span class="sig-name descname"><span class="pre">PostgresDatabaseConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">kind:</span> <span class="pre">typing.Literal['postgres'],</span> <span class="pre">host:</span> <span class="pre">str,</span> <span class="pre">user:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'postgres',</span> <span class="pre">database:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'postgres',</span> <span class="pre">port:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">5432,</span> <span class="pre">schema_name:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'public',</span> <span class="pre">password:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'',</span> <span class="pre">immune_tables:</span> <span class="pre">typing.Tuple[str,</span> <span class="pre">...]</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;,</span> <span class="pre">connection_timeout:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">60</span></em><span class="sig-paren">)</span><a class="headerlink" href="config/reference.html#dipdup.config.PostgresDatabaseConfig" title="Permalink to this definition">¶</a></dt>
<dd><p>Postgres database connection config</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>kind</strong> – always ‘postgres’</p></li>
<li><p><strong>host</strong> – Host</p></li>
<li><p><strong>port</strong> – Port</p></li>
<li><p><strong>user</strong> – User</p></li>
<li><p><strong>password</strong> – Password</p></li>
<li><p><strong>database</strong> – Database name</p></li>
<li><p><strong>schema_name</strong> – Schema name</p></li>
<li><p><strong>immune_tables</strong> – List of tables to preserve during reindexing</p></li>
<li><p><strong>connection_timeout</strong> – Connection timeout</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="dipdup.config.PrometheusConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dipdup.config.</span></span><span class="sig-name descname"><span class="pre">PrometheusConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">host</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">port</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">8000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">update_interval</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1.0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="config/reference.html#dipdup.config.PrometheusConfig" title="Permalink to this definition">¶</a></dt>
<dd><p>Config for Prometheus integration.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>host</strong> – Host to bind to</p></li>
<li><p><strong>port</strong> – Port to bind to</p></li>
<li><p><strong>update_interval</strong> – Interval to update some metrics in seconds</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="dipdup.config.SentryConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dipdup.config.</span></span><span class="sig-name descname"><span class="pre">SentryConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dsn</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">environment</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">server_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">release</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">debug</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="config/reference.html#dipdup.config.SentryConfig" title="Permalink to this definition">¶</a></dt>
<dd><p>Config for Sentry integration.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dsn</strong> – DSN of the Sentry instance</p></li>
<li><p><strong>environment</strong> – Environment (defaults to <cite>production</cite>)</p></li>
<li><p><strong>server_name</strong> – Server name (defaults to hostname)</p></li>
<li><p><strong>release</strong> – Release version (defaults to DipDup version)</p></li>
<li><p><strong>debug</strong> – Catch warning messages and more context</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="dipdup.config.SqliteDatabaseConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dipdup.config.</span></span><span class="sig-name descname"><span class="pre">SqliteDatabaseConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">kind</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'sqlite'</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">':memory:'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="config/reference.html#dipdup.config.SqliteDatabaseConfig" title="Permalink to this definition">¶</a></dt>
<dd><p>SQLite connection config</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>kind</strong> – always ‘sqlite’</p></li>
<li><p><strong>path</strong> – Path to .sqlite3 file, leave default for in-memory database (<cite>:memory:</cite>)</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="dipdup.config.StorageTypeMixin">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dipdup.config.</span></span><span class="sig-name descname"><span class="pre">StorageTypeMixin</span></span><a class="headerlink" href="config/reference.html#dipdup.config.StorageTypeMixin" title="Permalink to this definition">¶</a></dt>
<dd><p><cite>storage_type_cls</cite> field</p>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="dipdup.config.SubscriptionsMixin">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dipdup.config.</span></span><span class="sig-name descname"><span class="pre">SubscriptionsMixin</span></span><a class="headerlink" href="config/reference.html#dipdup.config.SubscriptionsMixin" title="Permalink to this definition">¶</a></dt>
<dd><p><cite>subscriptions</cite> field</p>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="dipdup.config.TemplateValuesMixin">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dipdup.config.</span></span><span class="sig-name descname"><span class="pre">TemplateValuesMixin</span></span><a class="headerlink" href="config/reference.html#dipdup.config.TemplateValuesMixin" title="Permalink to this definition">¶</a></dt>
<dd><p><cite>template_values</cite> field</p>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="dipdup.config.TokenTransferHandlerConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dipdup.config.</span></span><span class="sig-name descname"><span class="pre">TokenTransferHandlerConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">callback</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="config/reference.html#dipdup.config.TokenTransferHandlerConfig" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="dipdup.config.TokenTransferIndexConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dipdup.config.</span></span><span class="sig-name descname"><span class="pre">TokenTransferIndexConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">kind:</span> <span class="pre">typing.Literal['token_transfer'],</span> <span class="pre">datasource:</span> <span class="pre">typing.Union[str,</span> <span class="pre">dipdup.config.TzktDatasourceConfig],</span> <span class="pre">handlers:</span> <span class="pre">typing.Tuple[dipdup.config.TokenTransferHandlerConfig,</span> <span class="pre">...]</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;,</span> <span class="pre">first_level:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">0,</span> <span class="pre">last_level:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">0</span></em><span class="sig-paren">)</span><a class="headerlink" href="config/reference.html#dipdup.config.TokenTransferIndexConfig" title="Permalink to this definition">¶</a></dt>
<dd><p>Token index config</p>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="dipdup.config.TransactionIdxMixin">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dipdup.config.</span></span><span class="sig-name descname"><span class="pre">TransactionIdxMixin</span></span><a class="headerlink" href="config/reference.html#dipdup.config.TransactionIdxMixin" title="Permalink to this definition">¶</a></dt>
<dd><p><cite>transaction_idx</cite> field to track index of operation in group</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>transaction_idx</strong> – </p>
</dd>
</dl>
</dd></dl>
<dl class="py class">
<dt class="sig sig-object py" id="dipdup.config.TzktDatasourceConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dipdup.config.</span></span><span class="sig-name descname"><span class="pre">TzktDatasourceConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">kind</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'tzkt'</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">url</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">http</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="config/reference.html#dipdup.config.HTTPConfig" title="dipdup.config.HTTPConfig"><span class="pre">dipdup.config.HTTPConfig</span></a><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">buffer_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="config/reference.html#dipdup.config.TzktDatasourceConfig" title="Permalink to this definition">¶</a></dt>
<dd><p>TzKT datasource config</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>kind</strong> – always ‘tzkt’</p></li>
<li><p><strong>url</strong> – Base API URL, e.g. <a class="reference external" href="https://api.tzkt.io/">https://api.tzkt.io/</a></p></li>
<li><p><strong>http</strong> – HTTP client configuration</p></li>
<li><p><strong>buffer_size</strong> – Number of levels to keep in FIFO buffer before processing</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<div style="break-before: page; page-break-before: always;"></div><h1 id="advanced"><a class="header" href="#advanced"><code>advanced</code></a></h1>
<pre><code class="language-yaml">advanced:
  early_realtime: False
  merge_subscriptions: False
  postpone_jobs: False
  reindex:
    manual: wipe
    migration: exception
    rollback: ignore
    config_modified: exception
    schema_modified: exception
</code></pre>
<p>This config section allows users to tune some system-wide options, either experimental or unsuitable for generic configurations.</p>
<table><thead><tr><th>field</th><th>description</th></tr></thead><tbody>
<tr><td><code>reindex</code></td><td>Mapping of reindexing reasons and actions DipDup performs</td></tr>
<tr><td><code>scheduler</code></td><td><code>apscheduler</code> scheduler config</td></tr>
<tr><td><code>postpone_jobs</code></td><td>Do not start job scheduler until all indexes are in realtime state</td></tr>
<tr><td><code>early_realtime</code></td><td>Establish realtime connection immediately after startup</td></tr>
<tr><td><code>merge_subscriptions</code></td><td>Subscribe to all operations instead of exact channels</td></tr>
<tr><td><code>metadata_interface</code></td><td>Expose metadata interface for TzKT</td></tr>
</tbody></table>
<p>CLI flags have priority over self-titled <code>AdvancedConfig</code> fields.</p>
<blockquote>
<p>🤓 <strong>SEE ALSO</strong></p>
<ul>
<li><a href="https://dipdup.net/docs-next/advanced/reindexing.html">3.3. Reindexing</a></li>
<li><a href="https://dipdup.net/docs-next/advanced/feature-flags.html">3.4. Feature flags</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="contracts"><a class="header" href="#contracts">contracts</a></h1>
<p>A list of the contract definitions you might use in the indexer patterns or templates. Each contract entry has two fields:</p>
<ul>
<li><code>address</code> — either originated or implicit account address encoded in base58.</li>
<li><code>typename</code> — an alias for the particular contract script, meaning that two contracts sharing the same code can have the same type name.</li>
</ul>
<pre><code class="language-yaml">contracts:
  kusd_dex_mainnet:
    address: KT1CiSKXR68qYSxnbzjwvfeMCRburaSDonT2
    typename: quipu_fa12
  tzbtc_dex_mainnet:
    address: KT1N1wwNPqT5jGhM91GQ2ae5uY8UzFaXHMJS
    typename: quipu_fa12
  kusd_token_mainnet:
    address: KT1K9gCRgaLRFKTErYt1wVxA3Frb9FjasjTV
    typename: kusd_token
  tzbtc_token_mainnet:
    address: KT1PWx2mnDueood7fEmfbBDKx1D9BAnnXitn
    typename: tzbtc_token
</code></pre>
<p>A <code>typename</code> field is only required when using index templates, but it helps to improve the readability of auto-generated code and avoid repetition.</p>
<p>Contract entry does not contain information about the network, so it's a good idea to include the network name in the alias. This design choice makes possible a generic index parameterization via templates. See <a href="config/../getting-started/templates-and-variables.html">4.5. Templates and variables</a> for details.</p>
<p>If multiple contracts you index have the same interface but different code, see <a href="config/../cookbook/reusing-typenames.html">8.2. Reusing typename for different contracts</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="database"><a class="header" href="#database">database</a></h1>
<p>DipDup supports several database engines for development and production. The obligatory field <code>kind</code> specifies which engine has to be used:</p>
<ul>
<li><code>sqlite</code></li>
<li><code>postgres</code> (and compatible engines)</li>
</ul>
<p><a href="config/../deployment/database-engines.html">Database engines</a> article may help you choose a database that better suits your needs.</p>
<h2 id="sqlite"><a class="header" href="#sqlite">SQLite</a></h2>
<p><code>path</code> field must be either path to the .sqlite3 file or <code>:memory:</code> to keep a database in memory only (default):</p>
<pre><code class="language-yaml">database:
  kind: sqlite
  path: db.sqlite3
</code></pre>
<table><thead><tr><th>field</th><th>description</th></tr></thead><tbody>
<tr><td><code>kind</code></td><td>always 'sqlite'</td></tr>
<tr><td><code>path</code></td><td>Path to .sqlite3 file, leave default for in-memory database</td></tr>
</tbody></table>
<h2 id="postgresql"><a class="header" href="#postgresql">PostgreSQL</a></h2>
<p>Requires <code>host</code>, <code>port</code>, <code>user</code>, <code>password</code>, and <code>database</code> fields. You can set <code>schema_name</code> to values other than <code>public</code>, but Hasura integration won't be available.</p>
<pre><code class="language-yaml">database:
  kind: postgres
  host: db
  port: 5432
  user: dipdup
  password: ${POSTGRES_PASSWORD:-changeme}
  database: dipdup
  schema_name: public
</code></pre>
<table><thead><tr><th>field</th><th>description</th></tr></thead><tbody>
<tr><td><code>kind</code></td><td>always 'postgres'</td></tr>
<tr><td><code>host</code></td><td>Host</td></tr>
<tr><td><code>port</code></td><td>Port</td></tr>
<tr><td><code>user</code></td><td>User</td></tr>
<tr><td><code>password</code></td><td>Password</td></tr>
<tr><td><code>database</code></td><td>Database name</td></tr>
<tr><td><code>schema_name</code></td><td>Schema name</td></tr>
<tr><td><code>immune_tables</code></td><td>List of tables to preserve during reindexing</td></tr>
<tr><td><code>connection_timeout</code></td><td>Connection timeout in seconds</td></tr>
</tbody></table>
<!-- TODO: Move to the upper level -->
<p>You can also use compose-style environment variable substitutions with default values for secrets and other fields. See <a href="config/../getting-started/templates-and-variables.html#">Templates and variables</a> for details.</p>
<h3 id="immune-tables"><a class="header" href="#immune-tables">Immune tables</a></h3>
<p>In some cases, DipDup can't continue indexing with an existing database. See <a href="config/../advanced/reindexing.html">5.3. Reindexing</a> for details. One of the solutions to resolve reindexing state is to drop the database and start indexing from scratch. To achieve this, either invoke the <a href="config/../cli-reference.md#dipdup-schema-wipe.html"><code>schema wipe</code> command</a> or set an action to <code>wipe</code> in the <a href="config/../config/advanced.html"><code>advanced.reindex</code> config section</a>.</p>
<p>You might want to keep several tables during schema wipe if data in them is not dependent on index states yet heavy. A typical example is indexing IPFS data — rollbacks do not affect off-chain storage, so you can safely continue after receiving a reorg message.</p>
<pre><code class="language-yaml">database:
  immune_tables:
    - token_metadata
    - contract_metadata
</code></pre>
<p><code>immune_tables</code> is an optional array of table names that will be ignored during schema wipe. Once an immune table is created, DipDup will never touch it again; to change the schema of an immune table, you need to perform a migration manually. Check <code>schema export</code> output before doing this to ensure the resulting schema is the same TortoiseORM would generate.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="datasources-3"><a class="header" href="#datasources-3">datasources</a></h1>
<p>A list of API endpoints DipDup uses to retrieve indexing data to process.</p>
<p>A datasource config entry is an alias for the endpoint URI; there's no network mention. Thus it's good to add a network name to the datasource alias, e.g. <code>tzkt_mainnet</code>.</p>
<h2 id="tzkt-3"><a class="header" href="#tzkt-3">tzkt</a></h2>
<pre><code class="language-yaml">datasources:
  tzkt:
    kind: tzkt
    url: ${TZKT_URL:-https://api.tzkt.io}
    http:
      cache: false
      retry_count:  # retry infinetely
      retry_sleep:
      retry_multiplier:
      ratelimit_rate:
      ratelimit_period:
      connection_limit: 100
      connection_timeout: 60
      batch_size: 10000
    buffer_size: 0
</code></pre>
<h2 id="coinbase-1"><a class="header" href="#coinbase-1">coinbase</a></h2>
<pre><code class="language-yaml">datasources:
  coinbase:
    kind: coinbase
</code></pre>
<h2 id="dipdup-metadata-1"><a class="header" href="#dipdup-metadata-1">dipdup-metadata</a></h2>
<pre><code class="language-yaml">datasources:
  metadata:
    kind: metadata
    url: https://metadata.dipdup.net
    network: mainnet|handzhounet
</code></pre>
<h2 id="ipfs-1"><a class="header" href="#ipfs-1">ipfs</a></h2>
<pre><code class="language-yaml">datasources:
  ipfs:
    kind: ipfs
    url: https://ipfs.io/ipfs
</code></pre>
<blockquote>
<p>🤓 <strong>SEE ALSO</strong></p>
<ul>
<li><a href="https://dipdup.net/docs-next/advanced/datasources.html">3.1. Datasources</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hasura-1"><a class="header" href="#hasura-1">hasura</a></h1>
<p>This optional section used by DipDup executor to automatically configure Hasura engine to track your tables.</p>
<pre><code class="language-yaml">hasura:
  url: http://hasura:8080
  admin_secret: ${HASURA_ADMIN_SECRET:-changeme}
  allow_aggregations: false
  camel_case: true
  rest: true
  select_limit: 100
  source: default
</code></pre>
<blockquote>
<p>🤓 <strong>SEE ALSO</strong></p>
<ul>
<li><a href="https://dipdup.net/docs-next/graphql/hasura.html">4.1. Hasura integration</a></li>
<li><a href="https://dipdup.net/docs-next/cli-reference.html#dipdup-hasura-configure">10. Command-line reference → dipdup-hasura-configure</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hooks-1"><a class="header" href="#hooks-1">hooks</a></h1>
<p>Hooks are user-defined callbacks you can execute with a job scheduler or within another callback (with <code>ctx.fire_hook</code>).</p>
<pre><code class="language-yaml">hooks:
  calculate_stats:
    callback: calculate_stats
    atomic: False
    args:
     major: bool
     depth: int
</code></pre>
<blockquote>
<p>🤓 <strong>SEE ALSO</strong></p>
<ul>
<li><a href="https://dipdup.net/docs-next/advanced/hooks/index.html">3.2. Hooks</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="indexes"><a class="header" href="#indexes">indexes</a></h1>
<p><em>Index</em> — is a basic DipDup entity connecting the inventory and specifying data handling rules.</p>
<p>Each index has a unique string identifier acting as a key under <code>indexes</code> config section:</p>
<pre><code class="language-yaml">indexes:
  my_index:
    kind: operation
    datasource: tzkt_mainnet
</code></pre>
<p>There can be various index kinds; currently, two possible options are supported for the <code>kind</code> field:</p>
<ul>
<li><code>operation</code></li>
<li><code>big_map</code></li>
</ul>
<p>All the indexes have to specify the <code>datasource</code> field, an alias of an existing entry under the <a href="config/indexes/../datasources.html">datasources</a> section.</p>
<h2 id="indexing-scope"><a class="header" href="#indexing-scope">Indexing scope</a></h2>
<p>One can optionally specify block levels DipDup has to start and stop indexing at, e.g., there's a new version of the contract, and it will be more efficient to stop handling the old one.</p>
<pre><code class="language-yaml">indexes:
  my_index:
    first_level: 1000000
    last_level: 2000000
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="big_map"><a class="header" href="#big_map">big_map</a></h1>
<p>big_map index allows querying only updates of a specific big map (or several). In some cases, it can drastically reduce the amount of data transferred and speed up the indexing process.</p>
<pre><code class="language-yaml">indexes:
  my_index:
    kind: big_map
    datasource: tzkt
    skip_history: never
    handlers:
      - callback: on_leger_update
        contract: contract1
        path: data.ledger
      - callback: on_token_metadata_update
        contract: contract1
        path: token_metadata
</code></pre>
<h2 id="handlers"><a class="header" href="#handlers">Handlers</a></h2>
<p>Each big_map handler contains three required fields:</p>
<ul>
<li><code>callback</code> —  name of the <em>async</em> function with a particular signature; DipDup will try to load it from the module with the same name <code>&lt;package_name&gt;.handlers.&lt;callback&gt;</code></li>
<li><code>contract</code> — Big map parent contract (from the <a href="config/indexes/../contracts.html">inventory</a>)</li>
<li><code>path</code> — path to the Big map in the contract storage (use dot as a delimiter)</li>
</ul>
<h2 id="index-only-the-current-state-of-big-maps"><a class="header" href="#index-only-the-current-state-of-big-maps">Index only the current state of big maps</a></h2>
<p>When <code>skip_history</code> field is set to <code>once</code>, DipDup will skip historical changes only on initial sync and switch to regular indexing afterward. When the value is <code>always</code>, DipDup will fetch all big map keys on every restart. Preferrable mode depends on your workload.</p>
<p>All big map diffs DipDup pass to handlers during fast sync have <code>action</code> field set to <code>BigMapAction.ADD_KEY</code>. Keep in mind that DipDup fetches all keys in this mode, including ones removed from the big map. You can filter out latter by <code>BigMapDiff.data.active</code> field if needed.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="head"><a class="header" href="#head">head</a></h1>
<blockquote>
<p>🚧 <strong>UNDER CONSTRUCTION</strong></p>
<p>This page or paragraph is yet to be written. Come back later.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="operation"><a class="header" href="#operation">operation</a></h1>
<p>Operation index allows you to query only those operations related to your DApp and do pattern matching on its content (internal calls chain). It is the closest thing to fully-fledged event logs.</p>
<h2 id="filters-2"><a class="header" href="#filters-2">Filters</a></h2>
<p>DipDup supports filtering operations by <code>kind</code>, <code>source</code>, <code>destination</code> (if applicable), and <code>originated_contract</code> (if applicable).</p>
<p>DipDup fetches only <em>applied</em> operations.</p>
<h3 id="contracts-1"><a class="header" href="#contracts-1">contracts</a></h3>
<pre><code class="language-yaml">indexes:
  my_index:
    kind: operation
    datasource: tzkt
    contracts:
      - contract1
      - contract2
</code></pre>
<p>In this example, DipDup will fetch all the operations where any of source and destination is equal to either <em>contract1</em> or <em>contract2</em> address. <code>contracts</code> field is obligatory, there has to be at least one contract alias (from the <a href="config/indexes/../contracts.html">inventory</a>).</p>
<h3 id="types"><a class="header" href="#types">types</a></h3>
<p>By default, DipDup works only with transactions, but you can explicitly list operation types you want to subscribe to (currently <code>transaction</code> and <code>origination</code> types are supported):</p>
<pre><code class="language-yaml">indexes:
  my_index:
    kind: operation
    datasource: tzkt
    contracts:
      - contract1
    types:
      - transaction
      - origination
</code></pre>
<p>Note that in the case of originations, DipDup will query operations where either source or originated contract address is equal to <em>contract1.</em></p>
<h2 id="handlers-1"><a class="header" href="#handlers-1">Handlers</a></h2>
<p>Each operation handler contains two required fields:</p>
<ul>
<li><code>callback</code> —  name of the <em>async</em> function with a particular signature; DipDup will try to load it from the module with the same name <code>&lt;package_name&gt;.handlers.&lt;callback&gt;</code></li>
<li><code>pattern</code> — a non-empty list of items that have to be matched</li>
</ul>
<pre><code class="language-yaml">indexes:
  my_index:
    kind: operation
    datasource: tzkt
    contracts:
      - contract1
    handlers:
      - callback: on_call
        pattern:
          - destination: contract1
            entrypoint: call        
</code></pre>
<p>You can think of operation pattern as a regular expression on a sequence of operations (both external and internal) with global flag enabled (can be multiple matches) and where various operation parameters (type, source, destination, entrypoint, originated contract) are used for matching.</p>
<h3 id="pattern"><a class="header" href="#pattern">Pattern</a></h3>
<p>Here are the supported filters for matching operations (all optional):</p>
<ul>
<li><code>type</code> — (either <em>transaction</em> or <em>origination</em>) usually inferred from the existence of other fields</li>
<li><code>destination</code> — invoked contract alias (from the <a href="config/indexes/../contracts.html">inventory</a>)</li>
<li><code>entrypoint</code> — invoked entrypoint name</li>
<li><code>source</code> — operation sender alias (from the <a href="config/indexes/../contracts.html">inventory</a>)</li>
<li><code>originated_contract</code> — originated contract alias (from the <a href="config/indexes/../contracts.html">inventory</a>)</li>
<li><code>similar_to</code> — originated contract has the same parameter and storage types as the reference one (from the <a href="config/indexes/../contracts.html">inventory</a>)</li>
<li><code>strict</code> — stronger the <code>similar_to</code> filter by comparing the entire code rather than just parameter+storage</li>
<li><code>optional</code> — continue matching even if this item is not found (with limitations, see below)</li>
</ul>
<p>It's unnecessary to match the entire operation content; you can skip external/internal calls that are not relevant. However, there is a limitation: optional items cannot be followed by operations ignored by the pattern.</p>
<pre><code class="language-yaml">pattern:
  - destination: contract_1
    entrypoint: call_1
  - destination: contract_2
    entrypoint: internal_call_2
  - source: contract_1
    type: transaction
  - source: contract_2
    type: origination
    similar_to: contract_3
    strict: true
    optional: true
</code></pre>
<p>You will get slightly different callback argument types depending on whether you specify <em>destination+entrypoint</em> for transactions and <em>originated_contract</em> for originations. Namely, in the first case, DipDup will generate the dataclass for a particular entrypoint/storage, and in the second case not (meaning you will have to handle untyped parameters/storage updates).</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="template"><a class="header" href="#template">template</a></h1>
<p>This index type is used for creating a static template instance.</p>
<pre><code class="language-yaml">indexes:
  my_index:
    template: my_template
    values:
      placeholder1: value1
      placeholder2: value2
</code></pre>
<p>For a static template instance (specified in the DipDup config) there are two fields:</p>
<ul>
<li><code>template</code> — template name (from <a href="config/indexes/../templates.html">templates</a> section)</li>
<li><code>values</code> — concrete values for each <a href="config/indexes/../templates.html#placeholders">placeholder</a> used in a chosen template</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="jobs"><a class="header" href="#jobs">jobs</a></h1>
<p>Add the following section to DipDup config:</p>
<pre><code class="language-yaml">jobs:
  midnight_stats:
    hook: calculate_stats
    crontab: &quot;0 0 * * *&quot;
    args:
      major: True
  leet_stats:
    hook: calculate_stats
    interval: 1337  # in seconds
    args:
      major: False
</code></pre>
<p>If you're not familiar with the crontab syntax, there's an online service <a href="https://crontab.guru/">crontab.guru</a> that will help you build the desired expression.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="package"><a class="header" href="#package">package</a></h1>
<p>DipDup uses this field to discover the Python package of your project.</p>
<pre><code class="language-yaml">package: my_indexer_name
</code></pre>
<p>DipDup will search for a module named <code>my_module_name</code> in <strong><code>PYTHONPATH</code></strong></p>
<p>This field allows to decouple DipDup configuration file from the indexer implementation and gives more flexibility in managing the source code.</p>
<p>See <a href="config/../getting-started/project-structure.html">4.4. Project structure</a> for details.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="prometheus"><a class="header" href="#prometheus">prometheus</a></h1>
<pre><code class="language-yaml">prometheus:
  host: 0.0.0.0
</code></pre>
<p>Prometheus integration options</p>
<table><thead><tr><th>field</th><th>description</th></tr></thead><tbody>
<tr><td><code>host</code></td><td>Host to bind to</td></tr>
<tr><td><code>port</code></td><td>Port to bind to</td></tr>
<tr><td><code>update_interval</code></td><td>Interval to update some metrics in seconds</td></tr>
</tbody></table>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sentry"><a class="header" href="#sentry">sentry</a></h1>
<pre><code class="language-yaml">sentry:
  dsn: https://...
  environment: dev
  debug: False
</code></pre>
<table><thead><tr><th>field</th><th>description</th></tr></thead><tbody>
<tr><td><code>dsn</code></td><td>DSN of the Sentry instance</td></tr>
<tr><td><code>environment</code></td><td>Environment to report to Sentry (informational only)</td></tr>
<tr><td><code>debug</code></td><td>Catch warning messages and more context</td></tr>
</tbody></table>
<blockquote>
<p>🤓 <strong>SEE ALSO</strong></p>
<ul>
<li><a href="https://dipdup.net/docs-next/deployment/sentry.html">6.5. Sentry integration</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="spec_version"><a class="header" href="#spec_version">spec_version</a></h1>
<p>DipDup specification version is used to determine the compatibility of the toolkit and configuration file format and/or features.</p>
<pre><code class="language-yaml">spec_version: 1.2
</code></pre>
<p>This table shows which specific SDK releases support which DipDup file versions.</p>
<table><thead><tr><th style="text-align: left"><code>spec_version</code> value</th><th style="text-align: left">Supported DipDup versions</th></tr></thead><tbody>
<tr><td style="text-align: left">0.1</td><td style="text-align: left">&gt;=0.0.1, &lt;= 0.4.3</td></tr>
<tr><td style="text-align: left">1.0</td><td style="text-align: left">&gt;=1.0.0, &lt;=1.1.2</td></tr>
<tr><td style="text-align: left">1.1</td><td style="text-align: left">&gt;=2.0.0, &lt;=2.0.9</td></tr>
<tr><td style="text-align: left">1.2</td><td style="text-align: left">&gt;=3.0.0</td></tr>
</tbody></table>
<p>If you're getting <code>MigrationRequiredError</code> after updating the framework, run <a href="config/../cli-reference.html#migrate"><code>dipdup migrate</code></a> command to perform project migration.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="templates"><a class="header" href="#templates">templates</a></h1>
<pre><code class="language-yaml">indexes:
  foo:
    kind: template
    name: bar
    first_level: 12341234
    template_values:
      network: mainnet

templates:
  bar:
    kind&quot; index
    datasource: tzkt_&lt;network&gt;  # resolves into `tzkt_mainnet`
    ...
</code></pre>
<table><thead><tr><th>field</th><th>description</th></tr></thead><tbody>
<tr><td><code>kind</code></td><td>always <code>template</code></td></tr>
<tr><td><code>name</code></td><td>Name of index template</td></tr>
<tr><td><code>template_values</code></td><td>Values to be substituted in template (<code>&lt;key&gt;</code> → <code>value</code>)</td></tr>
<tr><td><code>first_level</code></td><td>Level to start indexing from</td></tr>
<tr><td><code>last_level</code></td><td>Level to stop indexing at (DipDup will terminate at this level)</td></tr>
</tbody></table>
<div style="break-before: page; page-break-before: always;"></div><h1 id="changelog"><a class="header" href="#changelog">Changelog</a></h1>
<p>All notable changes to this project will be documented in this file.</p>
<p>The format is based on <a href="https://keepachangelog.com/en/1.0.0/">Keep a Changelog</a>,
and this project adheres to <a href="https://semver.org/spec/v2.0.0.html">Semantic Versioning</a>.</p>
<h2 id="523---2022-07-07"><a class="header" href="#523---2022-07-07"><a href="https://github.com/dipdup-net/dipdup-py/compare/5.2.2...5.2.3">5.2.3</a> - 2022-07-07</a></h2>
<h3 id="added"><a class="header" href="#added">Added</a></h3>
<ul>
<li>sentry: Allow customizing <code>server_name</code> and <code>release</code> tags with corresponding fields in Sentry config.</li>
</ul>
<h3 id="fixed"><a class="header" href="#fixed">Fixed</a></h3>
<ul>
<li>cli: Fixed <code>hasura configure</code> command crash when models have empty <code>Meta.table</code>.</li>
<li>config: Removed secrets from config <code>__repr__</code>.</li>
</ul>
<h2 id="522---2022-07-03"><a class="header" href="#522---2022-07-03"><a href="https://github.com/dipdup-net/dipdup-py/compare/5.2.1...5.2.2">5.2.2</a> - 2022-07-03</a></h2>
<h3 id="fixed-1"><a class="header" href="#fixed-1">Fixed</a></h3>
<ul>
<li>hasura: Fixed metadata generation.</li>
</ul>
<h2 id="521---2022-07-02"><a class="header" href="#521---2022-07-02"><a href="https://github.com/dipdup-net/dipdup-py/compare/5.2.0...5.2.1">5.2.1</a> - 2022-07-02</a></h2>
<h3 id="fixed-2"><a class="header" href="#fixed-2">Fixed</a></h3>
<ul>
<li>cli: Fixed setting default logging level.</li>
<li>hasura: Fixed metadata generation for relations with a custom field name.</li>
<li>hasura: Fixed configuring existing instances after changing <code>camel_case</code> field in config.</li>
</ul>
<h2 id="520---2022-06-28"><a class="header" href="#520---2022-06-28"><a href="https://github.com/dipdup-net/dipdup-py/compare/5.1.7...5.2.0">5.2.0</a> - 2022-06-28</a></h2>
<h3 id="added-1"><a class="header" href="#added-1">Added</a></h3>
<ul>
<li>config: Added <code>logging</code> config field.</li>
<li>config: Added <code>hasura.create_source</code> flag to create PostgreSQL source if missing.</li>
</ul>
<h3 id="fixed-3"><a class="header" href="#fixed-3">Fixed</a></h3>
<ul>
<li>hasura: Do not apply table customizations to tables from other sources.</li>
</ul>
<h3 id="deprecated"><a class="header" href="#deprecated">Deprecated</a></h3>
<ul>
<li>cli: <code>--logging-config</code> option is deprecated.</li>
<li>cli: All <code>run</code> command flags are deprecated. Use the <code>advanced</code> section of the config.</li>
<li>cli: <code>cache show</code> and <code>cache clear</code> commands are deprecated.</li>
<li>config: <code>http.cache</code> flag is deprecated.</li>
</ul>
<h2 id="517---2022-06-15"><a class="header" href="#517---2022-06-15"><a href="https://github.com/dipdup-net/dipdup-py/compare/5.1.6...5.1.7">5.1.7</a> - 2022-06-15</a></h2>
<h3 id="fixed-4"><a class="header" href="#fixed-4">Fixed</a></h3>
<ul>
<li>index: Fixed <code>token_transfer</code> index not receiving realtime updates.</li>
</ul>
<h2 id="516---2022-06-08"><a class="header" href="#516---2022-06-08"><a href="https://github.com/dipdup-net/dipdup-py/compare/5.1.5...5.1.6">5.1.6</a> - 2022-06-08</a></h2>
<h3 id="fixed-5"><a class="header" href="#fixed-5">Fixed</a></h3>
<ul>
<li>cli: Commands with <code>--help</code> option no longer require a working DipDup config.</li>
<li>index: Fixed crash with <code>RuntimeError</code> after continuous realtime connection loss.</li>
</ul>
<h3 id="performance"><a class="header" href="#performance">Performance</a></h3>
<ul>
<li>cli: Lazy import dependencies to speed up startup.</li>
</ul>
<h3 id="other"><a class="header" href="#other">Other</a></h3>
<ul>
<li>docs: Migrate docs from GitBook to mdbook.</li>
</ul>
<h2 id="515---2022-06-05"><a class="header" href="#515---2022-06-05"><a href="https://github.com/dipdup-net/dipdup-py/compare/5.1.4...5.1.5">5.1.5</a> - 2022-06-05</a></h2>
<h3 id="fixed-6"><a class="header" href="#fixed-6">Fixed</a></h3>
<ul>
<li>config: Fixed crash when rollback hook is about to be called.</li>
</ul>
<h2 id="514---2022-06-02"><a class="header" href="#514---2022-06-02"><a href="https://github.com/dipdup-net/dipdup-py/compare/5.1.3...5.1.4">5.1.4</a> - 2022-06-02</a></h2>
<h3 id="fixed-7"><a class="header" href="#fixed-7">Fixed</a></h3>
<ul>
<li>config: Fixed <code>OperationIndexConfig.types</code> field being partially ignored.</li>
<li>index: Allow mixing oneshot and regular indexes in a single config.</li>
<li>index: Call rollback hook instead of triggering reindex when single-level rollback has failed.</li>
<li>index: Fixed crash with <code>RuntimeError</code> after continuous realtime connection loss.</li>
<li>tzkt: Fixed <code>origination</code> subscription missing when <code>merge_subscriptions</code> flag is set.</li>
</ul>
<h3 id="performance-1"><a class="header" href="#performance-1">Performance</a></h3>
<ul>
<li>ci: Decrease the size of generic and <code>-pytezos</code> Docker images by 11% and 16%, respectively.</li>
</ul>
<h2 id="513---2022-05-26"><a class="header" href="#513---2022-05-26"><a href="https://github.com/dipdup-net/dipdup-py/compare/5.1.2...5.1.3">5.1.3</a> - 2022-05-26</a></h2>
<h3 id="fixed-8"><a class="header" href="#fixed-8">Fixed</a></h3>
<ul>
<li>database: Fixed special characters in password not being URL encoded.</li>
</ul>
<h3 id="performance-2"><a class="header" href="#performance-2">Performance</a></h3>
<ul>
<li>context: Do not reinitialize config when adding a single index.</li>
</ul>
<h2 id="512---2022-05-24"><a class="header" href="#512---2022-05-24"><a href="https://github.com/dipdup-net/dipdup-py/compare/5.1.1...5.1.2">5.1.2</a> - 2022-05-24</a></h2>
<h3 id="added-2"><a class="header" href="#added-2">Added</a></h3>
<ul>
<li>tzkt: Added <code>originated_contract_tzips</code> field to <code>OperationData</code>.</li>
</ul>
<h3 id="fixed-9"><a class="header" href="#fixed-9">Fixed</a></h3>
<ul>
<li>jobs: Fixed jobs with <code>daemon</code> schedule never start.</li>
<li>jobs: Fixed failed jobs not throwing exceptions into the main loop.</li>
</ul>
<h3 id="other-1"><a class="header" href="#other-1">Other</a></h3>
<ul>
<li>database: Tortoise ORM updated to <code>0.19.1</code>.</li>
</ul>
<h2 id="511---2022-05-13"><a class="header" href="#511---2022-05-13"><a href="https://github.com/dipdup-net/dipdup-py/compare/5.1.0...5.1.1">5.1.1</a> - 2022-05-13</a></h2>
<h3 id="fixed-10"><a class="header" href="#fixed-10">Fixed</a></h3>
<ul>
<li>index: Ignore indexes with different message types on rollback.</li>
<li>metadata: Add <code>ithacanet</code> to available networks.</li>
</ul>
<h2 id="510---2022-05-12"><a class="header" href="#510---2022-05-12"><a href="https://github.com/dipdup-net/dipdup-py/compare/5.0.4...5.1.0">5.1.0</a> - 2022-05-12</a></h2>
<h3 id="added-3"><a class="header" href="#added-3">Added</a></h3>
<ul>
<li>ci: Push <code>X</code> and <code>X.Y</code> tags to the Docker Hub on release.</li>
<li>cli: Added <code>config env</code> command to export env-file with default values.</li>
<li>cli: Show warning when running an outdated version of DipDup.</li>
<li>hooks: Added a new hook <code>on_index_rollback</code> to perform per-index rollbacks.</li>
</ul>
<h3 id="fixed-11"><a class="header" href="#fixed-11">Fixed</a></h3>
<ul>
<li>index: Fixed fetching <code>migration</code> operations.</li>
<li>tzkt: Fixed possible data corruption when using the <code>buffer_size</code> option.</li>
<li>tzkt: Fixed reconnection due to <code>websockets</code> message size limit.</li>
</ul>
<h3 id="deprecated-1"><a class="header" href="#deprecated-1">Deprecated</a></h3>
<ul>
<li>hooks: The <code>on_rollback</code> default hook is superseded by <code>on_index_rollback</code> and will be removed later.</li>
</ul>
<h2 id="504---2022-05-05"><a class="header" href="#504---2022-05-05"><a href="https://github.com/dipdup-net/dipdup-py/compare/5.0.3...5.0.4">5.0.4</a> - 2022-05-05</a></h2>
<h3 id="fixed-12"><a class="header" href="#fixed-12">Fixed</a></h3>
<ul>
<li>exceptions: Fixed incorrect formatting and broken links in help messages.</li>
<li>index: Fixed crash when the only index in config is <code>head</code>.</li>
<li>index: Fixed fetching originations during the initial sync.</li>
</ul>
<h2 id="503---2022-05-04"><a class="header" href="#503---2022-05-04"><a href="https://github.com/dipdup-net/dipdup-py/compare/5.0.2...5.0.3">5.0.3</a> - 2022-05-04</a></h2>
<h3 id="fixed-13"><a class="header" href="#fixed-13">Fixed</a></h3>
<ul>
<li>index: Fixed crash when no block with the same level arrived after a single-level rollback.</li>
<li>index: Fixed setting initial index level when <code>IndexConfig.first_level</code> is set.</li>
<li>tzkt: Fixed delayed emitting of buffered realtime messages.</li>
<li>tzkt: Fixed inconsistent behavior of <code>first_level</code>/<code>last_level</code> arguments in different getter methods.</li>
</ul>
<h2 id="502---2022-04-21"><a class="header" href="#502---2022-04-21"><a href="https://github.com/dipdup-net/dipdup-py/compare/5.0.1...5.0.2">5.0.2</a> - 2022-04-21</a></h2>
<h3 id="fixed-14"><a class="header" href="#fixed-14">Fixed</a></h3>
<ul>
<li>context: Fixed reporting incorrect reindexing reason.</li>
<li>exceptions: Fixed crash with <code>FrozenInstanceError</code> when an exception is raised from a callback.</li>
<li>jobs: Fixed graceful shutdown of daemon jobs.</li>
</ul>
<h3 id="improved"><a class="header" href="#improved">Improved</a></h3>
<ul>
<li>codegen: Refined <code>on_rollback</code> hook template.</li>
<li>exceptions: Updated help messages for known exceptions.</li>
<li>tzkt: Do not request reindexing if missing subgroups have matched no handlers.</li>
</ul>
<h2 id="501---2022-04-12"><a class="header" href="#501---2022-04-12"><a href="https://github.com/dipdup-net/dipdup-py/compare/5.0.0...5.0.1">5.0.1</a> - 2022-04-12</a></h2>
<h3 id="fixed-15"><a class="header" href="#fixed-15">Fixed</a></h3>
<ul>
<li>cli: Fixed <code>schema init</code> command crash with SQLite databases.</li>
<li>index: Fixed spawning datasources in oneshot mode.</li>
<li>tzkt: Fixed processing realtime messages.</li>
</ul>
<h2 id="500---2022-04-08"><a class="header" href="#500---2022-04-08"><a href="https://github.com/dipdup-net/dipdup-py/compare/5.0.0-rc4...5.0.0">5.0.0</a> - 2022-04-08</a></h2>
<p>This release contains no changes except for the version number.</p>
<h2 id="500-rc4---2022-04-04"><a class="header" href="#500-rc4---2022-04-04"><a href="https://github.com/dipdup-net/dipdup-py/compare/5.0.0-rc3...5.0.0-rc4">5.0.0-rc4</a> - 2022-04-04</a></h2>
<h3 id="added-4"><a class="header" href="#added-4">Added</a></h3>
<ul>
<li>tzkt: Added ability to process realtime messages with lag.</li>
</ul>
<h2 id="427---2022-04-02"><a class="header" href="#427---2022-04-02"><a href="https://github.com/dipdup-net/dipdup-py/compare/4.2.6...4.2.7">4.2.7</a> - 2022-04-02</a></h2>
<h3 id="fixed-16"><a class="header" href="#fixed-16">Fixed</a></h3>
<ul>
<li>config: Fixed <code>jobs</code> config section validation.</li>
<li>hasura: Fixed metadata generation for v2.3.0 and above.</li>
<li>tzkt: Fixed <code>get_originated_contracts</code> and <code>get_similar_contracts</code> methods response.</li>
</ul>
<h2 id="500-rc3---2022-03-28"><a class="header" href="#500-rc3---2022-03-28"><a href="https://github.com/dipdup-net/dipdup-py/compare/5.0.0-rc2...5.0.0-rc3">5.0.0-rc3</a> - 2022-03-28</a></h2>
<h3 id="added-5"><a class="header" href="#added-5">Added</a></h3>
<ul>
<li>config: Added <code>custom</code> section to store arbitrary user data.</li>
</ul>
<h3 id="fixed-17"><a class="header" href="#fixed-17">Fixed</a></h3>
<ul>
<li>config: Fixed default SQLite path (<code>:memory:</code>).</li>
<li>tzkt: Fixed pagination in several getter methods.</li>
<li>tzkt: Fixed data loss when <code>skip_history</code> option is enabled.</li>
</ul>
<h3 id="removed"><a class="header" href="#removed">Removed</a></h3>
<ul>
<li>config: Removed dummy <code>advanced.oneshot</code> flag.</li>
<li>cli: Removed <code>docker init</code> command.</li>
<li>cli: Removed dummy <code>schema approve --hashes</code> flag.</li>
</ul>
<h2 id="500-rc2---2022-03-13"><a class="header" href="#500-rc2---2022-03-13"><a href="https://github.com/dipdup-net/dipdup-py/compare/5.0.0-rc1...5.0.0-rc2">5.0.0-rc2</a> - 2022-03-13</a></h2>
<h3 id="fixed-18"><a class="header" href="#fixed-18">Fixed</a></h3>
<ul>
<li>tzkt: Fixed crash in methods that do not support cursor pagination.</li>
<li>prometheus: Fixed invalid metric labels. </li>
</ul>
<h2 id="500-rc1---2022-03-02"><a class="header" href="#500-rc1---2022-03-02"><a href="https://github.com/dipdup-net/dipdup-py/compare/4.2.6...5.0.0-rc1">5.0.0-rc1</a> - 2022-03-02</a></h2>
<h3 id="added-6"><a class="header" href="#added-6">Added</a></h3>
<ul>
<li>metadata: Added <code>metadata_interface</code> feature flag to expose metadata in TzKT format.</li>
<li>prometheus: Added ability to expose Prometheus metrics.</li>
<li>tzkt: Added missing fields to the <code>HeadBlockData</code> model.</li>
<li>tzkt: Added <code>iter_...</code> methods to iterate over item batches.</li>
</ul>
<h3 id="fixed-19"><a class="header" href="#fixed-19">Fixed</a></h3>
<ul>
<li>tzkt: Fixed possible OOM while calling methods that support pagination.</li>
<li>tzkt: Fixed possible data loss in <code>get_originations</code> and <code>get_quotes</code> methods.</li>
</ul>
<h3 id="changed"><a class="header" href="#changed">Changed</a></h3>
<ul>
<li>tzkt: Added <code>offset</code> and <code>limit</code> arguments to all methods that support pagination.</li>
</ul>
<h3 id="removed-1"><a class="header" href="#removed-1">Removed</a></h3>
<ul>
<li>bcd: Removed <code>bcd</code> datasource and config section.</li>
</ul>
<h3 id="performance-3"><a class="header" href="#performance-3">Performance</a></h3>
<ul>
<li>dipdup: Use fast <code>orjson</code> library instead of built-in <code>json</code> where possible.</li>
</ul>
<h2 id="426---2022-02-25"><a class="header" href="#426---2022-02-25"><a href="https://github.com/dipdup-net/dipdup-py/compare/4.2.5...4.2.6">4.2.6</a> - 2022-02-25</a></h2>
<h3 id="fixed-20"><a class="header" href="#fixed-20">Fixed</a></h3>
<ul>
<li>database: Fixed generating table names from uppercase model names.</li>
<li>http: Fixed bug that leads to caching invalid responses on the disk.</li>
<li>tzkt: Fixed processing realtime messages with data from multiple levels.</li>
</ul>
<h2 id="425---2022-02-21"><a class="header" href="#425---2022-02-21"><a href="https://github.com/dipdup-net/dipdup-py/compare/4.2.4...4.2.5">4.2.5</a> - 2022-02-21</a></h2>
<h3 id="fixed-21"><a class="header" href="#fixed-21">Fixed</a></h3>
<ul>
<li>database: Do not add the <code>schema</code> argument to the PostgreSQL connection string when not needed.</li>
<li>hasura: Wait for Hasura to be configured before starting indexing.</li>
</ul>
<h2 id="424---2022-02-14"><a class="header" href="#424---2022-02-14"><a href="https://github.com/dipdup-net/dipdup-py/compare/4.2.3...4.2.4">4.2.4</a> - 2022-02-14</a></h2>
<h3 id="added-7"><a class="header" href="#added-7">Added</a></h3>
<ul>
<li>config: Added <code>http</code> datasource to making arbitrary http requests.</li>
</ul>
<h3 id="fixed-22"><a class="header" href="#fixed-22">Fixed</a></h3>
<ul>
<li>context: Fixed crash when calling <code>fire_hook</code> method.</li>
<li>context: Fixed <code>HookConfig.atomic</code> flag, which was ignored in <code>fire_hook</code> method.</li>
<li>database: Create missing tables even if <code>Schema</code> model is present.</li>
<li>database: Fixed excess increasing of <code>decimal</code> context precision.</li>
<li>index: Fixed loading handler callbacks from nested packages (<a href="https://github.com/veqtor">@veqtor</a>).</li>
</ul>
<h3 id="other-2"><a class="header" href="#other-2">Other</a></h3>
<ul>
<li>ci: Added GitHub Action to build and publish Docker images for each PR opened.</li>
</ul>
<h2 id="423---2022-02-08"><a class="header" href="#423---2022-02-08"><a href="https://github.com/dipdup-net/dipdup-py/compare/4.2.2...4.2.3">4.2.3</a> - 2022-02-08</a></h2>
<h3 id="fixed-23"><a class="header" href="#fixed-23">Fixed</a></h3>
<ul>
<li>ci: Removed <code>black 21.12b0</code> dependency since bug in <code>datamodel-codegen-generator</code> is fixed.</li>
<li>cli: Fixed <code>config export</code> command crash when <code>advanced.reindex</code> dictionary is present.</li>
<li>cli: Removed optionals from <code>config export</code> output so the result can be loaded again.</li>
<li>config: Verify <code>advanced.scheduler</code> config for the correctness and unsupported features.</li>
<li>context: Fixed ignored <code>wait</code> argument of <code>fire_hook</code> method.</li>
<li>hasura: Fixed processing relation fields with missing <code>related_name</code>.</li>
<li>jobs: Fixed default <code>apscheduler</code> config.</li>
<li>tzkt: Fixed crash occurring when reorg message is the first one received by the datasource.</li>
</ul>
<h2 id="422---2022-02-01"><a class="header" href="#422---2022-02-01"><a href="https://github.com/dipdup-net/dipdup-py/compare/4.2.1...4.2.2">4.2.2</a> - 2022-02-01</a></h2>
<h3 id="fixed-24"><a class="header" href="#fixed-24">Fixed</a></h3>
<ul>
<li>config: Fixed <code>ipfs</code> datasource config.</li>
</ul>
<h2 id="421---2022-01-31"><a class="header" href="#421---2022-01-31"><a href="https://github.com/dipdup-net/dipdup-py/compare/4.2.0...4.2.1">4.2.1</a> - 2022-01-31</a></h2>
<h3 id="fixed-25"><a class="header" href="#fixed-25">Fixed</a></h3>
<ul>
<li>ci: Added <code>black 21.12b0</code> dependency to avoid possible conflict with <code>datamodel-codegen-generator</code>.</li>
</ul>
<h2 id="420---2022-01-31"><a class="header" href="#420---2022-01-31"><a href="https://github.com/dipdup-net/dipdup-py/compare/4.1.2...4.2.0">4.2.0</a> - 2022-01-31</a></h2>
<h3 id="added-8"><a class="header" href="#added-8">Added</a></h3>
<ul>
<li>context: Added <code>wait</code> argument to <code>fire_hook</code> method to escape current transaction context.</li>
<li>context: Added <code>ctx.get_&lt;kind&gt;_datasource</code> helpers to avoid type casting.</li>
<li>hooks: Added ability to configure <code>apscheduler</code> with <code>AdvancedConfig.scheduler</code> field.</li>
<li>http: Added <code>request</code> method to send arbitrary requests (affects all datasources).</li>
<li>ipfs: Added <code>ipfs</code> datasource to download JSON and binary data from IPFS.</li>
</ul>
<h3 id="fixed-26"><a class="header" href="#fixed-26">Fixed</a></h3>
<ul>
<li>http: Removed dangerous method <code>close_session</code>.</li>
<li>context: Fixed help message of <code>IndexAlreadyExistsError</code> exception.</li>
</ul>
<h3 id="deprecated-2"><a class="header" href="#deprecated-2">Deprecated</a></h3>
<ul>
<li>bcd: Added deprecation notice.</li>
</ul>
<h3 id="other-3"><a class="header" href="#other-3">Other</a></h3>
<ul>
<li>dipdup: Removed unused internal methods.</li>
</ul>
<h2 id="412---2022-01-27"><a class="header" href="#412---2022-01-27"><a href="https://github.com/dipdup-net/dipdup-py/compare/4.1.1...4.1.2">4.1.2</a> - 2022-01-27</a></h2>
<h3 id="added-9"><a class="header" href="#added-9">Added</a></h3>
<ul>
<li>cli: Added <code>schema wipe --force</code> argument to skip confirmation prompt.</li>
</ul>
<h3 id="fixed-27"><a class="header" href="#fixed-27">Fixed</a></h3>
<ul>
<li>cli: Show warning about deprecated <code>--hashes</code> argument</li>
<li>cli: Ignore <code>SIGINT</code> signal when shutdown is in progress.</li>
<li>sentry: Ignore exceptions when shutdown is in progress.</li>
</ul>
<h2 id="411---2022-01-25"><a class="header" href="#411---2022-01-25"><a href="https://github.com/dipdup-net/dipdup-py/compare/4.1.0...4.1.1">4.1.1</a> - 2022-01-25</a></h2>
<h3 id="fixed-28"><a class="header" href="#fixed-28">Fixed</a></h3>
<ul>
<li>cli: Fixed stacktraces missing on exception.</li>
<li>cli: Fixed wrapping <code>OSError</code> with <code>ConfigurationError</code> during config loading.</li>
<li>hasura: Fixed printing help messages on <code>HasuraError</code>.</li>
<li>hasura: Preserve a list of sources in Hasura Cloud environments.</li>
<li>hasura: Fixed <code>HasuraConfig.source</code> config option.</li>
</ul>
<h3 id="changed-1"><a class="header" href="#changed-1">Changed</a></h3>
<ul>
<li>cli: Unknown exceptions are no longer wrapped with <code>DipDupError</code>.</li>
</ul>
<h3 id="performance-4"><a class="header" href="#performance-4">Performance</a></h3>
<ul>
<li>hasura: Removed some useless requests.</li>
</ul>
<h2 id="410---2022-01-24"><a class="header" href="#410---2022-01-24"><a href="https://github.com/dipdup-net/dipdup-py/compare/4.0.5...4.1.0">4.1.0</a> - 2022-01-24</a></h2>
<h3 id="added-10"><a class="header" href="#added-10">Added</a></h3>
<ul>
<li>cli: Added <code>schema init</code> command to initialize database schema.</li>
<li>cli: Added <code>--force</code> flag to <code>hasura configure</code> command.</li>
<li>codegen: Added support for subpackages inside callback directories.</li>
<li>hasura: Added <code>dipdup_head_status</code> view and REST endpoint.</li>
<li>index: Added an ability to skip historical data while synchronizing <code>big_map</code> indexes.</li>
<li>metadata: Added <code>metadata</code> datasource.</li>
<li>tzkt: Added <code>get_big_map</code> and <code>get_contract_big_maps</code> datasource methods.</li>
</ul>
<h2 id="405---2022-01-20"><a class="header" href="#405---2022-01-20"><a href="https://github.com/dipdup-net/dipdup-py/compare/4.0.4...4.0.5">4.0.5</a> - 2022-01-20</a></h2>
<h3 id="fixed-29"><a class="header" href="#fixed-29">Fixed</a></h3>
<ul>
<li>index: Fixed deserializing manually modified typeclasses.</li>
</ul>
<h2 id="404---2022-01-17"><a class="header" href="#404---2022-01-17"><a href="https://github.com/dipdup-net/dipdup-py/compare/4.0.3...4.0.4">4.0.4</a> - 2022-01-17</a></h2>
<h3 id="added-11"><a class="header" href="#added-11">Added</a></h3>
<ul>
<li>cli: Added <code>--keep-schemas</code> flag to <code>init</code> command to preserve JSONSchemas along with generated types.</li>
</ul>
<h3 id="fixed-30"><a class="header" href="#fixed-30">Fixed</a></h3>
<ul>
<li>demos: Tezos Domains and Homebase DAO demos were updated from edo2net to mainnet contracts.</li>
<li>hasura: Fixed missing relations for models with <code>ManyToManyField</code> fields.</li>
<li>tzkt: Fixed parsing storage with nested structures.</li>
</ul>
<h3 id="performance-5"><a class="header" href="#performance-5">Performance</a></h3>
<ul>
<li>dipdup: Minor overall performance improvements.</li>
</ul>
<h3 id="other-4"><a class="header" href="#other-4">Other</a></h3>
<ul>
<li>ci: Cache virtual environment in GitHub Actions.</li>
<li>ci: Detect CI environment and skip tests that fail in GitHub Actions.</li>
<li>ci: Execute tests in parallel with <code>pytest-xdist</code> when possible.</li>
<li>ci: More strict linting rules of <code>flake8</code>.</li>
</ul>
<h2 id="403---2022-01-09"><a class="header" href="#403---2022-01-09"><a href="https://github.com/dipdup-net/dipdup-py/compare/4.0.2...4.0.3">4.0.3</a> - 2022-01-09</a></h2>
<h3 id="fixed-31"><a class="header" href="#fixed-31">Fixed</a></h3>
<ul>
<li>tzkt: Fixed parsing parameter with an optional value.</li>
</ul>
<h2 id="402---2022-01-06"><a class="header" href="#402---2022-01-06"><a href="https://github.com/dipdup-net/dipdup-py/compare/4.0.1...4.0.2">4.0.2</a> - 2022-01-06</a></h2>
<h3 id="added-12"><a class="header" href="#added-12">Added</a></h3>
<ul>
<li>tzkt: Added optional <code>delegate_address</code> and <code>delegate_alias</code> fields to <code>OperationData</code>.</li>
</ul>
<h3 id="fixed-32"><a class="header" href="#fixed-32">Fixed</a></h3>
<ul>
<li>tzkt: Fixed crash due to unprocessed pysignalr exception.</li>
<li>tzkt: Fixed parsing <code>OperationData.amount</code> field.</li>
<li>tzkt: Fixed parsing storage with top-level boolean fields.</li>
</ul>
<h2 id="401---2021-12-30"><a class="header" href="#401---2021-12-30"><a href="https://github.com/dipdup-net/dipdup-py/compare/4.0.0...4.0.1">4.0.1</a> - 2021-12-30</a></h2>
<h3 id="fixed-33"><a class="header" href="#fixed-33">Fixed</a></h3>
<ul>
<li>codegen: Fixed generating storage typeclasses with <code>Union</code> fields.</li>
<li>codegen: Fixed preprocessing contract JSONSchema.</li>
<li>index: Fixed processing reindexing reason saved in the database.</li>
<li>tzkt: Fixed processing operations with default entrypoint and empty parameter.</li>
<li>tzkt: Fixed crash while recursively applying bigmap diffs to the storage.</li>
</ul>
<h3 id="performance-6"><a class="header" href="#performance-6">Performance</a></h3>
<ul>
<li>tzkt: Increased speed of applying bigmap diffs to operation storage.</li>
</ul>
<h2 id="400---2021-12-24"><a class="header" href="#400---2021-12-24"><a href="https://github.com/dipdup-net/dipdup-py/compare/4.0.0-rc3...4.0.0">4.0.0</a> - 2021-12-24</a></h2>
<p>This release contains no changes except for the version number.</p>
<h2 id="400-rc3---2021-12-20"><a class="header" href="#400-rc3---2021-12-20"><a href="https://github.com/dipdup-net/dipdup-py/compare/4.0.0-rc2...4.0.0-rc3">4.0.0-rc3</a> - 2021-12-20</a></h2>
<h3 id="fixed-34"><a class="header" href="#fixed-34">Fixed</a></h3>
<ul>
<li>cli: Fixed missing <code>schema approve --hashes</code> argument.</li>
<li>codegen: Fixed contract address used instead of an alias when typename is not set.</li>
<li>tzkt: Fixed processing operations with entrypoint <code>default</code>.</li>
<li>tzkt: Fixed regression in processing migration originations.</li>
<li>tzkt: Fixed filtering of big map diffs by the path.</li>
</ul>
<h3 id="removed-2"><a class="header" href="#removed-2">Removed</a></h3>
<ul>
<li>cli: Removed deprecated <code>run --oneshot</code> argument and <code>clear-cache</code> command.</li>
</ul>
<h2 id="400-rc2---2021-12-11"><a class="header" href="#400-rc2---2021-12-11"><a href="https://github.com/dipdup-net/dipdup-py/compare/4.0.0-rc1...4.0.0-rc2">4.0.0-rc2</a> - 2021-12-11</a></h2>
<h3 id="-migration"><a class="header" href="#-migration">⚠ Migration</a></h3>
<ul>
<li>Run <code>dipdup init</code> command to generate <code>on_synchronized</code> hook stubs.</li>
</ul>
<h3 id="added-13"><a class="header" href="#added-13">Added</a></h3>
<ul>
<li>hooks: Added <code>on_synchronized</code> hook, which fires each time all indexes reach realtime state.</li>
</ul>
<h3 id="fixed-35"><a class="header" href="#fixed-35">Fixed</a></h3>
<ul>
<li>cli: Fixed config not being verified when invoking some commands.</li>
<li>codegen: Fixed generating callback arguments for untyped operations.</li>
<li>index: Fixed incorrect log messages, remove duplicate ones.</li>
<li>index: Fixed crash while processing storage of some contracts.</li>
<li>index: Fixed matching of untyped operations filtered by <code>source</code> field (<a href="https://github.com/pravin-d">@pravin-d</a>).</li>
</ul>
<h3 id="performance-7"><a class="header" href="#performance-7">Performance</a></h3>
<ul>
<li>index: Checks performed on each iteration of the main DipDup loop are slightly faster now.</li>
</ul>
<h2 id="400-rc1---2021-12-02"><a class="header" href="#400-rc1---2021-12-02"><a href="https://github.com/dipdup-net/dipdup-py/compare/3.1.3...4.0.0-rc1">4.0.0-rc1</a> - 2021-12-02</a></h2>
<h3 id="-migration-1"><a class="header" href="#-migration-1">⚠ Migration</a></h3>
<ul>
<li>Run <code>dipdup schema approve</code> command on every database you want to use with 4.0.0-rc1. Running <code>dipdup migrate</code> is not necessary since <code>spec_version</code> hasn't changed in this release.</li>
</ul>
<h3 id="added-14"><a class="header" href="#added-14">Added</a></h3>
<ul>
<li>cli: Added <code>run --early-realtime</code> flag to establish a realtime connection before all indexes are synchronized.</li>
<li>cli: Added <code>run --merge-subscriptions</code> flag to subscribe to all operations/big map diffs during realtime indexing.</li>
<li>cli: Added <code>status</code> command to print the current status of indexes from the database.</li>
<li>cli: Added <code>config export [--unsafe]</code> command to print config after resolving all links and variables.</li>
<li>cli: Added <code>cache show</code> command to get information about file caches used by DipDup.</li>
<li>config: Added <code>first_level</code> and <code>last_level</code> optional fields to <code>TemplateIndexConfig</code>. These limits are applied after ones from the template itself.</li>
<li>config: Added <code>daemon</code> boolean field to <code>JobConfig</code> to run a single callback indefinitely. Conflicts with <code>crontab</code> and <code>interval</code> fields.</li>
<li>config: Added <code>advanced</code> top-level section.</li>
</ul>
<h3 id="fixed-36"><a class="header" href="#fixed-36">Fixed</a></h3>
<ul>
<li>cli: Fixed crashes and output inconsistency when piping DipDup commands.</li>
<li>cli: Fixed <code>schema wipe --immune</code> flag being ignored.</li>
<li>codegen: Fixed missing imports in handlers generated during init.</li>
<li>coinbase: Fixed possible data inconsistency caused by caching enabled for method <code>get_candles</code>.</li>
<li>http: Fixed increasing sleep time between failed request attempts.</li>
<li>index: Fixed invocation of head index callback.</li>
<li>index: Fixed <code>CallbackError</code> raised instead of <code>ReindexingRequiredError</code> in some cases.</li>
<li>tzkt: Fixed resubscribing when realtime connectivity is lost for a long time.</li>
<li>tzkt: Fixed sending useless subscription requests when adding indexes in runtime.</li>
<li>tzkt: Fixed <code>get_originated_contracts</code> and <code>get_similar_contracts</code> methods whose output was limited to <code>HTTPConfig.batch_size</code> field.</li>
<li>tzkt: Fixed lots of SignalR bugs by replacing <code>aiosignalrcore</code> library with <code>pysignalr</code>.</li>
</ul>
<h2 id="changed-2"><a class="header" href="#changed-2">Changed</a></h2>
<ul>
<li>cli: <code>dipdup schema wipe</code> command now requires confirmation when invoked in the interactive shell.</li>
<li>cli: <code>dipdup schema approve</code> command now also causes a recalculation of schema and index config hashes.</li>
<li>index: DipDup will recalculate respective hashes if reindexing is triggered with <code>config_modified: ignore</code> or <code>schema_modified: ignore</code> in advanced config.</li>
</ul>
<h3 id="deprecated-3"><a class="header" href="#deprecated-3">Deprecated</a></h3>
<ul>
<li>cli: <code>run --oneshot</code> option is deprecated and will be removed in the next major release. The oneshot mode applies automatically when <code>last_level</code> field is set in the index config.</li>
<li>cli: <code>clear-cache</code> command is deprecated and will be removed in the next major release. Use <code>cache clear</code> command instead.</li>
</ul>
<h3 id="performance-8"><a class="header" href="#performance-8">Performance</a></h3>
<ul>
<li>config: Configuration files are loaded 10x times faster.</li>
<li>index: Number of operations processed by matcher reduced by 40%-95% depending on the number of addresses and entrypoints used.</li>
<li>tzkt: Rate limit was increased. Try to set <code>connection_timeout</code> to a higher value if requests fail with <code>ConnectionTimeout</code> exception.</li>
<li>tzkt: Improved performance of response deserialization. </li>
</ul>
<h2 id="313---2021-11-15"><a class="header" href="#313---2021-11-15"><a href="https://github.com/dipdup-net/dipdup-py/compare/3.1.2...3.1.3">3.1.3</a> - 2021-11-15</a></h2>
<h3 id="fixed-37"><a class="header" href="#fixed-37">Fixed</a></h3>
<ul>
<li>codegen: Fixed missing imports in operation handlers. </li>
<li>codegen: Fixed invalid imports and arguments in big_map handlers.</li>
</ul>
<h2 id="312---2021-11-02"><a class="header" href="#312---2021-11-02"><a href="https://github.com/dipdup-net/dipdup-py/compare/3.1.1...3.1.2">3.1.2</a> - 2021-11-02</a></h2>
<h3 id="fixed-38"><a class="header" href="#fixed-38">Fixed</a></h3>
<ul>
<li>Fixed crash occurred during synchronization of big map indexes.</li>
</ul>
<h2 id="311---2021-10-18"><a class="header" href="#311---2021-10-18"><a href="https://github.com/dipdup-net/dipdup-py/compare/3.1.0...3.1.1">3.1.1</a> - 2021-10-18</a></h2>
<h3 id="fixed-39"><a class="header" href="#fixed-39">Fixed</a></h3>
<ul>
<li>Fixed loss of realtime subscriptions occurred after TzKT API outage.</li>
<li>Fixed updating schema hash in <code>schema approve</code> command.</li>
<li>Fixed possible crash occurred while Hasura is not ready.</li>
</ul>
<h2 id="310---2021-10-12"><a class="header" href="#310---2021-10-12"><a href="https://github.com/dipdup-net/dipdup-py/compare/3.0.4...3.1.0">3.1.0</a> - 2021-10-12</a></h2>
<h3 id="added-15"><a class="header" href="#added-15">Added</a></h3>
<ul>
<li>New index class <code>HeadIndex</code> (configuration: <a href="https://github.com/dipdup-net/dipdup-py/blob/master/src/dipdup/config.py#L778"><code>dipdup.config.HeadIndexConfig</code></a>). Use this index type to handle head (limited block header content) updates. This index type is realtime-only: historical data won't be indexed during the synchronization stage.</li>
<li>Added three new commands: <code>schema approve</code>, <code>schema wipe</code>, and <code>schema export</code>. Run <code>dipdup schema --help</code> command for details.</li>
</ul>
<h3 id="changed-3"><a class="header" href="#changed-3">Changed</a></h3>
<ul>
<li>Triggering reindexing won't lead to dropping the database automatically anymore. <code>ReindexingRequiredError</code> is raised instead. <code>--forbid-reindexing</code> option has become default.</li>
<li><code>--reindex</code> option is removed. Use <code>dipdup schema wipe</code> instead.</li>
<li>Values of <code>dipdup_schema.reindex</code> field updated to simplify querying database. See <a href="https://github.com/dipdup-net/dipdup-py/blob/master/src/dipdup/enums.py"><code>dipdup.enums.ReindexingReason</code></a> class for possible values.</li>
</ul>
<h3 id="fixed-40"><a class="header" href="#fixed-40">Fixed</a></h3>
<ul>
<li>Fixed <code>ReindexRequiredError</code> not being raised when running DipDup after reindexing was triggered.</li>
<li>Fixed index config hash calculation. Hashes of existing indexes in a database will be updated during the first run.</li>
<li>Fixed issue in <code>BigMapIndex</code> causing the partial loss of big map diffs.</li>
<li>Fixed printing help for CLI commands.</li>
<li>Fixed merging storage which contains specific nested structures.</li>
</ul>
<h3 id="improved-1"><a class="header" href="#improved-1">Improved</a></h3>
<ul>
<li>Raise <code>DatabaseConfigurationError</code> exception when project models are not compatible with GraphQL.</li>
<li>Another bunch of performance optimizations. Reduced DB pressure, speeded up parallel processing lots of indexes.</li>
<li>Added initial set of performance benchmarks (run: <code>./scripts/run_benchmarks.sh</code>)</li>
</ul>
<h2 id="304---2021-10-04"><a class="header" href="#304---2021-10-04"><a href="https://github.com/dipdup-net/dipdup-py/compare/3.0.3...3.0.4">3.0.4</a> - 2021-10-04</a></h2>
<h3 id="improved-2"><a class="header" href="#improved-2">Improved</a></h3>
<ul>
<li>A significant increase in indexing speed.</li>
</ul>
<h3 id="fixed-41"><a class="header" href="#fixed-41">Fixed</a></h3>
<ul>
<li>Fixed unexpected reindexing caused by the bug in processing zero- and single-level rollbacks.</li>
<li>Removed unnecessary file IO calls that could cause <code>PermissionError</code> exception in Docker environments.</li>
<li>Fixed possible violation of block-level atomicity during realtime indexing.</li>
</ul>
<h3 id="changes"><a class="header" href="#changes">Changes</a></h3>
<ul>
<li>Public methods of <code>TzktDatasource</code> now return immutable sequences.</li>
</ul>
<h2 id="303---2021-10-01"><a class="header" href="#303---2021-10-01"><a href="https://github.com/dipdup-net/dipdup-py/compare/3.0.2...3.0.3">3.0.3</a> - 2021-10-01</a></h2>
<h3 id="fixed-42"><a class="header" href="#fixed-42">Fixed</a></h3>
<ul>
<li>Fixed processing of single-level rollbacks emitted before rolled back head.</li>
</ul>
<h2 id="302---2021-09-30"><a class="header" href="#302---2021-09-30"><a href="https://github.com/dipdup-net/dipdup-py/compare/3.0.1...3.0.2">3.0.2</a> - 2021-09-30</a></h2>
<h3 id="added-16"><a class="header" href="#added-16">Added</a></h3>
<ul>
<li>Human-readable <code>CHANGELOG.md</code> 🕺</li>
<li>Two new options added to <code>dipdup run</code> command:
<ul>
<li><code>--forbid-reindexing</code> – raise <code>ReindexingRequiredError</code> instead of truncating database when reindexing is triggered for any reason. To continue indexing with existing database run <code>UPDATE dipdup_schema SET reindex = NULL;</code></li>
<li><code>--postpone-jobs</code> – job scheduler won't start until all indexes are synchronized. </li>
</ul>
</li>
</ul>
<h3 id="changed-4"><a class="header" href="#changed-4">Changed</a></h3>
<ul>
<li>Migration to this version requires reindexing.</li>
<li><code>dipdup_index.head_id</code> foreign key removed. <code>dipdup_head</code> table still contains the latest blocks from Websocket received by each datasource.</li>
</ul>
<h3 id="fixed-43"><a class="header" href="#fixed-43">Fixed</a></h3>
<ul>
<li>Removed unnecessary calls to TzKT API.</li>
<li>Fixed removal of PostgreSQL extensions (<code>timescaledb</code>, <code>pgcrypto</code>) by function <code>truncate_database</code> triggered on reindex.</li>
<li>Fixed creation of missing project package on <code>init</code>.</li>
<li>Fixed invalid handler callbacks generated on <code>init</code>.</li>
<li>Fixed detection of existing types in the project.</li>
<li>Fixed race condition caused by event emitter concurrency.</li>
<li>Capture unknown exceptions with Sentry before wrapping to <code>DipDupError</code>.</li>
<li>Fixed job scheduler start delay.</li>
<li>Fixed processing of reorg messages.</li>
</ul>
<h2 id="301---2021-09-24"><a class="header" href="#301---2021-09-24"><a href="https://github.com/dipdup-net/dipdup-py/compare/3.0.0...3.0.1">3.0.1</a> - 2021-09-24</a></h2>
<h3 id="added-17"><a class="header" href="#added-17">Added</a></h3>
<ul>
<li>Added <code>get_quote</code> and <code>get_quotes</code> methods to <code>TzKTDatasource</code>.</li>
</ul>
<h3 id="fixed-44"><a class="header" href="#fixed-44">Fixed</a></h3>
<ul>
<li>Defer spawning index datasources until initial sync is complete. It helps to mitigate some WebSocket-related crashes, but initial sync is a bit slower now.</li>
<li>Fixed possible race conditions in <code>TzKTDatasource</code>.</li>
<li>Start <code>jobs</code> scheduler after all indexes sync with a current head to speed up indexing.</li>
</ul>
<!-- Links -->
<!-- Versions -->
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-notes"><a class="header" href="#release-notes">Release notes</a></h1>
<p>This section contains information about changes introduced with specific DipDup releases.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="510"><a class="header" href="#510">5.1.0</a></h1>
<h2 id="-migration-from-50-optional"><a class="header" href="#-migration-from-50-optional">⚠ Migration from 5.0 (optional)</a></h2>
<ul>
<li>Run <code>init</code> command. Now you have two conflicting hooks: <code>on_rollback</code> and <code>on_index_rollback</code>. Follow the guide below to perform the migration. <code>ConflictingHooksError</code> exception will be raised until then.</li>
</ul>
<h2 id="whats-new"><a class="header" href="#whats-new">What's New</a></h2>
<h3 id="per-index-rollback-hook"><a class="header" href="#per-index-rollback-hook">Per-index rollback hook</a></h3>
<p>In this release, we continue to improve the rollback-handling experience, which became much more important since the Ithaca protocol reached mainnet. Let's briefly recap how DipDup currently processes chain reorgs <em>before</em> calling a rollback hook:</p>
<ol>
<li>If the <code>buffer_size</code> option of a TzKT datasource is set to a non-zero value, and there are enough data messages buffered when a rollback occurs, data is just dropped from the buffer, and indexing continues.</li>
<li>If all indexes in the config are <code>operation</code> ones, we can attempt to process a single-level rollback. All operations from rolled back block must be presented in the next one for rollback to succeed. If some operations are missing, the <code>on_rollback</code> hook will be called as usual.</li>
<li>Finally, we can safely ignore indexes with a level lower than the rollback target. The index level is updated either on synchronization or when at least one related operation or bigmap diff has been extracted from a realtime message.</li>
</ol>
<p>If none of these tricks have worked, we can't process a rollback without custom logic. Here's where changes begin. Before this release, every project contained the <code>on_rollback</code> hook, which receives <code>datasource: IndexDatasource</code> argument and from/to levels. Even if your deployment has thousands of indexes and only a couple of them are affected by rollback, you weren't able to easily find out which ones.</p>
<p>Now <code>on_rollback</code> hook is deprecated and superseded by the <code>on_index_rollback</code> one. Choose one of the following options:</p>
<ul>
<li>You haven't touched the <code>on_rollback</code> hook since project creation. Run <code>init</code> command and remove <code>hooks/on_rollback</code> and <code>sql/on_rollback</code> directories in project root. Default action (reindexing) has not changed.</li>
<li>You have some custom logic in <code>on_rollback</code> hook and want to leave it as-is for now. You can ignore introduced changes at least till the next major release.</li>
<li>You have implemented per-datasource rollback logic and are ready to switch to the per-index one. Run <code>init</code>, move your code to the <code>on_index_rollback</code> hook and delete <code>on_rollback</code> one. Note, you can access rolled back datasource via <code>index.datasource</code>.</li>
</ul>
<h3 id="token-transfer-index"><a class="header" href="#token-transfer-index">Token transfer index</a></h3>
<p>Sometimes implementing an <code>operation</code> index is overkill for a specific task. An existing alternative is to use a <code>big_map</code> index to process only the diffs of selected big map paths. However, you still need to have a separate index for each contract of interest, which is very resource-consuming. A widespread case is indexing FA1.2/FA2 token contracts. So, this release introduces a new <code>token_transfer</code> index:</p>
<pre><code class="language-yaml">indexes:
  transfers:
    kind: token_transfer
    datasource: tzkt
    handlers:
      - callback: transfers
</code></pre>
<p>The <code>TokenTransferData</code> object is passed to the handler on each operation, containing only information enough to process a token transfer.</p>
<h3 id="config-env-command-to-generate-env-files"><a class="header" href="#config-env-command-to-generate-env-files"><code>config env</code> command to generate env-files</a></h3>
<p>Generally, It's good to separate a project config from deployment parameters, and DipDup has multiple options to achieve this. First of all, multiple configs can be chained successively, overriding top-level sections. Second, the DipDup config can contain docker-compose-style environment variable declarations. Let's say your config contains the following content:</p>
<pre><code class="language-yaml">database:
  kind: postgres
  host: db
  port: 5432
  user: ${POSTGRES_USER:-dipdup}
  password: ${POSTGRES_PASSWORD:-changeme}
  database: ${POSTGRES_DB:-dipdup}
</code></pre>
<p>You can generate an env-file to use with this exact config:</p>
<pre><code class="language-bash">$ dipdup -c dipdup.yml -c dipdup.docker.yml config env
POSTGRES_USER=dipdup
POSTGRES_PASSWORD=changeme
POSTGRES_DB=dipdup
</code></pre>
<p>The environment of your current shell is also taken into account:</p>
<pre><code class="language-bash">$ POSTGRES_DB=foobar dipdup -c dipdup.yml -c dipdup.docker.yml config env
POSTGRES_USER=dipdup
POSTGRES_PASSWORD=changeme
POSTGRES_DB=foobar  # &lt;- set from current env
</code></pre>
<p>Use <code>-f &lt;filename&gt;</code> option to save output on disk instead of printing to stdout. After you have modified the env-file according to your needs, you can apply it the way which is more convenient to you:</p>
<p>With dipdup <code>--env-file / -e</code> option:</p>
<pre><code class="language-bash">dipdup -e prod.env &lt;...&gt; run
</code></pre>
<p>When using docker-compose:</p>
<pre><code class="language-yaml">services:
  indexer:
    ...
    env_file: prod.env
</code></pre>
<h3 id="keeping-framework-up-to-date"><a class="header" href="#keeping-framework-up-to-date">Keeping framework up-to-date</a></h3>
<p>A bunch of new tags is now pushed to the Docker Hub on each release in addition to the <code>X.Y.Z</code> one: <code>X.Y</code> and <code>X</code>. That way, you can stick to a specific release without the risk of leaving a minor/major update unattended (friends don't let friends use <code>latest</code> 😉). The <code>-pytezos</code> flavor is also available for each tag.</p>
<pre><code class="language-Dockerfile">FROM dipdup/dipdup:5.1
...
</code></pre>
<p>In addition, DipDup will poll GitHub for new releases on each command which executes reasonably long and print a warning when running an outdated version. You can disable these checks with <code>advanced.skip_version_check</code> flag.</p>
<p>Pro tip: you can also enable notifications on the GitHub repo page with <em>👁 Watch -&gt; Custom -&gt; tick Releases -&gt; Apply</em> to never miss a fresh DipDup release.</p>
<h2 id="changelog-1"><a class="header" href="#changelog-1">Changelog</a></h2>
<p>See full 5.1.0 changelog <a href="release-notes/../CHANGELOG.html#510---2022-05-12">here</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="500"><a class="header" href="#500">5.0.0</a></h1>
<h2 id="-breaking-changes"><a class="header" href="#-breaking-changes">⚠ Breaking Changes</a></h2>
<ul>
<li>Python versions 3.8 and 3.9 are no longer supported.</li>
<li><code>bcd</code> datasource has been removed.</li>
<li>Two internal tables were added, <code>dipdup_contract_metadata</code> and <code>dipdup_token_metadata</code>.</li>
<li>Some methods of <code>tzkt</code> datasource have changed their signatures and behavior.</li>
<li>Dummy <code>advanced.oneshot</code> config flag has been removed.</li>
<li>Dummy <code>schema approve --hashes</code> command flag has been removed.</li>
<li><code>docker init</code> command has been removed.</li>
<li><code>ReindexingReason</code> enumeration items have been changed.</li>
</ul>
<h2 id="-migration-from-4x"><a class="header" href="#-migration-from-4x">⚠ Migration from 4.x</a></h2>
<ul>
<li>Ensure that you have a <code>python = &quot;^3.10&quot;</code> dependency in <code>pyproject.toml</code>.</li>
<li>Remove <code>bcd</code> datasources from config. Use <code>metadata</code> datasource instead to fetch contract and token metadata.</li>
<li>Update <code>tzkt</code> datasource method calls as described below.</li>
<li>Run the <code>dipdup schema approve</code> command on every database you use with 5.0.0.</li>
<li>Update usage of <code>ReindexingReason</code> enumeration if needed.</li>
</ul>
<h2 id="whats-new-1"><a class="header" href="#whats-new-1">What's New</a></h2>
<h3 id="process-realtime-messages-with-lag"><a class="header" href="#process-realtime-messages-with-lag">Process realtime messages with lag</a></h3>
<p>Chain reorgs have occurred much recently since the Ithaca protocol reached mainnet. The preferable way to deal with rollbacks is the <code>on_rollback</code> hook. But if the logic of your indexer is too complex, you can buffer an arbitrary number of levels before processing to avoid reindexing.</p>
<pre><code class="language-yaml">datasources:
  tzkt_mainnet:
    kind: tzkt
    url: https://api.tzkt.io
    buffer_size: 2
</code></pre>
<p>DipDup tries to remove backtracked operations from the buffer instead emitting rollback. Ithaca guarantees operations finality after one block and blocks finality after two blocks, so to completely avoid reorgs, <code>buffer_size</code> should be 2.</p>
<h3 id="bcd-api-takedown"><a class="header" href="#bcd-api-takedown">BCD API takedown</a></h3>
<p>Better Call Dev API was officially deprecated in February. Thus, it's time to go for <code>bcd</code> datasource. In DipDup, it served the only purpose of fetching contract and token metadata. Now there's a separate <code>metadata</code> datasource which do the same thing but better. If you have used <code>bcd</code> datasource for custom requests, see <a href="https://baking-bad.org/blog/2022/02/15/migrating-from-bcd-api-to-tzkt-api/">How to migrate from BCD to TzKT API</a> article.</p>
<h3 id="tzkt-batch-request-pagination"><a class="header" href="#tzkt-batch-request-pagination">TzKT batch request pagination</a></h3>
<p>Historically, most <code>TzktDatasource</code> methods had a page iteration logic hidden inside. The quantity of items returned by TzKT in a single request is configured in <code>HTTPConfig.batch_size</code> and defaulted to 10.000. Before this release, three requests would be performed by the <code>get_big_map</code> method to fetch 25.000 big map keys, leading to performance degradation and extensive memory usage.</p>
<table><thead><tr><th>affected method</th><th>response size in 4.x</th><th>response size in 5.x</th></tr></thead><tbody>
<tr><td><code>get_similar_contracts</code></td><td>unlimited</td><td>max. <code>datasource.request_limit</code></td></tr>
<tr><td><code>get_originated_contracts</code></td><td>unlimited</td><td>max. <code>datasource.request_limit</code></td></tr>
<tr><td><code>get_big_map</code></td><td>unlimited</td><td>max. <code>datasource.request_limit</code></td></tr>
<tr><td><code>get_contract_big_maps</code></td><td>unlimited</td><td>max. <code>datasource.request_limit</code></td></tr>
<tr><td><code>get_quotes</code></td><td>first <code>datasource.request_limit</code></td><td>max. <code>datasource.request_limit</code></td></tr>
</tbody></table>
<p>All paginated methods now behave the same way. You can either iterate over pages manually or use <code>iter_...</code> helpers.</p>
<pre><code class="language-python">datasource = ctx.get_tzkt_datasource('tzkt_mainnet')
batch_iter = datasource.iter_big_map(
    big_map_id=big_map_id,
    level=last_level,
)
async for key_batch in batch_iter:
    for key in key_batch:
        ...
</code></pre>
<h3 id="metadata-interface-for-tzkt-integration"><a class="header" href="#metadata-interface-for-tzkt-integration">Metadata interface for TzKT integration</a></h3>
<p>Starting with 5.0 you can store and expose custom contract and token metadata in the same format DipDup Metadata service does for TZIP-compatible metadata.</p>
<p>Enable this feature with <code>advanced.metadata_interface</code> flag, then update metadata in any callback:</p>
<pre><code class="language-python">await ctx.update_contract_metadata(
    network='mainnet',
    address='KT1...',
    metadata={'foo': 'bar'},
)
</code></pre>
<p>Metadata stored in <code>dipdup_contract_metadata</code> and <code>dipdup_token_metadata</code> tables and available via GraphQL and REST APIs.</p>
<h3 id="prometheus-integration-1"><a class="header" href="#prometheus-integration-1">Prometheus integration</a></h3>
<p>This version introduces initial Prometheus integration. It could help you set up monitoring, find performance issues in your code, and so on. To enable this integration, add the following lines to the config:</p>
<pre><code class="language-yaml">prometheus:
  host: 0.0.0.0
</code></pre>
<blockquote>
<p>🤓 <strong>SEE ALSO</strong></p>
<ul>
<li><a href="https://dipdup.net/docs-next/config/prometheus.html">11.11. prometheus</a></li>
<li><a href="https://dipdup.net/docs-next/deployment/prometheus.html">6.6. Prometheus integration</a></li>
</ul>
</blockquote>
<h2 id="changes-singe-427"><a class="header" href="#changes-singe-427">Changes singe 4.2.7</a></h2>
<h3 id="added-18"><a class="header" href="#added-18">Added</a></h3>
<ul>
<li>config: Added <code>custom</code> section to store arbitrary user data.</li>
<li>metadata: Added <code>metadata_interface</code> feature flag to expose metadata in TzKT format.</li>
<li>prometheus: Added ability to expose Prometheus metrics.</li>
<li>tzkt: Added ability to process realtime messages with lag.</li>
<li>tzkt: Added missing fields to the <code>HeadBlockData</code> model.</li>
<li>tzkt: Added <code>iter_...</code> methods to iterate over item batches.</li>
</ul>
<h3 id="fixed-45"><a class="header" href="#fixed-45">Fixed</a></h3>
<ul>
<li>config: Fixed default SQLite path (<code>:memory:</code>).</li>
<li>prometheus: Fixed invalid metric labels.</li>
<li>tzkt: Fixed pagination in several getter methods.</li>
<li>tzkt: Fixed data loss when <code>skip_history</code> option is enabled.</li>
<li>tzkt: Fixed crash in methods that do not support cursor pagination.</li>
<li>tzkt: Fixed possible OOM while calling methods that support pagination.</li>
<li>tzkt: Fixed possible data loss in <code>get_originations</code> and <code>get_quotes</code> methods.</li>
</ul>
<h3 id="changed-5"><a class="header" href="#changed-5">Changed</a></h3>
<ul>
<li>tzkt: Added <code>offset</code> and <code>limit</code> arguments to all methods that support pagination.</li>
</ul>
<h3 id="removed-3"><a class="header" href="#removed-3">Removed</a></h3>
<ul>
<li>bcd: Removed <code>bcd</code> datasource and config section.</li>
<li>cli: Removed <code>docker init</code> command.</li>
<li>cli: Removed dummy <code>schema approve --hashes</code> flag.</li>
<li>config: Removed dummy <code>advanced.oneshot</code> flag.</li>
</ul>
<h3 id="performance-9"><a class="header" href="#performance-9">Performance</a></h3>
<ul>
<li>dipdup: Use fast <code>orjson</code> library instead of built-in <code>json</code> where possible.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="420"><a class="header" href="#420">4.2.0</a></h1>
<h2 id="whats-new-2"><a class="header" href="#whats-new-2">What's new</a></h2>
<h3 id="ipfs-datasource"><a class="header" href="#ipfs-datasource"><code>ipfs</code> datasource</a></h3>
<p>While working with contract/token metadata, a typical scenario is to fetch it from IPFS. DipDup now has a separate datasource to perform such requests.</p>
<pre><code class="language-yaml">datasources:
  ipfs:
    kind: ipfs
    url: https://ipfs.io/ipfs
</code></pre>
<p>You can use this datasource within any callback. Output is either JSON or binary data.</p>
<pre><code class="language-python">ipfs = ctx.get_ipfs_datasource('ipfs')

file = await ipfs.get('QmdCz7XGkBtd5DFmpDPDN3KFRmpkQHJsDgGiG16cgVbUYu')
assert file[:4].decode()[1:] == 'PDF'

file = await ipfs.get('QmSgSC7geYH3Ae4SpUHy4KutxqNH9ESKBGXoCN4JQdbtEz/package.json')
assert file['name'] == 'json-buffer'
</code></pre>
<p>You can tune HTTP connection parameters with the <code>http</code> config field, just like any other datasource.</p>
<h3 id="sending-arbitrary-requests-1"><a class="header" href="#sending-arbitrary-requests-1">Sending arbitrary requests</a></h3>
<p>DipDup datasources do not cover all available methods of underlying APIs. Let's say you want to fetch protocol of the chain you're currently indexing from TzKT:</p>
<pre><code class="language-python">tzkt = ctx.get_tzkt_datasource('tzkt_mainnet')
protocol_json = await tzkt.request(
    method='get',
    url='v1/protocols/current',
    cache=False,
    weigth=1,  # ratelimiter leaky-bucket drops
)
assert protocol_json['hash'] == 'PtHangz2aRngywmSRGGvrcTyMbbdpWdpFKuS4uMWxg2RaH9i1qx'
</code></pre>
<p>Datasource HTTP connection parameters (ratelimit, backoff, etc.) are applied on every request.</p>
<h3 id="firing-hooks-outside-of-the-current-transaction"><a class="header" href="#firing-hooks-outside-of-the-current-transaction">Firing hooks outside of the current transaction</a></h3>
<p>When configuring a hook, you can instruct DipDup to wrap it in a single database transaction:</p>
<pre><code class="language-yaml">hooks:
  my_hook:
    callback: my_hook
    atomic: True
</code></pre>
<p>Until now, such hooks could only be fired according to <code>jobs</code> schedules, but not from a handler or another atomic hook using <code>ctx.fire_hook</code> method. This limitation is eliminated - use <code>wait</code> argument to escape the current transaction:</p>
<pre><code class="language-python">async def handler(ctx: HandlerContext, ...) -&gt; None:
    await ctx.fire_hook('atomic_hook', wait=False)
</code></pre>
<h3 id="spin-up-a-new-project-with-a-single-command"><a class="header" href="#spin-up-a-new-project-with-a-single-command">Spin up a new project with a single command</a></h3>
<p>Cookiecutter is an excellent <code>jinja2</code> wrapper to initialize hello-world templates of various frameworks and toolkits interactively. Install <code>python-cookiecutter</code> package systemwide, then call:</p>
<pre><code class="language-shell">cookiecutter https://github.com/dipdup-net/cookiecutter-dipdup
</code></pre>
<h3 id="advanced-scheduler-configuration"><a class="header" href="#advanced-scheduler-configuration">Advanced scheduler configuration</a></h3>
<p>DipDup utilizes <code>apscheduler</code> library to run hooks according to schedules in <code>jobs</code> config section. In the following example, <code>apscheduler</code> spawns up to three instances of the same job every time the trigger is fired, even if previous runs are in progress:</p>
<pre><code class="language-yaml">advanced:
  scheduler:
    apscheduler.job_defaults.coalesce: True
    apscheduler.job_defaults.max_instances: 3
</code></pre>
<p>See <a href="https://apscheduler.readthedocs.io/en/stable/userguide.html#configuring-the-scheduler"><code>apscheduler</code> docs</a> for details.</p>
<p>Note that you can't use executors from <code>apscheduler.executors.pool</code> module - <code>ConfigurationError</code> exception raised then. If you're into multiprocessing, I'll explain why in the next paragraph.</p>
<h3 id="about-the-present-and-future-of-multiprocessing"><a class="header" href="#about-the-present-and-future-of-multiprocessing">About the present and future of multiprocessing</a></h3>
<p>It's impossible to use <code>apscheduler</code> pool executors with hooks because <code>HookContext</code> is not pickle-serializable. So, they are forbidden now in <code>advanced.scheduler</code> config. However, thread/process pools can come in handy in many situations, and it would be nice to have them in DipDup context. For now, I can suggest implementing custom commands as a workaround to perform any resource-hungry tasks within them. Put the following code in <code>&lt;project&gt;/cli.py</code>:</p>
<pre><code class="language-python">from contextlib import AsyncExitStack

import asyncclick as click
from dipdup.cli import cli, cli_wrapper
from dipdup.config import DipDupConfig
from dipdup.context import DipDupContext
from dipdup.utils.database import tortoise_wrapper


@cli.command(help='Run heavy calculations')
@click.pass_context
@cli_wrapper
async def do_something_heavy(ctx):
    config: DipDupConfig = ctx.obj.config
    url = config.database.connection_string
    models = f'{config.package}.models'

    async with AsyncExitStack() as stack:
        await stack.enter_async_context(tortoise_wrapper(url, models))
        ...

if __name__ == '__main__':
    cli(prog_name='dipdup', standalone_mode=False)  # type: ignore
</code></pre>
<p>Then use <code>python -m &lt;project&gt;.cli</code> instead of <code>dipdup</code> as an entrypoint. Now you can call <code>do-something-heavy</code> like any other <code>dipdup</code> command. <code>dipdup.cli:cli</code> group handles arguments and config parsing, graceful shutdown, and other boilerplate. The rest is on you; use <code>dipdup.dipdup:DipDup.run</code> as a reference. And keep in mind that Tortoise ORM is not thread-safe. I aim to implement <code>ctx.pool_apply</code> and <code>ctx.pool_map</code> methods to execute code in pools with <em>magic</em> within existing DipDup hooks, but no ETA yet.</p>
<p>That's all, folks! As always, your feedback is very welcome 🤙</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="410"><a class="header" href="#410">4.1.0</a></h1>
<h2 id="-migration-from-40-optional"><a class="header" href="#-migration-from-40-optional">⚠ Migration from 4.0 (optional)</a></h2>
<ul>
<li>Run <code>dipdup schema init</code> on the existing database to enable <code>dipdup_head_status</code> view and REST endpoint.</li>
</ul>
<h2 id="whats-new-3"><a class="header" href="#whats-new-3">What's New</a></h2>
<h3 id="index-only-the-current-state-of-big-maps-1"><a class="header" href="#index-only-the-current-state-of-big-maps-1">Index only the current state of big maps</a></h3>
<p><code>big_map</code> indexes allow achieving faster processing times than <code>operation</code> ones when storage updates are the only on-chain data your dapp needs to function. With this DipDup release, you can go even further and index only the current storage state, ignoring historical changes.</p>
<pre><code class="language-yaml">indexes:
  foo:
    kind: big_map
    ...
    skip_history: never|once|always
</code></pre>
<p>When this option is set to <code>once</code>, DipDup will skip historical changes only on initial sync and switch to regular indexing afterward. When the value is <code>always</code>, DipDup will fetch all big map keys on every restart. Preferrable mode depends on your workload.</p>
<p>All big map diffs DipDup pass to handlers during fast sync have <code>action</code> field set to <code>BigMapAction.ADD_KEY</code>. Keep in mind that DipDup fetches all keys in this mode, including ones removed from the big map. If needed, you can filter out the latter by <code>BigMapDiff.data.active</code> field.</p>
<h3 id="new-datasource-for-contract-and-token-metadata"><a class="header" href="#new-datasource-for-contract-and-token-metadata">New datasource for contract and token metadata</a></h3>
<p>Since the first version DipDup allows to fetch token metadata from Better Call Dev API with <code>bcd</code> datasource. Now it's time for a better solution. Firstly, BCD is far from being reliable in terms of metadata indexing. Secondly, spinning up your own instance of BCD requires significant effort and computing power. Lastly, we plan to deprecate Better Call Dev API soon (but do not worry - it won't affect the explorer frontend).</p>
<p>Luckily, we have <a href="https://github.com/dipdup-net/metadata">dipdup-metadata</a>, a standalone companion indexer for DipDup written in Go. Configure a new datasource in the following way:</p>
<pre><code class="language-yaml">datasources:
  metadata:
    kind: metadata
    url: https://metadata.dipdup.net
    network: mainnet|handzhounet
</code></pre>
<p>Now you can use it anywhere in your callbacks:</p>
<pre><code class="language-python">datasource = ctx.datasources['metadata']
token_metadata = await datasource.get_token_metadata(address, token_id)
</code></pre>
<p><code>bcd</code> datasource will remain available for a while, but we discourage using it for metadata processing.</p>
<h3 id="nested-packages-for-hooks-and-handlers"><a class="header" href="#nested-packages-for-hooks-and-handlers">Nested packages for hooks and handlers</a></h3>
<p>Callback modules are no longer have to be in top-level <code>hooks</code>/<code>handlers</code> directories. Add one or multiple dots to the callback name to define nested packages:</p>
<pre><code class="language-yaml">package: indexer
hooks:
  foo.bar:
    callback: foo.bar
</code></pre>
<p>After running <code>init</code> command, you'll get the following directory tree (shortened for readability):</p>
<pre><code class="language-text">indexer
├── hooks
│   ├── foo
│   │   ├── bar.py
│   │   └── __init__.py
│   └── __init__.py
└── sql
    └── foo
        └── bar
            └── .keep
</code></pre>
<p>The same rules apply to handler callbacks. Note that <code>callback</code> field must be a valid Python package name - lowercase letters, underscores, and dots.</p>
<h3 id="new-cli-commands-and-flags"><a class="header" href="#new-cli-commands-and-flags">New CLI commands and flags</a></h3>
<ul>
<li>
<p><code>schema init</code> is a new command to prepare a database for running DipDip. It will create tables based on your models, then call <code>on_reindex</code> SQL hook to finish preparation - the same things DipDup does when run on a clean database.</p>
</li>
<li>
<p><code>hasura configure --force</code> flag allows to configure Hasura even if metadata hash matches one saved in database. It may come in handy during development.</p>
</li>
<li>
<p><code>init --keep-schemas</code> flag makes DipDup preserve contract JSONSchemas. Usually, they are removed after generating typeclasses with <code>datamodel-codegen</code>, but you can keep them to convert to other formats or troubleshoot codegen issues.</p>
</li>
</ul>
<h3 id="built-in-dipdup_head_status-view-and-rest-endpoint"><a class="header" href="#built-in-dipdup_head_status-view-and-rest-endpoint">Built-in <code>dipdup_head_status</code> view and REST endpoint</a></h3>
<p>DipDup maintains several internal models to keep its state. As Hasura generates GraphQL queries and REST endpoints for those models, you can use them for monitoring. However, some SaaS monitoring solutions can only check whether an HTTP response contains a specific word or not. For such cases <code>dipdup_head_status</code> view was added - a simplified representation of <code>dipdup_head</code> table. It returns <code>OK</code> when datasource received head less than two minutes ago and <code>OUTDATED</code> otherwise. Latter means that something's stuck, either DipDup (e.g., because of database deadlock) or TzKT instance. Or maybe the whole Tezos blockchain, but in that case, you have problems bigger than indexing.</p>
<pre><code class="language-shell">$ curl &quot;http://127.0.0.1:41000/api/rest/dipdupHeadStatus?name=https%3A%2F%2Fapi.tzkt.io&quot; 
{&quot;dipdupHeadStatus&quot;:[{&quot;status&quot;:&quot;OUTDATED&quot;}]}%
</code></pre>
<p>Note that <code>dipdup_head</code> update may be delayed during sync even if the <code>--early-realtime</code> flag is enabled, so don't rely exclusively on this endpoint.</p>
<h2 id="changelog-2"><a class="header" href="#changelog-2">Changelog</a></h2>
<h3 id="added-19"><a class="header" href="#added-19">Added</a></h3>
<ul>
<li>cli: Added <code>schema init</code> command to initialize database schema.</li>
<li>cli: Added <code>--force</code> flag to <code>hasura configure</code> command.</li>
<li>codegen: Added support for subpackages inside callback directories.</li>
<li>hasura: Added <code>dipdup_head_status</code> view and REST endpoint.</li>
<li>index: Added an ability to skip historical data while synchronizing <code>big_map</code> indexes.</li>
<li>metadata: Added <code>metadata</code> datasource.</li>
<li>tzkt: Added <code>get_big_map</code> and <code>get_contract_big_maps</code> datasource methods.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="400"><a class="header" href="#400">4.0.0</a></h1>
<h2 id="-breaking-changes-1"><a class="header" href="#-breaking-changes-1">⚠ Breaking Changes</a></h2>
<ul>
<li><code>run --oneshot</code> option is removed. The oneshot mode (DipDup stops after the sync is finished) applies automatically when <code>last_level</code> field is set in the index config.</li>
<li><code>clear-cache</code> command is removed. Use <code>cache clear</code> instead.</li>
</ul>
<h2 id="-migration-from-3x"><a class="header" href="#-migration-from-3x">⚠ Migration from 3.x</a></h2>
<ul>
<li>Run <code>dipdup init</code> command to generate <code>on_synchronized</code> hook stubs.</li>
<li>Run <code>dipdup schema approve</code> command on every database you want to use with 4.0.0. Running <code>dipdup migrate</code> is not necessary since <code>spec_version</code> hasn't changed in this release.</li>
</ul>
<h2 id="whats-new-4"><a class="header" href="#whats-new-4">What's New</a></h2>
<h3 id="performance-optimizations"><a class="header" href="#performance-optimizations">Performance optimizations</a></h3>
<p>Overall indexing performance has been significantly improved. Key highlights:</p>
<ul>
<li>Configuration files are loaded 10x times faster. The more indexes in the project, the more noticeable difference is.</li>
<li>Significantly reduced CPU usage in realtime mode.</li>
<li>Datasource default HTTP connection options optimized for a reasonable balance between resource consumption and indexing speed.</li>
</ul>
<p>Also, two new flags were added to improve DipDup performance in several scenarios: <code>merge_subscriptions</code> and <code>early_relatime</code>.  See <a href="release-notes/4.0.0.html#new-cli-commands-and-flags">this paragraph</a> for details.</p>
<h3 id="configurable-action-on-reindex"><a class="header" href="#configurable-action-on-reindex">Configurable action on reindex</a></h3>
<p>There are several reasons that trigger reindexing:</p>
<table><thead><tr><th>reason</th><th>description</th></tr></thead><tbody>
<tr><td><code>manual</code></td><td>Reindexing triggered manually from callback with <code>ctx.reindex</code>.</td></tr>
<tr><td><code>migration</code></td><td>Applied migration requires reindexing. Check release notes before switching between major DipDup versions to be prepared.</td></tr>
<tr><td><code>rollback</code></td><td>Reorg message received from TzKT, and can not be processed.</td></tr>
<tr><td><code>config_modified</code></td><td>One of the index configs has been modified.</td></tr>
<tr><td><code>schema_modified</code></td><td>Database schema has been modified. Try to avoid manual schema modifications in favor of <a href="release-notes/../advanced/sql.html">SQL hooks</a>.</td></tr>
</tbody></table>
<p>Now it is possible to configure desirable action on reindexing triggered by the specific reason.</p>
<table><thead><tr><th>action</th><th>description</th></tr></thead><tbody>
<tr><td><code>exception</code> (default)</td><td>Raise <code>ReindexingRequiredError</code> and quit with error code. The safest option since you can trigger reindexing accidentally, e.g., by a typo in config. Don't forget to set up the correct restart policy when using it with containers.</td></tr>
<tr><td><code>wipe</code></td><td>Drop the whole database and start indexing from scratch. Be careful with this option!</td></tr>
<tr><td><code>ignore</code></td><td>Ignore the event and continue indexing as usual. It can lead to unexpected side-effects up to data corruption; make sure you know what you are doing.</td></tr>
</tbody></table>
<p>To configure actions for each reason, add the following section to DipDup config:</p>
<pre><code class="language-yaml">advanced:
  ...
  reindex:
    manual: wipe
    migration: exception
    rollback: ignore
    config_modified: exception
    schema_modified: exception
</code></pre>
<h3 id="new-cli-commands-and-flags-1"><a class="header" href="#new-cli-commands-and-flags-1">New CLI commands and flags</a></h3>
<table><thead><tr><th>command or flag</th><th>description</th></tr></thead><tbody>
<tr><td><code>cache show</code></td><td>Get information about file caches used by DipDup.</td></tr>
<tr><td><code>config export</code></td><td>Print config after resolving all links and variables. Add <code>--unsafe</code> option to substitute environment variables; default values from config will be used otherwise.</td></tr>
<tr><td><code>run --early-realtime</code></td><td>Establish a realtime connection before all indexes are synchronized.</td></tr>
<tr><td><code>run --merge-subscriptions</code></td><td>Subscribe to all operations/big map diffs during realtime indexing. This flag helps to avoid reaching TzKT subscriptions limit (currently 10000 channels). Keep in mind that this option could significantly improve RAM consumption depending on the time required to perform a sync.</td></tr>
<tr><td><code>status</code></td><td>Print the current status of indexes from the database.</td></tr>
</tbody></table>
<h3 id="advanced-top-level-config-section"><a class="header" href="#advanced-top-level-config-section"><code>advanced</code> top-level config section</a></h3>
<p>This config section allows users to tune system-wide options, either experimental or unsuitable for generic configurations.</p>
<table><thead><tr><th>field</th><th>description</th></tr></thead><tbody>
<tr><td><code>early_realtime</code><br><code>merge_subscriptions</code><br><code>postpone_jobs</code></td><td>Another way to set <code>run</code> command flags. Useful for maintaining per-deployment configurations.</td></tr>
<tr><td><code>reindex</code></td><td>Configure action on reindexing triggered. See <a href="release-notes/4.0.0.html#configurable-action-on-reindex">this paragraph</a> for details.</td></tr>
</tbody></table>
<p>CLI flags have priority over self-titled <code>AdvancedConfig</code> fields.</p>
<h3 id="aiosignalrcore-replaced-with-pysignalr"><a class="header" href="#aiosignalrcore-replaced-with-pysignalr"><code>aiosignalrcore</code> replaced with <code>pysignalr</code></a></h3>
<p>It may not be the most noticeable improvement for end-user, but it still deserves a separate paragraph in this article.</p>
<p>Historically, DipDup used our own fork of <code>signalrcore</code> library named <code>aiosignalrcore</code>. This project aimed to replace the synchronous <code>websocket-client</code> library with asyncio-ready <code>websockets</code>. Later we discovered that required changes make it hard to maintain backward compatibility, so we have decided to rewrite this library from scratch. So now you have both a modern and reliable library for SignalR protocol and a much more stable DipDup. Ain't it nice?</p>
<h2 id="changes-since-313"><a class="header" href="#changes-since-313">Changes since 3.1.3</a></h2>
<p>This is a combined changelog of -rc versions released since the last stable release until this one.</p>
<h3 id="added-20"><a class="header" href="#added-20">Added</a></h3>
<ul>
<li>cli: Added <code>run --early-realtime</code> flag to establish a realtime connection before all indexes are synchronized.</li>
<li>cli: Added'run --merge-subscriptions`  flag to subscribe to all operations/big map diffs during realtime indexing.</li>
<li>cli: Added <code>status</code> command to print the current status of indexes from the database.</li>
<li>cli: Added <code>config export [--unsafe]</code> command to print config after resolving all links and variables.</li>
<li>cli: Added <code>cache show</code> command to get information about file caches used by DipDup.</li>
<li>config: Added <code>first_level</code> and <code>last_level</code> optional fields to <code>TemplateIndexConfig</code>. These limits are applied after ones from the template itself.</li>
<li>config: Added <code>daemon</code> boolean field to <code>JobConfig</code> to run a single callback indefinitely. Conflicts with <code>crontab</code> and <code>interval</code> fields.</li>
<li>config: Added <code>advanced</code> top-level section.</li>
<li>hooks: Added <code>on_synchronized</code> hook, which fires each time all indexes reach realtime state.</li>
</ul>
<h3 id="fixed-46"><a class="header" href="#fixed-46">Fixed</a></h3>
<ul>
<li>cli: Fixed config not being verified when invoking some commands.</li>
<li>cli: Fixed crashes and output inconsistency when piping DipDup commands.</li>
<li>cli: Fixed missing <code>schema approve --hashes</code> argument.</li>
<li>cli: Fixed <code>schema wipe --immune</code> flag being ignored.</li>
<li>codegen: Fixed contract address used instead of an alias when typename is not set.</li>
<li>codegen: Fixed generating callback arguments for untyped operations.</li>
<li>codegen: Fixed missing imports in handlers generated during init.</li>
<li>coinbase: Fixed possible data inconsistency caused by caching enabled for method <code>get_candles</code>.</li>
<li>hasura: Fixed unnecessary reconfiguration in restart.</li>
<li>http: Fixed increasing sleep time between failed request attempts.</li>
<li>index: Fixed <code>CallbackError</code> raised instead of <code>ReindexingRequiredError</code> in some cases.</li>
<li>index: Fixed crash while processing storage of some contracts.</li>
<li>index: Fixed incorrect log messages, remove duplicate ones.</li>
<li>index: Fixed invocation of head index callback.</li>
<li>index: Fixed matching of untyped operations filtered by <code>source</code> field (<a href="https://github.com/pravin-d">@pravin-d</a>).</li>
<li>tzkt: Fixed filtering of big map diffs by the path.</li>
<li>tzkt: Fixed <code>get_originated_contracts</code> and <code>get_similar_contracts</code> methods whose output was limited to <code>HTTPConfig.batch_size</code> field.</li>
<li>tzkt: Fixed lots of SignalR bugs by replacing <code>aiosignalrcore</code> library with <code>pysignalr</code>.</li>
<li>tzkt: Fixed processing operations with entrypoint <code>default</code>.</li>
<li>tzkt: Fixed regression in processing migration originations.</li>
<li>tzkt: Fixed resubscribing when realtime connectivity is lost for a long time.</li>
<li>tzkt: Fixed sending useless subscription requests when adding indexes in runtime.</li>
</ul>
<h3 id="changed-6"><a class="header" href="#changed-6">Changed</a></h3>
<ul>
<li>cli: <code>schema wipe</code> command now requires confirmation when invoked in the interactive shell.</li>
<li>cli: <code>schema approve</code> command now also causes a recalculation of schema and index config hashes.</li>
<li>index: DipDup will recalculate respective hashes if reindexing is triggered with <code>config_modified: ignore</code> or <code>schema_modified: ignore</code> in advanced config.</li>
</ul>
<h3 id="removed-4"><a class="header" href="#removed-4">Removed</a></h3>
<ul>
<li>cli: Removed deprecated <code>run --oneshot</code> argument and <code>clear-cache</code> command.</li>
</ul>
<h3 id="performance-10"><a class="header" href="#performance-10">Performance</a></h3>
<ul>
<li>config: Configuration files are loaded 10x times faster.</li>
<li>index: Checks performed on each iteration of the main DipDup loop are slightly faster now.</li>
<li>index: Number of operations processed by matcher reduced by 40%-95% depending on the number of addresses and entrypoints used.</li>
<li>tzkt: Improved performance of response deserialization.</li>
<li>tzkt: Rate limit was increased. Try to set <code>connection_timeout</code> to a higher value if requests fail with <code>ConnectionTimeout</code> exception.</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
    </body>
</html>
